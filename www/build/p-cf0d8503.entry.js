import{r as t,h as n,H as e,c as i}from"./p-665c378e.js";const r=class{constructor(n){t(this,n),this.text="Call Now!",this.color="",this.fontStyle="Arial",this.padding="5px",this.height="30px",this.width="120px",this.borderRadius="sharp",this.bgColor="",this.borderColor=""}render(){return n(e,null,n("div",null,n("slot",{name:"button"},n("button",{style:{fontFamily:this.fontStyle,fontWeight:this.fontWeight,color:this.color,borderRadius:"round"==this.borderRadius?"24px":"0px",border:`1px solid ${this.borderColor}`,backgroundColor:this.bgColor,fontSize:this.fontSize,height:this.height,width:this.width,padding:this.padding},class:"btn btn--open"},this.text))))}};function o(t){return t<=9?`0${t}`:t}r.style=":host{display:block}.btn{display:inline-block;height:44px;width:220px;padding:10px 20px;cursor:pointer;border:0;background:#00d200;color:white;position:relative;overflow:hidden;font-family:Poppins;font-style:normal;font-weight:600;font-size:16px;line-height:24px;}.btn:after{content:'';display:block;position:absolute;top:-200%;right:-25%;width:150%;height:500%;background:rgba(255, 255, 255, 0.4);border-radius:100%;opacity:0}@keyframes ripple{0%{transform:scale(0);opacity:0.6}30%{transform:scale(1)}100%{opacity:0;transform:scale(1)}}.btn:not(:active):after{animation:ripple 2s ease-out}button:after{visibility:hidden}button:focus:after{visibility:visible}";const s=class{constructor(n){t(this,n),this.close=i(this,"close",7),this.isOpen=!1,this.handleClose=()=>{this.close.emit()}}render(){const t=new Date(this.callDuration),i=o(t.getUTCMinutes()),r=o(t.getUTCSeconds());return n(e,null,n("div",{class:"modal "+(this.isOpen?"modal--show":"")},n("div",{"data-id":"content",class:"modal__content"},n("div",{class:"logo"},n("img",{src:this.logoSrc}),n("span",{class:"status-online"})),n("div",{class:"timer"},n("div",{class:"time"},i," ",n("span",{class:"blink"},":")," ",r),n("div",{class:"text"},"Call Duration")),n("div",{class:"call-options"},n("div",{class:"call-end",onClick:this.handleClose},n("svg",{width:"50",height:"50",viewBox:"0 0 50 50",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M25 0C38.8069 0 50 11.1927 50 25C50 38.8073 38.8069 50 25 50C11.1931 50 0 38.8073 0 25C0 11.1931 11.1931 0 25 0Z",fill:"#F53333"}),n("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M36.6102 28.0741C34.2954 27.9508 32.039 27.5433 32.039 27.5433C32.039 27.5433 30.2313 27.2587 30.2268 25.9083C30.2241 25.0178 29.7662 23.348 28.9995 23.2078C28.2327 23.0676 20.6517 23.2078 20.6517 23.2078C20.6517 23.2078 19.8238 23.2633 19.6696 23.6989C19.5154 24.1344 18.9335 26.3996 18.9335 26.3996C18.9335 26.3996 18.5439 27.1865 17.4601 27.3815C16.3661 27.5784 13.0586 28.2484 13.0586 28.2484C13.0586 28.2484 11.7797 28.1018 11.5474 27.0756C11.3154 26.0495 11.3115 23.5648 11.3115 23.5648C11.3115 23.5648 11.4711 22.7379 12.8524 21.8859C14.2332 21.0345 17.466 19.0469 24.6186 19.045C31.2332 19.0438 37.1381 22.0391 37.1381 22.0391C37.1381 22.0391 38.0188 22.7087 38.2375 23.8703C38.456 25.0321 38.8273 28.1924 36.6102 28.0741Z",fill:"white"})))))),n("div",{"data-id":"overlay",onClick:this.handleClose,class:"overlay"}))}};s.style=":host{display:block;--overlay-bg-color:rgba(0, 0, 0, 0.1)}.modal{position:fixed;top:50%;left:50%;transform:translateX(-50%) translateY(-55%);z-index:2000;visibility:hidden;backface-visibility:hidden;perspective:1300px;}.modal--show{visibility:visible}.modal--show~.overlay{opacity:1;visibility:visible}.modal .modal__content{visibility:hidden}.modal--show .modal__content{visibility:visible;transform:rotateX(0deg);opacity:1}.modal__content{position:relative;margin:0 auto;padding:77px 20px 50px;box-sizing:border-box;transform-style:preserve-3d;transform:rotateX(-60deg);transform-origin:50% 0;opacity:0;transition:all 0.3s;display:flex;flex-direction:column;justify-content:space-between;align-items:center;text-align:center;width:413px;height:436px;background:#ffffff;box-shadow:0px 1px 10px 5px rgba(0, 0, 0, 0.1);border-radius:50px;box-sizing:border-box}.overlay{position:fixed;width:100%;height:100%;visibility:hidden;top:0;left:0;z-index:1000;opacity:0;background:var(--overlay-bg-color);transition:all 0.3s}.logo{background:#f3f3f3;height:100px;width:100px;border-radius:50%;position:relative}.logo img{width:100%;height:100%;border-radius:50%;border:1px solid gainsboro}.logo span.status-online{height:16px;width:16px;border-radius:50%;right:0;top:calc(70%);position:absolute;background:#00d200;border:1px solid #ffffff}.timer .time{font-family:Poppins;font-style:normal;font-weight:normal;font-size:26.4px;line-height:40px;color:#303c42}.timer .text{font-family:Poppins;font-style:normal;font-weight:normal;font-size:14.4px;line-height:22px;color:#9e9e9e}.blink{animation:blink-animation 1s steps(5, start) infinite;-webkit-animation:blink-animation 1s steps(5, start) infinite}.call-options .call-end{cursor:pointer}@keyframes blink-animation{to{visibility:hidden}}@-webkit-keyframes blink-animation{to{visibility:hidden}}";var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(t,n,e){return t(e={path:n,exports:{},require:function(){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},e.exports),e.exports}function c(t){if(t.__esModule)return t;var n=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(e){var i=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,i.get?i:{enumerable:!0,get:function(){return t[e]}})})),n}function f(){}function h(){h.init.call(this)}function l(t){return void 0===t._maxListeners?h.defaultMaxListeners:t._maxListeners}function d(t,n,e){if(n)t.call(e);else for(var i=t.length,r=k(t,i),o=0;o<i;++o)r[o].call(e)}function v(t,n,e,i){if(n)t.call(e,i);else for(var r=t.length,o=k(t,r),s=0;s<r;++s)o[s].call(e,i)}function p(t,n,e,i,r){if(n)t.call(e,i,r);else for(var o=t.length,s=k(t,o),u=0;u<o;++u)s[u].call(e,i,r)}function m(t,n,e,i,r,o){if(n)t.call(e,i,r,o);else for(var s=t.length,u=k(t,s),a=0;a<s;++a)u[a].call(e,i,r,o)}function w(t,n,e,i){if(n)t.apply(e,i);else for(var r=t.length,o=k(t,r),s=0;s<r;++s)o[s].apply(e,i)}function g(t,n,e,i){var r,o,s,u;if("function"!=typeof e)throw new TypeError('"listener" argument must be a function');if((o=t._events)?(o.newListener&&(t.emit("newListener",n,e.listener?e.listener:e),o=t._events),s=o[n]):(o=t._events=new f,t._eventsCount=0),s){if("function"==typeof s?s=o[n]=i?[e,s]:[s,e]:i?s.unshift(e):s.push(e),!s.warned&&(r=l(t))&&r>0&&s.length>r){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+n+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=n,a.count=s.length,u=a,"function"==typeof console.warn?console.warn(u):console.log(u)}}else s=o[n]=e,++t._eventsCount;return t}function b(t,n,e){var i=!1;function r(){t.removeListener(n,r),i||(i=!0,e.apply(t,arguments))}return r.listener=e,r}function y(t){var n=this._events;if(n){var e=n[t];if("function"==typeof e)return 1;if(e)return e.length}return 0}function k(t,n){for(var e=new Array(n);n--;)e[n]=t[n];return e}f.prototype=Object.create(null),h.EventEmitter=h,h.usingDomains=!1,h.prototype.domain=void 0,h.prototype._events=void 0,h.prototype._maxListeners=void 0,h.defaultMaxListeners=10,h.init=function(){this.domain=null,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new f,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=t,this},h.prototype.getMaxListeners=function(){return l(this)},h.prototype.emit=function(t){var n,e,i,r,o,s,u,a="error"===t;if(s=this._events)a=a&&null==s.error;else if(!a)return!1;if(u=this.domain,a){if(n=arguments[1],!u){if(n instanceof Error)throw n;var c=new Error('Uncaught, unspecified "error" event. ('+n+")");throw c.context=n,c}return n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=u,n.domainThrown=!1,u.emit("error",n),!1}if(!(e=s[t]))return!1;var f="function"==typeof e;switch(i=arguments.length){case 1:d(e,f,this);break;case 2:v(e,f,this,arguments[1]);break;case 3:p(e,f,this,arguments[1],arguments[2]);break;case 4:m(e,f,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(i-1),o=1;o<i;o++)r[o-1]=arguments[o];w(e,f,this,r)}return!0},h.prototype.on=h.prototype.addListener=function(t,n){return g(this,t,n,!1)},h.prototype.prependListener=function(t,n){return g(this,t,n,!0)},h.prototype.once=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.on(t,b(this,t,n)),this},h.prototype.prependOnceListener=function(t,n){if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');return this.prependListener(t,b(this,t,n)),this},h.prototype.removeListener=function(t,n){var e,i,r,o,s;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if(!(i=this._events))return this;if(!(e=i[t]))return this;if(e===n||e.listener&&e.listener===n)0==--this._eventsCount?this._events=new f:(delete i[t],i.removeListener&&this.emit("removeListener",t,e.listener||n));else if("function"!=typeof e){for(r=-1,o=e.length;o-- >0;)if(e[o]===n||e[o].listener&&e[o].listener===n){s=e[o].listener,r=o;break}if(r<0)return this;if(1===e.length){if(e[0]=void 0,0==--this._eventsCount)return this._events=new f,this;delete i[t]}else!function(t,n){for(var e=n,i=e+1,r=t.length;i<r;e+=1,i+=1)t[e]=t[i];t.pop()}(e,r);i.removeListener&&this.emit("removeListener",t,s||n)}return this},h.prototype.removeAllListeners=function(t){var n,e;if(!(e=this._events))return this;if(!e.removeListener)return 0===arguments.length?(this._events=new f,this._eventsCount=0):e[t]&&(0==--this._eventsCount?this._events=new f:delete e[t]),this;if(0===arguments.length){for(var i,r=Object.keys(e),o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=new f,this._eventsCount=0,this}if("function"==typeof(n=e[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},h.prototype.listeners=function(t){var n,e=this._events;return e&&(n=e[t])?"function"==typeof n?[n.listener||n]:function(t){for(var n=new Array(t.length),e=0;e<n.length;++e)n[e]=t[e].listener||t[e];return n}(n):[]},h.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):y.call(t,n)},h.prototype.listenerCount=y,h.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};const x=Object.freeze({__proto__:null,default:h,EventEmitter:h});var E=a((function(t,n){var e,i,r,o,s,a,c=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)});function f(t,n,e){"string"==typeof n?(t.message=n,e instanceof Error&&(t.originalError=e)):n instanceof Error&&(t.originalError=n)}Object.defineProperty(n,"__esModule",{value:!0}),function(t){var n=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=20101,r.description="Invalid access token",r.explanation="Twilio was unable to validate your Access Token",r.solutions=[],Object.setPrototypeOf(r,t.AccessTokenInvalid.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.AccessTokenInvalid=n;var e=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=20104,r.description="Access token expired or expiration date invalid",r.explanation="The Access Token provided to the Twilio API has expired, the expiration time specified in the token was invalid, or the expiration time specified was too far in the future",r.solutions=[],Object.setPrototypeOf(r,t.AccessTokenExpired.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.AccessTokenExpired=e;var i=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=20151,r.description="Authentication Failed",r.explanation="The Authentication with the provided JWT failed",r.solutions=[],Object.setPrototypeOf(r,t.AuthenticationFailed.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.AuthenticationFailed=i}(i=n.AuthorizationErrors||(n.AuthorizationErrors={})),function(t){var n=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=31400,r.description="Bad Request (HTTP/SIP)",r.explanation="The request could not be understood due to malformed syntax.",r.solutions=[],Object.setPrototypeOf(r,t.BadRequest.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.BadRequest=n}(r=n.ClientErrors||(n.ClientErrors={})),function(t){var n=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=31e3,r.description="Unknown Error",r.explanation="An unknown error has occurred. See error details for more information.",r.solutions=[],Object.setPrototypeOf(r,t.UnknownError.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.UnknownError=n;var e=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=31005,r.description="Connection error",r.explanation="A connection error occurred during the call",r.solutions=[],Object.setPrototypeOf(r,t.ConnectionError.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ConnectionError=e;var i=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=31009,r.description="Transport error",r.explanation="No transport available to send or receive messages",r.solutions=[],Object.setPrototypeOf(r,t.TransportError.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.TransportError=i}(o=n.GeneralErrors||(n.GeneralErrors={})),function(t){var n=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=[],r.code=53e3,r.description="Signaling connection error",r.explanation="Raised whenever a signaling connection error occurs that is not covered by a more specific error code.",r.solutions=[],Object.setPrototypeOf(r,t.ConnectionError.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ConnectionError=n;var e=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=["The device running your application lost its Internet connection."],r.code=53001,r.description="Signaling connection disconnected",r.explanation="Raised whenever the signaling connection is unexpectedly disconnected.",r.solutions=["Ensure the device running your application has access to a stable Internet connection."],Object.setPrototypeOf(r,t.ConnectionDisconnected.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ConnectionDisconnected=e}(s=n.SignalingErrors||(n.SignalingErrors={})),function(t){var n=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may not have the necessary resources to create or apply a new media description."],r.code=53400,r.description="Client is unable to create or apply a local media description",r.explanation="Raised whenever a Client is unable to create or apply a local media description.",r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(r,t.ClientLocalDescFailed.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ClientLocalDescFailed=n;var e=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=["The Client may not be using a supported WebRTC implementation.","The Client may be connecting peer-to-peer with another Participant that is not using a supported WebRTC implementation.","The Client may not have the necessary resources to apply a new media description."],r.code=53402,r.description="Client is unable to apply a remote media description",r.explanation="Raised whenever the Client receives a remote media description but is unable to apply it.",r.solutions=["If you are experiencing this error using the JavaScript SDK, ensure you are running it with a supported WebRTC implementation."],Object.setPrototypeOf(r,t.ClientRemoteDescFailed.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ClientRemoteDescFailed=e;var i=function(n){function e(e,i){var r=n.call(this,"")||this;return r.causes=["The Client was unable to establish a media connection.","A media connection which was active failed liveliness checks."],r.code=53405,r.description="Media connection failed",r.explanation="Raised by the Client or Server whenever a media connection fails.",r.solutions=["If the problem persists, try connecting to another region.","Check your Client's network connectivity.","If you've provided custom ICE Servers then ensure that the URLs and credentials are valid."],Object.setPrototypeOf(r,t.ConnectionError.prototype),f(r,e,i),r}return c(e,n),e}(Error);t.ConnectionError=i}(a=n.MediaErrors||(n.MediaErrors={})),n.errorsByCode=new Map([[20101,i.AccessTokenInvalid],[20104,i.AccessTokenExpired],[20151,i.AuthenticationFailed],[31400,r.BadRequest],[31e3,o.UnknownError],[31005,o.ConnectionError],[31009,o.TransportError],[53e3,s.ConnectionError],[53001,s.ConnectionDisconnected],[53400,a.ClientLocalDescFailed],[53402,a.ClientRemoteDescFailed],[53405,a.ConnectionError]]),Object.freeze(n.errorsByCode)})),C=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)});Object.defineProperty(n,"__esModule",{value:!0}),n.AuthorizationErrors=E.AuthorizationErrors,n.ClientErrors=E.ClientErrors,n.GeneralErrors=E.GeneralErrors,n.MediaErrors=E.MediaErrors,n.SignalingErrors=E.SignalingErrors;var r=function(t){function n(n){var e=t.call(this,n)||this;return e.name="InvalidArgumentError",e}return i(n,t),n}(Error);n.InvalidArgumentError=r;var o=function(t){function n(n){var e=t.call(this,n)||this;return e.name="InvalidStateError",e}return i(n,t),n}(Error);n.InvalidStateError=o;var s=function(t){function n(n){var e=t.call(this,n)||this;return e.name="NotSupportedError",e}return i(n,t),n}(Error);n.NotSupportedError=s,n.getErrorByCode=function(t){var n=E.errorsByCode.get(t);if(!n)throw new r("Error code "+t+" not found");return n}})),T=a((function(t){var n,e;n=u,e=function(){var t=function(){},n="undefined",e=typeof window!==n&&typeof window.navigator!==n&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function r(t,n){var e=t[n];if("function"==typeof e.bind)return e.bind(t);try{return Function.prototype.bind.call(e,t)}catch(n){return function(){return Function.prototype.apply.apply(e,[t,arguments])}}}function o(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(i){return"debug"===i&&(i="log"),typeof console!==n&&("trace"===i&&e?o:void 0!==console[i]?r(console,i):void 0!==console.log?r(console,"log"):t)}function u(n,e){for(var r=0;r<i.length;r++){var o=i[r];this[o]=r<n?t:this.methodFactory(o,n,e)}this.log=this.debug}function a(t,e,i){return function(){typeof console!==n&&(u.call(this,e,i),this[t].apply(this,arguments))}}function c(t,n,e){return s(t)||a.apply(this,arguments)}function f(t,e,r){var o,s=this,a="loglevel";function f(){var t;if(typeof window!==n){try{t=window.localStorage[a]}catch(t){}if(typeof t===n)try{var e=window.document.cookie,i=e.indexOf(encodeURIComponent(a)+"=");-1!==i&&(t=/^([^;]+)/.exec(e.slice(i))[1])}catch(t){}return void 0===s.levels[t]&&(t=void 0),t}}t&&(a+=":"+t),s.name=t,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||c,s.getLevel=function(){return o},s.setLevel=function(e,r){if("string"==typeof e&&void 0!==s.levels[e.toUpperCase()]&&(e=s.levels[e.toUpperCase()]),!("number"==typeof e&&e>=0&&e<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+e;if(o=e,!1!==r&&function(t){var e=(i[t]||"silent").toUpperCase();if(typeof window!==n){try{return void(window.localStorage[a]=e)}catch(t){}try{window.document.cookie=encodeURIComponent(a)+"="+e+";"}catch(t){}}}(e),u.call(s,e,t),typeof console===n&&e<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(t){f()||s.setLevel(t,!1)},s.enableAll=function(t){s.setLevel(s.levels.TRACE,t)},s.disableAll=function(t){s.setLevel(s.levels.SILENT,t)};var h=f();null==h&&(h=null==e?"WARN":e),s.setLevel(h,!1)}var h=new f,l={};h.getLogger=function(t){if("string"!=typeof t||""===t)throw new TypeError("You must supply a name when creating a logger.");var n=l[t];return n||(n=l[t]=new f(t,h.getLevel(),h.methodFactory)),n};var d=typeof window!==n?window.log:void 0;return h.noConflict=function(){return typeof window!==n&&window.log===h&&(window.log=d),h},h.getLoggers=function(){return l},h},t.exports?t.exports=e():n.log=e()})),S="https://sdk.twilio.com/js/client/sounds/releases/1.0.0/cowbell.mp3?cache=1.14.0",O=2e4,j="twilio-client",I="1.14.0",R="https://sdk.twilio.com/js/client/sounds/releases/1.0.0",_=a((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var e=function(){function t(t){this._log=(t&&t.LogLevelModule?t.LogLevelModule:T).getLogger(j)}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.debug=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];(t=this._log).debug.apply(t,n)},t.prototype.error=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];(t=this._log).error.apply(t,n)},t.prototype.info=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];(t=this._log).info.apply(t,n)},t.prototype.setDefaultLevel=function(t){this._log.setDefaultLevel(t)},t.prototype.warn=function(){for(var t,n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];(t=this._log).warn.apply(t,n)},t.levels=T.levels,t}();n.default=e})),A=a((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var e=R+"/outgoing.mp3",i=function(){function t(t,n,e,i){this._name=t,this._availableDevices=n,this._beforeChange=e,this._isSupported=i,this._activeDevices=new Set}return t.prototype.delete=function(t){var n=!!this._activeDevices.delete(t),e=this._availableDevices.get("default")||Array.from(this._availableDevices.values())[0];!this._activeDevices.size&&e&&this._activeDevices.add(e);var i=Array.from(this._activeDevices.values()).map((function(t){return t.deviceId}));return this._beforeChange(this._name,i),!!n},t.prototype.get=function(){return this._activeDevices},t.prototype.set=function(t){var n=this;if(!this._isSupported)return Promise.reject(new C.NotSupportedError("This browser does not support audio output selection"));var e=Array.isArray(t)?t:[t];if(!e.length)return Promise.reject(new C.InvalidArgumentError("Must specify at least one device to set"));var i=[],r=e.map((function(t){var e=n._availableDevices.get(t);return e||i.push(t),e}));return i.length?Promise.reject(new C.InvalidArgumentError("Devices not found: "+i.join(", "))):new Promise((function(t){t(n._beforeChange(n._name,e))})).then((function(){n._activeDevices.clear(),r.forEach(n._activeDevices.add,n._activeDevices)}))},t.prototype.test=function(t){return void 0===t&&(t=e),this._isSupported?this._activeDevices.size?Promise.all(Array.from(this._activeDevices).map((function(n){var e;return new Promise((function(n){(e=new Audio(t)).oncanplay=n})).then((function(){return e.setSinkId(n.deviceId).then((function(){return e.play()}))}))}))):Promise.reject(new C.InvalidStateError("No active output devices to test")):Promise.reject(new C.NotSupportedError("This browser does not support audio output selection"))},t}();n.default=i}));const P=c(x);var D=P.EventEmitter;function M(){Object.defineProperties(this,{_eventEmitter:{value:new D},_handlers:{value:{}}})}M.prototype.dispatchEvent=function(t){return this._eventEmitter.emit(t.type,t)},M.prototype.addEventListener=function(){var t;return(t=this._eventEmitter).addListener.apply(t,arguments)},M.prototype.removeEventListener=function(){var t;return(t=this._eventEmitter).removeListener.apply(t,arguments)},M.prototype._defineEventHandler=function(t){var n=this;Object.defineProperty(this,"on"+t,{get:function(){return n._handlers[t]},set:function(e){var i=n._handlers[t];!i||"function"!=typeof e&&null!=e||(n._handlers[t]=null,n.removeEventListener(t,i)),"function"==typeof e&&(n._handlers[t]=e,n.addEventListener(t,e))}})};var N=M;const L="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};var F=[],U=[],B="undefined"!=typeof Uint8Array?Uint8Array:Array,W=!1;function z(){W=!0;for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=0,e=t.length;n<e;++n)F[n]=t[n],U[t.charCodeAt(n)]=n;U["-".charCodeAt(0)]=62,U["_".charCodeAt(0)]=63}function q(t,n,e){for(var i,r=[],o=n;o<e;o+=3)r.push(F[(i=(t[o]<<16)+(t[o+1]<<8)+t[o+2])>>18&63]+F[i>>12&63]+F[i>>6&63]+F[63&i]);return r.join("")}function G(t,n,e,i,r){var o,s,u=8*r-i-1,a=(1<<u)-1,c=a>>1,f=-7,h=e?r-1:0,l=e?-1:1,d=t[n+h];for(h+=l,o=d&(1<<-f)-1,d>>=-f,f+=u;f>0;o=256*o+t[n+h],h+=l,f-=8);for(s=o&(1<<-f)-1,o>>=-f,f+=i;f>0;s=256*s+t[n+h],h+=l,f-=8);if(0===o)o=1-c;else{if(o===a)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,i),o-=c}return(d?-1:1)*s*Math.pow(2,o-i)}function J(t,n,e,i,r,o){var s,u,a,c=8*o-r-1,f=(1<<c)-1,h=f>>1,l=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,d=i?0:o-1,v=i?1:-1,p=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(u=isNaN(n)?1:0,s=f):(s=Math.floor(Math.log(n)/Math.LN2),n*(a=Math.pow(2,-s))<1&&(s--,a*=2),(n+=s+h>=1?l/a:l*Math.pow(2,1-h))*a>=2&&(s++,a/=2),s+h>=f?(u=0,s=f):s+h>=1?(u=(n*a-1)*Math.pow(2,r),s+=h):(u=n*Math.pow(2,h-1)*Math.pow(2,r),s=0));r>=8;t[e+d]=255&u,d+=v,u/=256,r-=8);for(s=s<<r|u,c+=r;c>0;t[e+d]=255&s,d+=v,s/=256,c-=8);t[e+d-v]|=128*p}var H={}.toString,V=Array.isArray||function(t){return"[object Array]"==H.call(t)};function $(){return Y.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function X(t,n){if($()<n)throw new RangeError("Invalid typed array length");return Y.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(n)).__proto__=Y.prototype:(null===t&&(t=new Y(n)),t.length=n),t}function Y(t,n,e){if(!(Y.TYPED_ARRAY_SUPPORT||this instanceof Y))return new Y(t,n,e);if("number"==typeof t){if("string"==typeof n)throw new Error("If encoding is specified then the first argument must be a string");return Q(this,t)}return Z(this,t,n,e)}function Z(t,n,e,i){if("number"==typeof n)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer?function(t,n,e,i){if(e<0||n.byteLength<e)throw new RangeError("'offset' is out of bounds");if(n.byteLength<e+(i||0))throw new RangeError("'length' is out of bounds");return n=void 0===e&&void 0===i?new Uint8Array(n):void 0===i?new Uint8Array(n,e):new Uint8Array(n,e,i),Y.TYPED_ARRAY_SUPPORT?(t=n).__proto__=Y.prototype:t=tt(t,n),t}(t,n,e,i):"string"==typeof n?function(t,n,e){if("string"==typeof e&&""!==e||(e="utf8"),!Y.isEncoding(e))throw new TypeError('"encoding" must be a valid string encoding');var i=0|it(n,e),r=(t=X(t,i)).write(n,e);return r!==i&&(t=t.slice(0,r)),t}(t,n,e):function(t,n){if(et(n)){var e=0|nt(n.length);return 0===(t=X(t,e)).length||n.copy(t,0,0,e),t}if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||(i=n.length)!=i?X(t,0):tt(t,n);if("Buffer"===n.type&&V(n.data))return tt(t,n.data)}var i;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,n)}function K(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function Q(t,n){if(K(n),t=X(t,n<0?0:0|nt(n)),!Y.TYPED_ARRAY_SUPPORT)for(var e=0;e<n;++e)t[e]=0;return t}function tt(t,n){var e=n.length<0?0:0|nt(n.length);t=X(t,e);for(var i=0;i<e;i+=1)t[i]=255&n[i];return t}function nt(t){if(t>=$())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+$().toString(16)+" bytes");return 0|t}function et(t){return!(null==t||!t._isBuffer)}function it(t,n){if(et(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var e=t.length;if(0===e)return 0;for(var i=!1;;)switch(n){case"ascii":case"latin1":case"binary":return e;case"utf8":case"utf-8":case void 0:return jt(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*e;case"hex":return e>>>1;case"base64":return It(t).length;default:if(i)return jt(t).length;n=(""+n).toLowerCase(),i=!0}}function rt(t,n,e){var i=!1;if((void 0===n||n<0)&&(n=0),n>this.length)return"";if((void 0===e||e>this.length)&&(e=this.length),e<=0)return"";if((e>>>=0)<=(n>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return gt(this,n,e);case"utf8":case"utf-8":return pt(this,n,e);case"ascii":return mt(this,n,e);case"latin1":case"binary":return wt(this,n,e);case"base64":return vt(this,n,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return bt(this,n,e);default:if(i)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),i=!0}}function ot(t,n,e){var i=t[n];t[n]=t[e],t[e]=i}function st(t,n,e,i,r){if(0===t.length)return-1;if("string"==typeof e?(i=e,e=0):e>2147483647?e=2147483647:e<-2147483648&&(e=-2147483648),e=+e,isNaN(e)&&(e=r?0:t.length-1),e<0&&(e=t.length+e),e>=t.length){if(r)return-1;e=t.length-1}else if(e<0){if(!r)return-1;e=0}if("string"==typeof n&&(n=Y.from(n,i)),et(n))return 0===n.length?-1:ut(t,n,e,i,r);if("number"==typeof n)return n&=255,Y.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,n,e):Uint8Array.prototype.lastIndexOf.call(t,n,e):ut(t,[n],e,i,r);throw new TypeError("val must be string, number or Buffer")}function ut(t,n,e,i,r){var o,s=1,u=t.length,a=n.length;if(void 0!==i&&("ucs2"===(i=String(i).toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(t.length<2||n.length<2)return-1;s=2,u/=2,a/=2,e/=2}function c(t,n){return 1===s?t[n]:t.readUInt16BE(n*s)}if(r){var f=-1;for(o=e;o<u;o++)if(c(t,o)===c(n,-1===f?0:o-f)){if(-1===f&&(f=o),o-f+1===a)return f*s}else-1!==f&&(o-=o-f),f=-1}else for(e+a>u&&(e=u-a),o=e;o>=0;o--){for(var h=!0,l=0;l<a;l++)if(c(t,o+l)!==c(n,l)){h=!1;break}if(h)return o}return-1}function at(t,n,e,i){e=Number(e)||0;var r=t.length-e;i?(i=Number(i))>r&&(i=r):i=r;var o=n.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var s=0;s<i;++s){var u=parseInt(n.substr(2*s,2),16);if(isNaN(u))return s;t[e+s]=u}return s}function ct(t,n,e,i){return Rt(jt(n,t.length-e),t,e,i)}function ft(t,n,e,i){return Rt(function(t){for(var n=[],e=0;e<t.length;++e)n.push(255&t.charCodeAt(e));return n}(n),t,e,i)}function ht(t,n,e,i){return ft(t,n,e,i)}function lt(t,n,e,i){return Rt(It(n),t,e,i)}function dt(t,n,e,i){return Rt(function(t,n){for(var e,i,r=[],o=0;o<t.length&&!((n-=2)<0);++o)i=(e=t.charCodeAt(o))>>8,r.push(e%256),r.push(i);return r}(n,t.length-e),t,e,i)}function vt(t,n,e){return function(t){var n;W||z();for(var e=t.length,i=e%3,r="",o=[],s=16383,u=0,a=e-i;u<a;u+=s)o.push(q(t,u,u+s>a?a:u+s));return 1===i?(r+=F[(n=t[e-1])>>2],r+=F[n<<4&63],r+="=="):2===i&&(r+=F[(n=(t[e-2]<<8)+t[e-1])>>10],r+=F[n>>4&63],r+=F[n<<2&63],r+="="),o.push(r),o.join("")}(0===n&&e===t.length?t:t.slice(n,e))}function pt(t,n,e){e=Math.min(t.length,e);for(var i=[],r=n;r<e;){var o,s,u,a,c=t[r],f=null,h=c>239?4:c>223?3:c>191?2:1;if(r+h<=e)switch(h){case 1:c<128&&(f=c);break;case 2:128==(192&(o=t[r+1]))&&(a=(31&c)<<6|63&o)>127&&(f=a);break;case 3:s=t[r+2],128==(192&(o=t[r+1]))&&128==(192&s)&&(a=(15&c)<<12|(63&o)<<6|63&s)>2047&&(a<55296||a>57343)&&(f=a);break;case 4:s=t[r+2],u=t[r+3],128==(192&(o=t[r+1]))&&128==(192&s)&&128==(192&u)&&(a=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&u)>65535&&a<1114112&&(f=a)}null===f?(f=65533,h=1):f>65535&&(i.push((f-=65536)>>>10&1023|55296),f=56320|1023&f),i.push(f),r+=h}return function(t){var n=t.length;if(n<=4096)return String.fromCharCode.apply(String,t);for(var e="",i=0;i<n;)e+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return e}(i)}function mt(t,n,e){var i="";e=Math.min(t.length,e);for(var r=n;r<e;++r)i+=String.fromCharCode(127&t[r]);return i}function wt(t,n,e){var i="";e=Math.min(t.length,e);for(var r=n;r<e;++r)i+=String.fromCharCode(t[r]);return i}function gt(t,n,e){var i,r=t.length;(!n||n<0)&&(n=0),(!e||e<0||e>r)&&(e=r);for(var o="",s=n;s<e;++s)o+=(i=t[s])<16?"0"+i.toString(16):i.toString(16);return o}function bt(t,n,e){for(var i=t.slice(n,e),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function yt(t,n,e){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+n>e)throw new RangeError("Trying to access beyond buffer length")}function kt(t,n,e,i,r,o){if(!et(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>r||n<o)throw new RangeError('"value" argument is out of bounds');if(e+i>t.length)throw new RangeError("Index out of range")}function xt(t,n,e,i){n<0&&(n=65535+n+1);for(var r=0,o=Math.min(t.length-e,2);r<o;++r)t[e+r]=(n&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function Et(t,n,e,i){n<0&&(n=4294967295+n+1);for(var r=0,o=Math.min(t.length-e,4);r<o;++r)t[e+r]=n>>>8*(i?r:3-r)&255}function Ct(t,n,e,i){if(e+i>t.length)throw new RangeError("Index out of range");if(e<0)throw new RangeError("Index out of range")}function Tt(t,n,e,i,r){return r||Ct(t,0,e,4),J(t,n,e,i,23,4),e+4}function St(t,n,e,i,r){return r||Ct(t,0,e,8),J(t,n,e,i,52,8),e+8}Y.TYPED_ARRAY_SUPPORT=void 0===L.TYPED_ARRAY_SUPPORT||L.TYPED_ARRAY_SUPPORT,Y.poolSize=8192,Y._augment=function(t){return t.__proto__=Y.prototype,t},Y.from=function(t,n,e){return Z(null,t,n,e)},Y.TYPED_ARRAY_SUPPORT&&(Y.prototype.__proto__=Uint8Array.prototype,Y.__proto__=Uint8Array),Y.alloc=function(t,n,e){return function(t,n,e,i){return K(n),n<=0?X(t,n):void 0!==e?"string"==typeof i?X(t,n).fill(e,i):X(t,n).fill(e):X(t,n)}(null,t,n,e)},Y.allocUnsafe=function(t){return Q(null,t)},Y.allocUnsafeSlow=function(t){return Q(null,t)},Y.isBuffer=function(t){return null!=t&&(!!t._isBuffer||_t(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&_t(t.slice(0,0))}(t))},Y.compare=function(t,n){if(!et(t)||!et(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;for(var e=t.length,i=n.length,r=0,o=Math.min(e,i);r<o;++r)if(t[r]!==n[r]){e=t[r],i=n[r];break}return e<i?-1:i<e?1:0},Y.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Y.concat=function(t,n){if(!V(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Y.alloc(0);var e;if(void 0===n)for(n=0,e=0;e<t.length;++e)n+=t[e].length;var i=Y.allocUnsafe(n),r=0;for(e=0;e<t.length;++e){var o=t[e];if(!et(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(i,r),r+=o.length}return i},Y.byteLength=it,Y.prototype._isBuffer=!0,Y.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)ot(this,n,n+1);return this},Y.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)ot(this,n,n+3),ot(this,n+1,n+2);return this},Y.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)ot(this,n,n+7),ot(this,n+1,n+6),ot(this,n+2,n+5),ot(this,n+3,n+4);return this},Y.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?pt(this,0,t):rt.apply(this,arguments)},Y.prototype.equals=function(t){if(!et(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Y.compare(this,t)},Y.prototype.inspect=function(){var t="";return this.length>0&&(t=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(t+=" ... ")),"<Buffer "+t+">"},Y.prototype.compare=function(t,n,e,i,r){if(!et(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===e&&(e=t?t.length:0),void 0===i&&(i=0),void 0===r&&(r=this.length),n<0||e>t.length||i<0||r>this.length)throw new RangeError("out of range index");if(i>=r&&n>=e)return 0;if(i>=r)return-1;if(n>=e)return 1;if(this===t)return 0;for(var o=(r>>>=0)-(i>>>=0),s=(e>>>=0)-(n>>>=0),u=Math.min(o,s),a=this.slice(i,r),c=t.slice(n,e),f=0;f<u;++f)if(a[f]!==c[f]){o=a[f],s=c[f];break}return o<s?-1:s<o?1:0},Y.prototype.includes=function(t,n,e){return-1!==this.indexOf(t,n,e)},Y.prototype.indexOf=function(t,n,e){return st(this,t,n,e,!0)},Y.prototype.lastIndexOf=function(t,n,e){return st(this,t,n,e,!1)},Y.prototype.write=function(t,n,e,i){if(void 0===n)i="utf8",e=this.length,n=0;else if(void 0===e&&"string"==typeof n)i=n,e=this.length,n=0;else{if(!isFinite(n))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");n|=0,isFinite(e)?(e|=0,void 0===i&&(i="utf8")):(i=e,e=void 0)}var r=this.length-n;if((void 0===e||e>r)&&(e=r),t.length>0&&(e<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");for(var o=!1;;)switch(i){case"hex":return at(this,t,n,e);case"utf8":case"utf-8":return ct(this,t,n,e);case"ascii":return ft(this,t,n,e);case"latin1":case"binary":return ht(this,t,n,e);case"base64":return lt(this,t,n,e);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return dt(this,t,n,e);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}},Y.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Y.prototype.slice=function(t,n){var e,i=this.length;if((t=~~t)<0?(t+=i)<0&&(t=0):t>i&&(t=i),(n=void 0===n?i:~~n)<0?(n+=i)<0&&(n=0):n>i&&(n=i),n<t&&(n=t),Y.TYPED_ARRAY_SUPPORT)(e=this.subarray(t,n)).__proto__=Y.prototype;else{var r=n-t;e=new Y(r,void 0);for(var o=0;o<r;++o)e[o]=this[o+t]}return e},Y.prototype.readUIntLE=function(t,n,e){t|=0,n|=0,e||yt(t,n,this.length);for(var i=this[t],r=1,o=0;++o<n&&(r*=256);)i+=this[t+o]*r;return i},Y.prototype.readUIntBE=function(t,n,e){t|=0,n|=0,e||yt(t,n,this.length);for(var i=this[t+--n],r=1;n>0&&(r*=256);)i+=this[t+--n]*r;return i},Y.prototype.readUInt8=function(t,n){return n||yt(t,1,this.length),this[t]},Y.prototype.readUInt16LE=function(t,n){return n||yt(t,2,this.length),this[t]|this[t+1]<<8},Y.prototype.readUInt16BE=function(t,n){return n||yt(t,2,this.length),this[t]<<8|this[t+1]},Y.prototype.readUInt32LE=function(t,n){return n||yt(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Y.prototype.readUInt32BE=function(t,n){return n||yt(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Y.prototype.readIntLE=function(t,n,e){t|=0,n|=0,e||yt(t,n,this.length);for(var i=this[t],r=1,o=0;++o<n&&(r*=256);)i+=this[t+o]*r;return i>=(r*=128)&&(i-=Math.pow(2,8*n)),i},Y.prototype.readIntBE=function(t,n,e){t|=0,n|=0,e||yt(t,n,this.length);for(var i=n,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*n)),o},Y.prototype.readInt8=function(t,n){return n||yt(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Y.prototype.readInt16LE=function(t,n){n||yt(t,2,this.length);var e=this[t]|this[t+1]<<8;return 32768&e?4294901760|e:e},Y.prototype.readInt16BE=function(t,n){n||yt(t,2,this.length);var e=this[t+1]|this[t]<<8;return 32768&e?4294901760|e:e},Y.prototype.readInt32LE=function(t,n){return n||yt(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Y.prototype.readInt32BE=function(t,n){return n||yt(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Y.prototype.readFloatLE=function(t,n){return n||yt(t,4,this.length),G(this,t,!0,23,4)},Y.prototype.readFloatBE=function(t,n){return n||yt(t,4,this.length),G(this,t,!1,23,4)},Y.prototype.readDoubleLE=function(t,n){return n||yt(t,8,this.length),G(this,t,!0,52,8)},Y.prototype.readDoubleBE=function(t,n){return n||yt(t,8,this.length),G(this,t,!1,52,8)},Y.prototype.writeUIntLE=function(t,n,e,i){t=+t,n|=0,e|=0,i||kt(this,t,n,e,Math.pow(2,8*e)-1,0);var r=1,o=0;for(this[n]=255&t;++o<e&&(r*=256);)this[n+o]=t/r&255;return n+e},Y.prototype.writeUIntBE=function(t,n,e,i){t=+t,n|=0,e|=0,i||kt(this,t,n,e,Math.pow(2,8*e)-1,0);var r=e-1,o=1;for(this[n+r]=255&t;--r>=0&&(o*=256);)this[n+r]=t/o&255;return n+e},Y.prototype.writeUInt8=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,1,255,0),Y.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=255&t,n+1},Y.prototype.writeUInt16LE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,2,65535,0),Y.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):xt(this,t,n,!0),n+2},Y.prototype.writeUInt16BE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,2,65535,0),Y.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):xt(this,t,n,!1),n+2},Y.prototype.writeUInt32LE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,4,4294967295,0),Y.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=255&t):Et(this,t,n,!0),n+4},Y.prototype.writeUInt32BE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,4,4294967295,0),Y.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):Et(this,t,n,!1),n+4},Y.prototype.writeIntLE=function(t,n,e,i){if(t=+t,n|=0,!i){var r=Math.pow(2,8*e-1);kt(this,t,n,e,r-1,-r)}var o=0,s=1,u=0;for(this[n]=255&t;++o<e&&(s*=256);)t<0&&0===u&&0!==this[n+o-1]&&(u=1),this[n+o]=(t/s>>0)-u&255;return n+e},Y.prototype.writeIntBE=function(t,n,e,i){if(t=+t,n|=0,!i){var r=Math.pow(2,8*e-1);kt(this,t,n,e,r-1,-r)}var o=e-1,s=1,u=0;for(this[n+o]=255&t;--o>=0&&(s*=256);)t<0&&0===u&&0!==this[n+o+1]&&(u=1),this[n+o]=(t/s>>0)-u&255;return n+e},Y.prototype.writeInt8=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,1,127,-128),Y.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=255&t,n+1},Y.prototype.writeInt16LE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,2,32767,-32768),Y.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):xt(this,t,n,!0),n+2},Y.prototype.writeInt16BE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,2,32767,-32768),Y.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):xt(this,t,n,!1),n+2},Y.prototype.writeInt32LE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,4,2147483647,-2147483648),Y.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):Et(this,t,n,!0),n+4},Y.prototype.writeInt32BE=function(t,n,e){return t=+t,n|=0,e||kt(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Y.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):Et(this,t,n,!1),n+4},Y.prototype.writeFloatLE=function(t,n,e){return Tt(this,t,n,!0,e)},Y.prototype.writeFloatBE=function(t,n,e){return Tt(this,t,n,!1,e)},Y.prototype.writeDoubleLE=function(t,n,e){return St(this,t,n,!0,e)},Y.prototype.writeDoubleBE=function(t,n,e){return St(this,t,n,!1,e)},Y.prototype.copy=function(t,n,e,i){if(e||(e=0),i||0===i||(i=this.length),n>=t.length&&(n=t.length),n||(n=0),i>0&&i<e&&(i=e),i===e)return 0;if(0===t.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(e<0||e>=this.length)throw new RangeError("sourceStart out of bounds");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),t.length-n<i-e&&(i=t.length-n+e);var r,o=i-e;if(this===t&&e<n&&n<i)for(r=o-1;r>=0;--r)t[r+n]=this[r+e];else if(o<1e3||!Y.TYPED_ARRAY_SUPPORT)for(r=0;r<o;++r)t[r+n]=this[r+e];else Uint8Array.prototype.set.call(t,this.subarray(e,e+o),n);return o},Y.prototype.fill=function(t,n,e,i){if("string"==typeof t){if("string"==typeof n?(i=n,n=0,e=this.length):"string"==typeof e&&(i=e,e=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==i&&"string"!=typeof i)throw new TypeError("encoding must be a string");if("string"==typeof i&&!Y.isEncoding(i))throw new TypeError("Unknown encoding: "+i)}else"number"==typeof t&&(t&=255);if(n<0||this.length<n||this.length<e)throw new RangeError("Out of range index");if(e<=n)return this;var o;if(n>>>=0,e=void 0===e?this.length:e>>>0,t||(t=0),"number"==typeof t)for(o=n;o<e;++o)this[o]=t;else{var s=et(t)?t:jt(new Y(t,i).toString()),u=s.length;for(o=0;o<e-n;++o)this[o+n]=s[o%u]}return this};var Ot=/[^+\/0-9A-Za-z-_]/g;function jt(t,n){var e;n=n||1/0;for(var i=t.length,r=null,o=[],s=0;s<i;++s){if((e=t.charCodeAt(s))>55295&&e<57344){if(!r){if(e>56319){(n-=3)>-1&&o.push(239,191,189);continue}if(s+1===i){(n-=3)>-1&&o.push(239,191,189);continue}r=e;continue}if(e<56320){(n-=3)>-1&&o.push(239,191,189),r=e;continue}e=65536+(r-55296<<10|e-56320)}else r&&(n-=3)>-1&&o.push(239,191,189);if(r=null,e<128){if((n-=1)<0)break;o.push(e)}else if(e<2048){if((n-=2)<0)break;o.push(e>>6|192,63&e|128)}else if(e<65536){if((n-=3)<0)break;o.push(e>>12|224,e>>6&63|128,63&e|128)}else{if(!(e<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;o.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}}return o}function It(t){return function(t){var n,e,i,r,o,s;W||z();var u=t.length;if(u%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s=new B(3*u/4-(o="="===t[u-2]?2:"="===t[u-1]?1:0)),i=o>0?u-4:u;var a=0;for(n=0,e=0;n<i;n+=4,e+=3)r=U[t.charCodeAt(n)]<<18|U[t.charCodeAt(n+1)]<<12|U[t.charCodeAt(n+2)]<<6|U[t.charCodeAt(n+3)],s[a++]=r>>16&255,s[a++]=r>>8&255,s[a++]=255&r;return 2===o?(r=U[t.charCodeAt(n)]<<2|U[t.charCodeAt(n+1)]>>4,s[a++]=255&r):1===o&&(r=U[t.charCodeAt(n)]<<10|U[t.charCodeAt(n+1)]<<4|U[t.charCodeAt(n+2)]>>2,s[a++]=r>>8&255,s[a++]=255&r),s}(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(Ot,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function Rt(t,n,e,i){for(var r=0;r<i&&!(r+e>=n.length||r>=t.length);++r)n[r+e]=t[r];return r}function _t(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}const At="function"==typeof Object.create?function(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,n){t.super_=n;var e=function(){};e.prototype=n.prototype,t.prototype=new e,t.prototype.constructor=t};var Pt=/%[sdj%]/g;function Dt(t){if(!Yt(t)){for(var n=[],e=0;e<arguments.length;e++)n.push(Ut(arguments[e]));return n.join(" ")}e=1;for(var i=arguments,r=i.length,o=String(t).replace(Pt,(function(t){if("%%"===t)return"%";if(e>=r)return t;switch(t){case"%s":return String(i[e++]);case"%d":return Number(i[e++]);case"%j":try{return JSON.stringify(i[e++])}catch(t){return"[Circular]"}default:return t}})),s=i[e];e<r;s=i[++e])Vt(s)||!tn(s)?o+=" "+s:o+=" "+Ut(s);return o}function Mt(t,n){if(Kt(L.process))return function(){return Mt(t,n).apply(this,arguments)};var e=!1;return function(){return e||(console.error(n),e=!0),t.apply(this,arguments)}}var Nt,Lt={};function Ft(t){return Kt(Nt)&&(Nt=""),t=t.toUpperCase(),Lt[t]||(Lt[t]=new RegExp("\\b"+t+"\\b","i").test(Nt)?function(){var n=Dt.apply(null,arguments);console.error("%s %d: %s",t,0,n)}:function(){}),Lt[t]}function Ut(t,n){var e={seen:[],stylize:Wt};return arguments.length>=3&&(e.depth=arguments[2]),arguments.length>=4&&(e.colors=arguments[3]),Ht(n)?e.showHidden=n:n&&ln(e,n),Kt(e.showHidden)&&(e.showHidden=!1),Kt(e.depth)&&(e.depth=2),Kt(e.colors)&&(e.colors=!1),Kt(e.customInspect)&&(e.customInspect=!0),e.colors&&(e.stylize=Bt),zt(e,t,e.depth)}function Bt(t,n){var e=Ut.styles[n];return e?"["+Ut.colors[e][0]+"m"+t+"["+Ut.colors[e][1]+"m":t}function Wt(t){return t}function zt(t,n,e){if(t.customInspect&&n&&rn(n.inspect)&&n.inspect!==Ut&&(!n.constructor||n.constructor.prototype!==n)){var i=n.inspect(e,t);return Yt(i)||(i=zt(t,i,e)),i}var r=function(t,n){if(Kt(n))return t.stylize("undefined","undefined");if(Yt(n)){var e="'"+JSON.stringify(n).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(e,"string")}return Xt(n)?t.stylize(""+n,"number"):Ht(n)?t.stylize(""+n,"boolean"):Vt(n)?t.stylize("null","null"):void 0}(t,n);if(r)return r;var o=Object.keys(n),s=function(t){var n={};return t.forEach((function(t){n[t]=!0})),n}(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(n)),en(n)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return qt(n);if(0===o.length){if(rn(n))return t.stylize("[Function"+(n.name?": "+n.name:"")+"]","special");if(Qt(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(nn(n))return t.stylize(Date.prototype.toString.call(n),"date");if(en(n))return qt(n)}var u,a="",c=!1,f=["{","}"];return Jt(n)&&(c=!0,f=["[","]"]),rn(n)&&(a=" [Function"+(n.name?": "+n.name:"")+"]"),Qt(n)&&(a=" "+RegExp.prototype.toString.call(n)),nn(n)&&(a=" "+Date.prototype.toUTCString.call(n)),en(n)&&(a=" "+qt(n)),0!==o.length||c&&0!=n.length?e<0?Qt(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=c?function(t,n,e,i,r){for(var o=[],s=0,u=n.length;s<u;++s)dn(n,String(s))?o.push(Gt(t,n,e,i,String(s),!0)):o.push("");return r.forEach((function(r){r.match(/^\d+$/)||o.push(Gt(t,n,e,i,r,!0))})),o}(t,n,e,s,o):o.map((function(i){return Gt(t,n,e,s,i,c)})),t.seen.pop(),function(t,n,e){return t.reduce((function(t,n){return n.indexOf("\n"),t+n.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?e[0]+(""===n?"":n+"\n ")+" "+t.join(",\n  ")+" "+e[1]:e[0]+n+" "+t.join(", ")+" "+e[1]}(u,a,f)):f[0]+a+f[1]}function qt(t){return"["+Error.prototype.toString.call(t)+"]"}function Gt(t,n,e,i,r,o){var s,u,a;if((a=Object.getOwnPropertyDescriptor(n,r)||{value:n[r]}).get?u=t.stylize(a.set?"[Getter/Setter]":"[Getter]","special"):a.set&&(u=t.stylize("[Setter]","special")),dn(i,r)||(s="["+r+"]"),u||(t.seen.indexOf(a.value)<0?(u=Vt(e)?zt(t,a.value,null):zt(t,a.value,e-1)).indexOf("\n")>-1&&(u=o?u.split("\n").map((function(t){return"  "+t})).join("\n").substr(2):"\n"+u.split("\n").map((function(t){return"   "+t})).join("\n")):u=t.stylize("[Circular]","special")),Kt(s)){if(o&&r.match(/^\d+$/))return u;(s=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=t.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=t.stylize(s,"string"))}return s+": "+u}function Jt(t){return Array.isArray(t)}function Ht(t){return"boolean"==typeof t}function Vt(t){return null===t}function $t(t){return null==t}function Xt(t){return"number"==typeof t}function Yt(t){return"string"==typeof t}function Zt(t){return"symbol"==typeof t}function Kt(t){return void 0===t}function Qt(t){return tn(t)&&"[object RegExp]"===un(t)}function tn(t){return"object"==typeof t&&null!==t}function nn(t){return tn(t)&&"[object Date]"===un(t)}function en(t){return tn(t)&&("[object Error]"===un(t)||t instanceof Error)}function rn(t){return"function"==typeof t}function on(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t}function sn(t){return Y.isBuffer(t)}function un(t){return Object.prototype.toString.call(t)}function an(t){return t<10?"0"+t.toString(10):t.toString(10)}Ut.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},Ut.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};var cn=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function fn(){var t=new Date,n=[an(t.getHours()),an(t.getMinutes()),an(t.getSeconds())].join(":");return[t.getDate(),cn[t.getMonth()],n].join(" ")}function hn(){console.log("%s - %s",fn(),Dt.apply(null,arguments))}function ln(t,n){if(!n||!tn(n))return t;for(var e=Object.keys(n),i=e.length;i--;)t[e[i]]=n[e[i]];return t}function dn(t,n){return Object.prototype.hasOwnProperty.call(t,n)}const vn=c(Object.freeze({__proto__:null,format:Dt,deprecate:Mt,debuglog:Ft,inspect:Ut,isArray:Jt,isBoolean:Ht,isNull:Vt,isNullOrUndefined:$t,isNumber:Xt,isString:Yt,isSymbol:Zt,isUndefined:Kt,isRegExp:Qt,isObject:tn,isDate:nn,isError:en,isFunction:rn,isPrimitive:on,isBuffer:sn,log:hn,inherits:At,_extend:ln,default:{inherits:At,_extend:ln,log:hn,isBuffer:sn,isPrimitive:on,isFunction:rn,isError:en,isDate:nn,isObject:tn,isRegExp:Qt,isUndefined:Kt,isSymbol:Zt,isString:Yt,isNumber:Xt,isNullOrUndefined:$t,isNull:Vt,isBoolean:Ht,isArray:Jt,inspect:Ut,deprecate:Mt,format:Dt,debuglog:Ft}}));var pn="undefined"!=typeof navigator&&navigator.mediaDevices;function mn(){N.call(this),this._defineEventHandler("devicechange"),this._defineEventHandler("deviceinfochange");var t=[];Object.defineProperties(this,{_deviceChangeIsNative:{value:gn(this,"devicechange")},_deviceInfoChangeIsNative:{value:gn(this,"deviceinfochange")},_knownDevices:{value:t},_pollInterval:{value:null,writable:!0}}),"function"==typeof pn.enumerateDevices&&pn.enumerateDevices().then((function(n){n.sort(bn).forEach([].push,t)})),this._eventEmitter.on("newListener",function(t){"devicechange"!==t&&"deviceinfochange"!==t||(this._pollInterval=this._pollInterval||setInterval(wn.bind(null,this),500))}.bind(this)),this._eventEmitter.on("removeListener",function(){var t;!this._pollInterval||(t=this,["devicechange","deviceinfochange"].reduce((function(n,e){return n+t._eventEmitter.listenerCount(e)}),0)>0)||(clearInterval(this._pollInterval),this._pollInterval=null)}.bind(this))}function wn(t){pn.enumerateDevices().then((function(n){var e=t._knownDevices,i=e.slice();[].splice.apply(e,[0,e.length].concat(n.sort(bn))),!t._deviceChangeIsNative&&function(t,n){return t.length!==n.length||("deviceId",e=n,t.some((function(t,n){return t.deviceId!==e[n].deviceId})));var e}(e,i)&&t.dispatchEvent(new Event("devicechange")),!t._deviceInfoChangeIsNative&&function(t,n){var e=n.reduce((function(t,n){return t.set(n.deviceId,n.label||null)}),new Map);return t.some((function(t){var n=e.get(t.deviceId);return void 0!==n&&n!==t.label}))}(e,i)&&t.dispatchEvent(new Event("deviceinfochange"))}))}function gn(t,n){var e="on"+n;function i(n){t.dispatchEvent(n)}return e in pn&&("addEventListener"in pn?pn.addEventListener(n,i):pn[e]=i,!0)}function bn(t,n){return t.deviceId<n.deviceId}(0,vn.inherits)(mn,N),pn&&"function"==typeof pn.enumerateDevices&&(mn.prototype.enumerateDevices=function(){return pn.enumerateDevices.apply(pn,arguments)}),mn.prototype.getUserMedia=function(){return pn.getUserMedia.apply(pn,arguments)};var yn=pn?new mn:null;function kn(t){if(!(this instanceof kn))return new kn(t);this.message=t}function xn(t){return!!t.userAgent.match("Electron")}function En(t,n){var e=!!n.userAgent.match("CriOS"),i=!!n.userAgent.match("HeadlessChrome"),r=void 0!==t.chrome&&"Google Inc."===n.vendor&&-1===n.userAgent.indexOf("OPR")&&-1===n.userAgent.indexOf("Edge");return e||xn(n)||r||i}function Cn(t){return!!(t=t||("undefined"==typeof window?u.navigator:window.navigator))&&"string"==typeof t.userAgent&&/firefox|fxios/i.test(t.userAgent)}function Tn(t){return!!t.vendor&&-1!==t.vendor.indexOf("Apple")&&t.userAgent&&-1===t.userAgent.indexOf("CriOS")&&-1===t.userAgent.indexOf("FxiOS")}kn.prototype.toString=function(){return"Twilio.Exception: "+this.message};var Sn={Exception:kn,average:function(t){return t&&t.length?t.reduce((function(t,n){return t+n}))/t.length:0},difference:function(t,n,e){e=e||function(t){return t};var i=new Set(n.map(e));return t.filter((function(t){return!i.has(e(t))}))},isElectron:xn,isChrome:En,isFirefox:Cn,isLegacyEdge:function(t){return!!(t=t||("undefined"==typeof window?u.navigator:window.navigator))&&"string"==typeof t.userAgent&&/edge\/\d+/i.test(t.userAgent)},isSafari:Tn,isUnifiedPlanDefault:function(t,n,e,i){if(void 0===t||void 0===n||void 0===e||void 0===i||void 0===e.prototype||void 0===i.prototype)return!1;if(En(t,n)&&e.prototype.addTransceiver){var r=new e,o=!0;try{r.addTransceiver("audio")}catch(t){o=!1}return r.close(),o}return!!Cn(n)||!!Tn(n)&&"currentDirection"in i.prototype},queryToJson:function(t){return t?t.split("&").reduce((function(t,n){var e=n.split("="),i=e[0],r=decodeURIComponent((e[1]||"").replace(/\+/g,"%20"));return i&&(t[i]=r),t}),{}):""},flatMap:function(t,n){var e=t instanceof Map||t instanceof Set?Array.from(t.values()):t;return n=n||function(t){return t},e.reduce((function(t,e){var i=n(e);return t.concat(i)}),[])}},On=function t(n){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),Object.defineProperties(this,{deviceId:{get:function(){return n.deviceId}},groupId:{get:function(){return n.groupId}},kind:{get:function(){return n.kind}},label:{get:function(){return n.label}}})},jn=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)});Object.defineProperty(n,"__esModule",{value:!0});var r={audioinput:"Audio Input",audiooutput:"Audio Output"},o=function(t){function n(n,e,i,r){var o=t.call(this)||this;o.availableInputDevices=new Map,o.availableOutputDevices=new Map,o._audioConstraints=null,o._inputDevice=null,o._inputStream=null,o._isPollingInputVolume=!1,o._log=_.default.getInstance(),o._unknownDeviceIndexes={audioinput:{},audiooutput:{}},o._removeLostInput=function(t){if(!o.inputDevice||o.inputDevice.deviceId!==t.deviceId)return!1;o._replaceStream(null),o._inputDevice=null,o._maybeStopPollingVolume();var n=o.availableInputDevices.get("default")||Array.from(o.availableInputDevices.values())[0];return n&&o.setInputDevice(n.deviceId),!0},o._removeLostOutput=function(t){var n=o.speakerDevices.delete(t),e=o.ringtoneDevices.delete(t);return n||e},o._updateAvailableDevices=function(){return o._mediaDevices?o._mediaDevices.enumerateDevices().then((function(t){o._updateDevices(t.filter((function(t){return"audiooutput"===t.kind})),o.availableOutputDevices,o._removeLostOutput),o._updateDevices(t.filter((function(t){return"audioinput"===t.kind})),o.availableInputDevices,o._removeLostInput);var n=o.availableOutputDevices.get("default")||Array.from(o.availableOutputDevices.values())[0];[o.speakerDevices,o.ringtoneDevices].forEach((function(t){!t.get().size&&o.availableOutputDevices.size&&o.isOutputSelectionSupported&&t.set(n.deviceId).catch((function(t){o._log.warn("Unable to set audio output devices. "+t)}))}))})):Promise.reject("Enumeration not supported")},r=Object.assign({AudioContext:"undefined"!=typeof AudioContext&&AudioContext,setSinkId:"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId},r),o._getUserMedia=i,o._mediaDevices=r.mediaDevices||yn,o._onActiveInputChanged=e;var s=!(!r.AudioContext&&!r.audioContext),u=!(!o._mediaDevices||!o._mediaDevices.enumerateDevices);return o.isOutputSelectionSupported=u&&"function"==typeof r.setSinkId,o.isVolumeSupported=s,r.enabledSounds&&o._addEnabledSounds(r.enabledSounds),o.isVolumeSupported&&(o._audioContext=r.audioContext||r.AudioContext&&new r.AudioContext,o._audioContext&&(o._inputVolumeAnalyser=o._audioContext.createAnalyser(),o._inputVolumeAnalyser.fftSize=32,o._inputVolumeAnalyser.smoothingTimeConstant=.3)),o.ringtoneDevices=new A.default("ringtone",o.availableOutputDevices,n,o.isOutputSelectionSupported),o.speakerDevices=new A.default("speaker",o.availableOutputDevices,n,o.isOutputSelectionSupported),o.addListener("newListener",(function(t){"inputVolume"===t&&o._maybeStartPollingVolume()})),o.addListener("removeListener",(function(t){"inputVolume"===t&&o._maybeStopPollingVolume()})),o.once("newListener",(function(){o.isOutputSelectionSupported||o._log.warn("Warning: This browser does not support audio output selection."),o.isVolumeSupported||o._log.warn("Warning: This browser does not support Twilio's volume indicator feature.")})),u&&o._initializeEnumeration(),o}return i(n,t),Object.defineProperty(n.prototype,"audioConstraints",{get:function(){return this._audioConstraints},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDevice",{get:function(){return this._inputDevice},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputStream",{get:function(){return this._inputStream},enumerable:!0,configurable:!0}),n.prototype._maybeStartPollingVolume=function(){var t=this;if(this.isVolumeSupported&&this._inputStream&&(this._updateVolumeSource(),!this._isPollingInputVolume&&this._inputVolumeAnalyser)){var n=new Uint8Array(this._inputVolumeAnalyser.frequencyBinCount);this._isPollingInputVolume=!0;var e=function(){if(t._isPollingInputVolume){if(t._inputVolumeAnalyser){t._inputVolumeAnalyser.getByteFrequencyData(n);var i=Sn.average(n);t.emit("inputVolume",i/255)}requestAnimationFrame(e)}};requestAnimationFrame(e)}},n.prototype._maybeStopPollingVolume=function(){this.isVolumeSupported&&(!this._isPollingInputVolume||this._inputStream&&this.listenerCount("inputVolume")||(this._inputVolumeSource&&(this._inputVolumeSource.disconnect(),delete this._inputVolumeSource),this._isPollingInputVolume=!1))},n.prototype._unbind=function(){if(!this._mediaDevices)throw new C.NotSupportedError("Enumeration is not supported");this._mediaDevices.removeEventListener&&(this._mediaDevices.removeEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.removeEventListener("deviceinfochange",this._updateAvailableDevices))},n.prototype.setAudioConstraints=function(t){return this._audioConstraints=Object.assign({},t),delete this._audioConstraints.deviceId,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},n.prototype.setInputDevice=function(t){return Sn.isFirefox()?Promise.reject(new C.NotSupportedError("Firefox does not currently support opening multiple audio input tracks simultaneously, even across different tabs. As a result, Device.audio.setInputDevice is disabled on Firefox until support is added.\nRelated BugZilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324")):this._setInputDevice(t,!1)},n.prototype.unsetAudioConstraints=function(){return this._audioConstraints=null,this.inputDevice?this._setInputDevice(this.inputDevice.deviceId,!0):Promise.resolve()},n.prototype.unsetInputDevice=function(){var t=this;return this.inputDevice?this._onActiveInputChanged(null).then((function(){t._replaceStream(null),t._inputDevice=null,t._maybeStopPollingVolume()})):Promise.resolve()},n.prototype._addEnabledSounds=function(t){var n=this;function e(n,e){return void 0!==e&&(t[n]=e),t[n]}Object.keys(t).forEach((function(t){n[t]=e.bind(null,t)}))},n.prototype._getUnknownDeviceIndex=function(t){var n=t.deviceId,e=t.kind,i=this._unknownDeviceIndexes[e][n];return i||(i=Object.keys(this._unknownDeviceIndexes[e]).length+1,this._unknownDeviceIndexes[e][n]=i),i},n.prototype._initializeEnumeration=function(){var t=this;if(!this._mediaDevices)throw new C.NotSupportedError("Enumeration is not supported");this._mediaDevices.addEventListener&&(this._mediaDevices.addEventListener("devicechange",this._updateAvailableDevices),this._mediaDevices.addEventListener("deviceinfochange",this._updateAvailableDevices)),this._updateAvailableDevices().then((function(){t.isOutputSelectionSupported&&Promise.all([t.speakerDevices.set("default"),t.ringtoneDevices.set("default")]).catch((function(n){t._log.warn("Warning: Unable to set audio output devices. "+n)}))}))},n.prototype._replaceStream=function(t){this._inputStream&&this._inputStream.getTracks().forEach((function(t){t.stop()})),this._inputStream=t},n.prototype._setInputDevice=function(t,n){var e=this;if("string"!=typeof t)return Promise.reject(new C.InvalidArgumentError("Must specify the device to set"));var i=this.availableInputDevices.get(t);if(!i)return Promise.reject(new C.InvalidArgumentError("Device not found: "+t));if(this._inputDevice&&this._inputDevice.deviceId===t&&this._inputStream){if(!n)return Promise.resolve();this._inputStream.getTracks().forEach((function(t){t.stop()}))}var r={audio:Object.assign({deviceId:{exact:t}},this.audioConstraints)};return this._getUserMedia(r).then((function(t){return e._onActiveInputChanged(t).then((function(){e._replaceStream(t),e._inputDevice=i,e._maybeStartPollingVolume()}))}))},n.prototype._updateDevices=function(t,n,e){var i=this,r=t.map((function(t){return t.deviceId})),o=Array.from(n.values()).map((function(t){return t.deviceId})),s=[],u=Sn.difference(o,r);u.forEach((function(t){var i=n.get(t);i&&(n.delete(t),e(i)&&s.push(i))}));var a=!1;t.forEach((function(t){var e=n.get(t.deviceId),r=i._wrapMediaDeviceInfo(t);e&&e.label===r.label||(n.set(t.deviceId,r),a=!0)})),(a||u.length)&&(null!==this.inputDevice&&"default"===this.inputDevice.deviceId&&(this._log.warn("Calling getUserMedia after device change to ensure that the           tracks of the active device (default) have not gone stale."),this._setInputDevice(this.inputDevice.deviceId,!0)),this.emit("deviceChange",s))},n.prototype._updateVolumeSource=function(){this._inputStream&&this._audioContext&&this._inputVolumeAnalyser&&(this._inputVolumeSource&&this._inputVolumeSource.disconnect(),this._inputVolumeSource=this._audioContext.createMediaStreamSource(this._inputStream),this._inputVolumeSource.connect(this._inputVolumeAnalyser))},n.prototype._wrapMediaDeviceInfo=function(t){var n={deviceId:t.deviceId,groupId:t.groupId,kind:t.kind,label:t.label};if(!n.label)if("default"===n.deviceId)n.label="Default";else{var e=this._getUnknownDeviceIndex(t);n.label="Unknown "+r[n.kind]+" Device "+e}return new On(n)},n}(P.EventEmitter);o||(o={}),n.default=o})),In=a((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var e={dtmf0:[1360,960],dtmf1:[1230,720],dtmf2:[1360,720],dtmf3:[1480,720],dtmf4:[1230,790],dtmf5:[1360,790],dtmf6:[1480,790],dtmf7:[1230,870],dtmf8:[1360,870],dtmf9:[1480,870],dtmfh:[1480,960],dtmfs:[1230,960]},i=function(){function t(t){var n=this;this._context=t,this._gainNodes=[],this._gainNodes=[this._context.createGain(),this._context.createGain()],this._gainNodes.forEach((function(t){t.connect(n._context.destination),t.gain.value=.1,n._gainNodes.push(t)}))}return t.prototype.cleanup=function(){this._gainNodes.forEach((function(t){t.disconnect()}))},t.prototype.play=function(t){var n=this,i=e[t];if(!i)throw new C.InvalidArgumentError("Invalid DTMF sound name");[this._context.createOscillator(),this._context.createOscillator()].forEach((function(t,e){t.type="sine",t.frequency.value=i[e],t.connect(n._gainNodes[e]),t.start(),t.stop(n._context.currentTime+.1),t.addEventListener("ended",(function(){return t.disconnect()}))}))},t}();n.default=i})),Rn="undefined"!=typeof window?window.RTCStatsReport:void 0;function _n(t){if(!(this instanceof _n))return new _n(t);var n=this;Object.defineProperties(this,{size:{enumerable:!0,get:function(){return n._map.size}},_map:{value:t}}),this[Symbol.iterator]=t[Symbol.iterator]}function An(t){return{type:"transport",id:t.id,timestamp:Date.parse(t.timestamp),bytesSent:void 0,bytesReceived:void 0,rtcpTransportStatsId:void 0,dtlsState:void 0,selectedCandidatePairId:t.stat("selectedCandidatePairId"),localCertificateId:t.stat("localCertificateId"),remoteCertificateId:t.stat("remoteCertificateId")}}function Pn(t,n){return{id:t.id,timestamp:Date.parse(t.timestamp),ssrc:t.stat("ssrc"),associateStatsId:void 0,isRemote:void 0,mediaType:t.stat("mediaType"),trackId:"track-"+t.id,transportId:t.stat("transportId"),codecId:"codec-"+t.id,firCount:n?Ln(t,"googFirsSent"):void 0,pliCount:Ln(t,n?"googPlisSent":"googPlisReceived"),nackCount:Ln(t,n?"googNacksSent":"googNacksReceived"),sliCount:void 0,qpSum:Ln(t,"qpSum")}}function Dn(t,n){return{type:n?"remote-candidate":"local-candidate",id:t.id,timestamp:Date.parse(t.timestamp),transportId:void 0,isRemote:n,ip:t.stat("ipAddress"),port:Ln(t,"portNumber"),protocol:t.stat("transport"),candidateType:Nn(t.stat("candidateType")),priority:Fn(t,"priority"),url:void 0,relayProtocol:void 0,deleted:void 0}}function Mn(t){return isNaN(t)||""===t?void 0:parseInt(t,10)/1e3}function Nn(t){switch(t){case"peerreflexive":return"prflx";case"serverreflexive":return"srflx";case"host":case"relay":default:return t}}function Ln(t,n){var e=t.stat(n);return Bn(t,n)?parseInt(e,10):void 0}function Fn(t,n){var e=t.stat(n);return Bn(t,n)?parseFloat(e):void 0}function Un(t,n){var e=t.stat(n);return Bn(t,n)?"true"===e||!0===e:void 0}function Bn(t,n){var e=t.stat(n);return void 0!==e&&""!==e}Rn&&((_n.prototype=Object.create(Rn.prototype)).constructor=_n),["entries","forEach","get","has","keys","values"].forEach((function(t){_n.prototype[t]=function(){for(var n,e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];return(n=this._map)[t].apply(n,e)}})),_n.fromArray=function(t){return new _n(t.reduce((function(t,n){return t.set(n.id,n),t}),new Map))},_n.fromRTCStatsResponse=function(t){var n,e=new Map,i=t.result().reduce((function(t,i){var r=i.id;switch(i.type){case"googCertificate":t.set(r,function(t){return{type:"certificate",id:t.id,timestamp:Date.parse(t.timestamp),fingerprint:t.stat("googFingerprint"),fingerprintAlgorithm:t.stat("googFingerprintAlgorithm"),base64Certificate:t.stat("googDerBase64"),issuerCertificateId:t.stat("googIssuerId")}}(i));break;case"datachannel":t.set(r,function(t){return{type:"data-channel",id:t.id,timestamp:Date.parse(t.timestamp),label:t.stat("label"),protocol:t.stat("protocol"),datachannelid:t.stat("datachannelid"),transportId:t.stat("transportId"),state:t.stat("state"),messagesSent:void 0,bytesSent:void 0,messagesReceived:void 0,bytesReceived:void 0}}(i));break;case"googCandidatePair":Un(i,"googActiveConnection")&&(n=r),t.set(r,function(t){return{type:"candidate-pair",id:t.id,timestamp:Date.parse(t.timestamp),transportId:t.stat("googChannelId"),localCandidateId:t.stat("localCandidateId"),remoteCandidateId:t.stat("remoteCandidateId"),state:void 0,priority:void 0,nominated:void 0,writable:Un(t,"googWritable"),readable:void 0,bytesSent:Ln(t,"bytesSent"),bytesReceived:Ln(t,"bytesReceived"),lastPacketSentTimestamp:void 0,lastPacketReceivedTimestamp:void 0,totalRoundTripTime:void 0,currentRoundTripTime:Mn(t.stat("googRtt")),availableOutgoingBitrate:void 0,availableIncomingBitrate:void 0,requestsReceived:Ln(t,"requestsReceived"),requestsSent:Ln(t,"requestsSent"),responsesReceived:Ln(t,"responsesReceived"),responsesSent:Ln(t,"responsesSent"),retransmissionsReceived:void 0,retransmissionsSent:void 0,consentRequestsSent:Ln(t,"consentRequestsSent")}}(i));break;case"localcandidate":t.set(r,Dn(i,!1));break;case"remotecandidate":t.set(r,Dn(i,!0));break;case"ssrc":Bn(i,"packetsReceived")?t.set("rtp-"+r,function(t){var n=Pn(t,!0);return Object.assign(n,{type:"inbound-rtp",packetsReceived:Ln(t,"packetsReceived"),bytesReceived:Ln(t,"bytesReceived"),packetsLost:Ln(t,"packetsLost"),jitter:Mn(t.stat("googJitterReceived")),fractionLost:void 0,roundTripTime:Mn(t.stat("googRtt")),packetsDiscarded:void 0,packetsRepaired:void 0,burstPacketsLost:void 0,burstPacketsDiscarded:void 0,burstLossCount:void 0,burstDiscardCount:void 0,burstLossRate:void 0,burstDiscardRate:void 0,gapLossRate:void 0,gapDiscardRate:void 0,framesDecoded:Ln(t,"framesDecoded")}),n}(i)):t.set("rtp-"+r,function(t){var n=Pn(t,!1);return Object.assign(n,{type:"outbound-rtp",remoteTimestamp:void 0,packetsSent:Ln(t,"packetsSent"),bytesSent:Ln(t,"bytesSent"),targetBitrate:void 0,framesEncoded:Ln(t,"framesEncoded")}),n}(i)),t.set("track-"+r,function(t){return{type:"track",id:t.id,timestamp:Date.parse(t.timestamp),trackIdentifier:t.stat("googTrackId"),remoteSource:void 0,ended:void 0,kind:t.stat("mediaType"),detached:void 0,ssrcIds:void 0,frameWidth:Bn(t,"googFrameWidthReceived")?Ln(t,"googFrameWidthReceived"):Ln(t,"googFrameWidthSent"),frameHeight:Bn(t,"googFrameHeightReceived")?Ln(t,"googFrameHeightReceived"):Ln(t,"googFrameHeightSent"),framesPerSecond:void 0,framesSent:Ln(t,"framesEncoded"),framesReceived:void 0,framesDecoded:Ln(t,"framesDecoded"),framesDropped:void 0,framesCorrupted:void 0,partialFramesLost:void 0,fullFramesLost:void 0,audioLevel:Bn(t,"audioOutputLevel")?Ln(t,"audioOutputLevel")/32767:(Ln(t,"audioInputLevel")||0)/32767,echoReturnLoss:Fn(t,"googEchoCancellationReturnLoss"),echoReturnLossEnhancement:Fn(t,"googEchoCancellationReturnLossEnhancement")}}(i)),t.set("codec-"+r,function(t){return{type:"codec",id:t.id,timestamp:Date.parse(t.timestamp),payloadType:void 0,mimeType:t.stat("mediaType")+"/"+t.stat("googCodecName"),clockRate:void 0,channels:void 0,sdpFmtpLine:void 0,implementation:void 0}}(i));break;case"googComponent":var o=An(i);e.set(o.selectedCandidatePairId,r),t.set(r,An(i))}return t}),new Map);if(n){var r=e.get(n);r&&(i.get(r).dtlsState="connected")}return new _n(i)};var Wn=_n,zn=u&&u.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],s=0,u=o.length;s<u;s++,r++)i[r]=o[s];return i},qn=C.NotSupportedError,Gn=C.InvalidArgumentError;function Jn(t){if(!t)return Promise.reject(new Gn("PeerConnection is null"));if("function"!=typeof t.getStats)return Promise.reject(new qn("WebRTC statistics are unsupported"));var n;try{n=t.getStats()}catch(e){n=new Promise((function(n){return t.getStats(n)})).then(Wn.fromRTCStatsResponse)}return n}function Hn(){}function Vn(t){var n,e=null,i=new Hn;Array.from(t.values()).forEach((function(r){if(!r.isRemote){var o=r.type.replace("-","");if(n=n||r.timestamp,r.remoteId){var s=t.get(r.remoteId);s&&s.roundTripTime&&(i.rtt=1e3*s.roundTripTime)}switch(o){case"inboundrtp":i.timestamp=i.timestamp||r.timestamp,i.jitter=1e3*r.jitter,i.packetsLost=r.packetsLost,i.packetsReceived=r.packetsReceived,i.bytesReceived=r.bytesReceived;break;case"outboundrtp":if(i.timestamp=r.timestamp,i.packetsSent=r.packetsSent,i.bytesSent=r.bytesSent,r.codecId){var u=t.get(r.codecId);i.codecName=u?u.mimeType&&u.mimeType.match(/(.*\/)?(.*)/)[2]:r.codecId}break;case"transport":e=r.id}}})),i.timestamp||(i.timestamp=n);var r=t.get(e);if(!r)return i;var o=t.get(r.selectedCandidatePairId);if(!o)return i;var s=t.get(o.localCandidateId),u=t.get(o.remoteCandidateId);return i.rtt||(i.rtt=o&&1e3*o.currentRoundTripTime),Object.assign(i,{localAddress:s&&s.ip,remoteAddress:u&&u.ip}),i}var $n=function(t,n){return n=Object.assign({createRTCSample:Vn},n),Jn(t).then(n.createRTCSample)},Xn=function(t){return Jn(t).then((function(t){var n,e=Array.from(t.values()).reduce((function(t,n){switch(["candidatePairs","localCandidates","remoteCandidates"].forEach((function(n){t[n]||(t[n]=[])})),n.type){case"candidate-pair":t.candidatePairs.push(n);break;case"local-candidate":t.localCandidates.push(n);break;case"remote-candidate":t.remoteCandidates.push(n);break;case"transport":n.selectedCandidatePairId&&(t.transport=n)}return t}),{}),i=e.localCandidates,r=e.remoteCandidates,o=e.transport,s=e.candidatePairs.find((function(t){return t.selected||o&&t.id===o.selectedCandidatePairId}));return s&&(n={localCandidate:i.find((function(t){return t.id===s.localCandidateId})),remoteCandidate:r.find((function(t){return t.id===s.remoteCandidateId}))}),{iceCandidateStats:zn(i,r),selectedIceCandidatePairStats:n}}))},Yn=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),r=u&&u.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},o=u&&u.__awaiter||function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,u)}a((i=i.apply(t,n||[])).next())}))},s=u&&u.__generator||function(t,n){var e,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=n.call(t,s)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var a=S,c=O,f=function(t){function n(e,i){var o=t.call(this)||this;return o._hasInsightsErrored=!1,o._networkTiming={},o._options={codecPreferences:[ji.default.Codec.PCMU,ji.default.Codec.Opus],debug:!1,edge:"roaming",fakeMicInput:!1,signalingTimeoutMs:1e4},o._status=n.Status.Connecting,Object.assign(o._options,i),o._samples=[],o._warnings=[],o._startTime=Date.now(),o._initDevice(e,r(r({},o._options),{fileInputStream:o._options.fakeMicInput?o._getStreamFromFile():void 0})),o}return i(n,t),n.prototype.stop=function(){var t=this,n={code:31008,message:"Call cancelled"};this._device?(this._device.once("offline",(function(){return t._onFailed(n)})),this._device.destroy()):this._onFailed(n)},n.prototype._emitWarning=function(t,e,i){var r={name:t,description:e};i&&(r.rtcWarning=i),this._warnings.push(r),this.emit(n.Events.Warning,r)},n.prototype._getCallQuality=function(t){return t>4.2?n.CallQuality.Excellent:t>=4.1&&t<=4.2?n.CallQuality.Great:t>=3.7&&t<=4?n.CallQuality.Good:t>=3.1&&t<=3.6?n.CallQuality.Fair:n.CallQuality.Degraded},n.prototype._getReport=function(){var t=this._getRTCStats(),n={start:this._startTime};this._endTime&&(n.end=this._endTime,n.duration=this._endTime-this._startTime);var e={callSid:this._callSid,edge:this._edge,iceCandidateStats:this._rtcIceCandidateStatsReport.iceCandidateStats,networkTiming:this._networkTiming,samples:this._samples,selectedEdge:this._options.edge,stats:t,testTiming:n,totals:this._getRTCSampleTotals(),warnings:this._warnings},i=this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;return i&&(e.selectedIceCandidatePairStats=i,e.isTurnRequired="relay"===i.localCandidate.candidateType||"relay"===i.remoteCandidate.candidateType),t&&(e.callQuality=this._getCallQuality(t.mos.average)),e},n.prototype._getRTCSampleTotals=function(){if(this._latestSample)return r({},this._latestSample.totals)},n.prototype._getRTCStats=function(){var t=this._samples.findIndex((function(t){return"number"==typeof t.mos&&t.mos>0})),n=t>=0?this._samples.slice(t):[];if(n&&n.length)return["jitter","mos","rtt"].reduce((function(t,e){var i,o=n.map((function(t){return t[e]}));return r(r({},t),((i={})[e]={average:Number((o.reduce((function(t,n){return t+n}))/o.length).toPrecision(5)),max:Math.max.apply(Math,o),min:Math.min.apply(Math,o)},i))}),{})},n.prototype._getStreamFromFile=function(){var t=this._options.audioContext;if(!t)throw new C.NotSupportedError("Cannot fake input audio stream: AudioContext is not supported by this browser.");var n=new Audio(a);n.addEventListener("canplaythrough",(function(){return n.play()})),"function"==typeof n.setAttribute&&n.setAttribute("crossorigin","anonymous");var e=t.createMediaElementSource(n),i=t.createMediaStreamDestination();return e.connect(i),i.stream},n.prototype._initDevice=function(t,n){var e=this;try{this._device=new(n.deviceFactory||Ei.default)(t,{codecPreferences:n.codecPreferences,debug:n.debug,edge:n.edge,fileInputStream:n.fileInputStream,iceServers:n.iceServers,preflight:!0,rtcConfiguration:n.rtcConfiguration})}catch(t){return void setTimeout((function(){e._onFailed(t)}))}this._device.once("ready",(function(){e._onDeviceReady()})),this._device.once("error",(function(t){e._onDeviceError(t)})),this._signalingTimeoutTimer=setTimeout((function(){e._onDeviceError({code:31901,message:"WebSocket - Connection Timeout"})}),n.signalingTimeoutMs)},n.prototype._onDeviceError=function(t){this._device.destroy(),this._onFailed(t)},n.prototype._onDeviceReady=function(){var t=this;if(clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._connection=this._device.connect(),this._networkTiming.signaling={start:Date.now()},this._setupConnectionHandlers(this._connection),this._edge=this._device.edge||void 0,this._options.fakeMicInput){this._echoTimer=setTimeout((function(){return t._device.disconnectAll()}),c);var n=this._device.audio;n&&(n.disconnect(!1),n.outgoing(!1))}this._device.once("disconnect",(function(){t._device.once("offline",(function(){return t._onOffline()})),t._device.destroy()})),this._connection._publisher.on("error",(function(){t._hasInsightsErrored||t._emitWarning("insights-connection-error","Received an error when attempting to connect to Insights gateway"),t._hasInsightsErrored=!0}))},n.prototype._onFailed=function(t){clearTimeout(this._echoTimer),clearTimeout(this._signalingTimeoutTimer),this._releaseHandlers(),this._endTime=Date.now(),this._status=n.Status.Failed,this.emit(n.Events.Failed,t)},n.prototype._onOffline=function(){var t=this;setTimeout((function(){t._status!==n.Status.Failed&&(clearTimeout(t._echoTimer),clearTimeout(t._signalingTimeoutTimer),t._releaseHandlers(),t._endTime=Date.now(),t._status=n.Status.Completed,t._report=t._getReport(),t.emit(n.Events.Completed,t._report))}),10)},n.prototype._releaseHandlers=function(){[this._device,this._connection].forEach((function(t){t&&t.eventNames().forEach((function(n){return t.removeAllListeners(n)}))}))},n.prototype._setupConnectionHandlers=function(t){var e=this;this._options.fakeMicInput&&t.once("volume",(function(){t.mediaStream.outputs.forEach((function(t){return t.audio.muted=!0}))})),t.on("warning",(function(t,n){e._emitWarning(t,"Received an RTCWarning. See .rtcWarning for the RTCWarning",n)})),t.once("accept",(function(){e._callSid=t.mediaStream.callSid,e._status=n.Status.Connected,e.emit(n.Events.Connected)})),t.on("sample",(function(i){return o(e,void 0,void 0,(function(){var e;return s(this,(function(r){switch(r.label){case 0:return this._latestSample?[3,2]:(e=this,[4,(this._options.getRTCIceCandidateStatsReport||Xn)(t.mediaStream.version.pc)]);case 1:e._rtcIceCandidateStatsReport=r.sent(),r.label=2;case 2:return this._latestSample=i,this._samples.push(i),this.emit(n.Events.Sample,i),[2]}}))}))})),[{reportLabel:"peerConnection",type:"pcconnection"},{reportLabel:"ice",type:"iceconnection"},{reportLabel:"dtls",type:"dtlstransport"},{reportLabel:"signaling",type:"signaling"}].forEach((function(n){var i=n.reportLabel,r="on"+n.type+"statechange",o=t.mediaStream[r];t.mediaStream[r]=function(t){var n=e._networkTiming[i]=e._networkTiming[i]||{start:0};"connecting"===t||"checking"===t?n.start=Date.now():"connected"!==t&&"stable"!==t||n.duration||(n.end=Date.now(),n.duration=n.end-n.start),o(t)}}))},Object.defineProperty(n.prototype,"callSid",{get:function(){return this._callSid},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"endTime",{get:function(){return this._endTime},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"latestSample",{get:function(){return this._latestSample},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"report",{get:function(){return this._report},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"startTime",{get:function(){return this._startTime},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"status",{get:function(){return this._status},enumerable:!0,configurable:!0}),n}(P.EventEmitter);n.PreflightTest=f,function(t){var n,e,i;(n=t.CallQuality||(t.CallQuality={})).Excellent="excellent",n.Great="great",n.Good="good",n.Fair="fair",n.Degraded="degraded",(e=t.Events||(t.Events={})).Completed="completed",e.Connected="connected",e.Failed="failed",e.Sample="sample",e.Warning="warning",(i=t.Status||(t.Status={})).Connecting="connecting",i.Connected="connected",i.Completed="completed",i.Failed="failed"}(f=n.PreflightTest||(n.PreflightTest={})),n.PreflightTest=f})),Zn=a((function(t,n){var e,i,r,o,s,u,a;function c(t){return t===n.defaultRegion?n.defaultChunderRegionURI:"chunderw-vpc-gll-"+t+".twilio.com"}Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.Au="au",t.Br="br",t.Ie="ie",t.Jp="jp",t.Sg="sg",t.UsOr="us-or",t.UsVa="us-va"}(s=n.DeprecatedRegion||(n.DeprecatedRegion={})),function(t){t.Sydney="sydney",t.SaoPaulo="sao-paulo",t.Dublin="dublin",t.Frankfurt="frankfurt",t.Tokyo="tokyo",t.Singapore="singapore",t.Ashburn="ashburn",t.Umatilla="umatilla",t.Roaming="roaming",t.AshburnIx="ashburn-ix",t.SanJoseIx="san-jose-ix",t.LondonIx="london-ix",t.FrankfurtIx="frankfurt-ix",t.SingaporeIx="singapore-ix",t.SydneyIx="sydney-ix",t.TokyoIx="tokyo-ix"}(u=n.Edge||(n.Edge={})),function(t){t.Au1="au1",t.Au1Ix="au1-ix",t.Br1="br1",t.De1="de1",t.De1Ix="de1-ix",t.Gll="gll",t.Ie1="ie1",t.Ie1Ix="ie1-ix",t.Ie1Tnx="ie1-tnx",t.Jp1="jp1",t.Jp1Ix="jp1-ix",t.Sg1="sg1",t.Sg1Ix="sg1-ix",t.Sg1Tnx="sg1-tnx",t.Us1="us1",t.Us1Ix="us1-ix",t.Us1Tnx="us1-tnx",t.Us2="us2",t.Us2Ix="us2-ix",t.Us2Tnx="us2-tnx"}(a=n.Region||(n.Region={})),n.deprecatedRegions=((e={})[s.Au]=a.Au1,e[s.Br]=a.Br1,e[s.Ie]=a.Ie1,e[s.Jp]=a.Jp1,e[s.Sg]=a.Sg1,e[s.UsOr]=a.Us1,e[s.UsVa]=a.Us1,e),n.regionShortcodes={ASIAPAC_SINGAPORE:a.Sg1,ASIAPAC_SYDNEY:a.Au1,ASIAPAC_TOKYO:a.Jp1,EU_FRANKFURT:a.De1,EU_IRELAND:a.Ie1,SOUTH_AMERICA_SAO_PAULO:a.Br1,US_EAST_VIRGINIA:a.Us1,US_WEST_OREGON:a.Us2},(i={})[a.Au1]="chunderw-vpc-gll-au1.twilio.com",i[a.Au1Ix]="chunderw-vpc-gll-au1-ix.twilio.com",i[a.Br1]="chunderw-vpc-gll-br1.twilio.com",i[a.De1]="chunderw-vpc-gll-de1.twilio.com",i[a.De1Ix]="chunderw-vpc-gll-de1-ix.twilio.com",i[a.Gll]="chunderw-vpc-gll.twilio.com",i[a.Ie1]="chunderw-vpc-gll-ie1.twilio.com",i[a.Ie1Ix]="chunderw-vpc-gll-ie1-ix.twilio.com",i[a.Ie1Tnx]="chunderw-vpc-gll-ie1-tnx.twilio.com",i[a.Jp1]="chunderw-vpc-gll-jp1.twilio.com",i[a.Jp1Ix]="chunderw-vpc-gll-jp1-ix.twilio.com",i[a.Sg1]="chunderw-vpc-gll-sg1.twilio.com",i[a.Sg1Ix]="chunderw-vpc-gll-sg1-ix.twilio.com",i[a.Sg1Tnx]="chunderw-vpc-gll-sg1-tnx.twilio.com",i[a.Us1]="chunderw-vpc-gll-us1.twilio.com",i[a.Us1Ix]="chunderw-vpc-gll-us1-ix.twilio.com",i[a.Us1Tnx]="chunderw-vpc-gll-us1-tnx.twilio.com",i[a.Us2]="chunderw-vpc-gll-us2.twilio.com",i[a.Us2Ix]="chunderw-vpc-gll-us2-ix.twilio.com",i[a.Us2Tnx]="chunderw-vpc-gll-us2-tnx.twilio.com",n.edgeToRegion=((r={})[u.Sydney]=a.Au1,r[u.SaoPaulo]=a.Br1,r[u.Dublin]=a.Ie1,r[u.Frankfurt]=a.De1,r[u.Tokyo]=a.Jp1,r[u.Singapore]=a.Sg1,r[u.Ashburn]=a.Us1,r[u.Umatilla]=a.Us2,r[u.Roaming]=a.Gll,r[u.AshburnIx]=a.Us1Ix,r[u.SanJoseIx]=a.Us2Ix,r[u.LondonIx]=a.Ie1Ix,r[u.FrankfurtIx]=a.De1Ix,r[u.SingaporeIx]=a.Sg1Ix,r[u.SydneyIx]=a.Au1Ix,r[u.TokyoIx]=a.Jp1Ix,r),n.regionToEdge=((o={})[a.Au1]=u.Sydney,o[a.Br1]=u.SaoPaulo,o[a.Ie1]=u.Dublin,o[a.De1]=u.Frankfurt,o[a.Jp1]=u.Tokyo,o[a.Sg1]=u.Singapore,o[a.Us1]=u.Ashburn,o[a.Us2]=u.Umatilla,o[a.Gll]=u.Roaming,o[a.Us1Ix]=u.AshburnIx,o[a.Us2Ix]=u.SanJoseIx,o[a.Ie1Ix]=u.LondonIx,o[a.De1Ix]=u.FrankfurtIx,o[a.Sg1Ix]=u.SingaporeIx,o[a.Au1Ix]=u.SydneyIx,o[a.Jp1Ix]=u.TokyoIx,o[a.Us1Tnx]=u.AshburnIx,o[a.Us2Tnx]=u.AshburnIx,o[a.Ie1Tnx]=u.LondonIx,o[a.Sg1Tnx]=u.SingaporeIx,o),n.defaultRegion="gll",n.defaultEdge=u.Roaming,n.defaultChunderRegionURI="chunderw-vpc-gll.twilio.com",n.getChunderURIs=function(t,e,i){if(e&&"string"!=typeof e)throw new C.InvalidArgumentError("If `region` is provided, it must be of type `string`.");if(t&&"string"!=typeof t&&!Array.isArray(t))throw new C.InvalidArgumentError("If `edge` is provided, it must be of type `string` or an array of strings.");var r,o=[];if(e&&t)throw new C.InvalidArgumentError("You cannot specify `region` when `edge` is specified in`Twilio.Device.Options`.");if(e){var f=e;o.push("Regions are deprecated in favor of edges. Please see this page for documentation: https://www.twilio.com/docs/voice/client/edges."),Object.values(s).includes(f)&&(f=n.deprecatedRegions[f]),Object.values(a).includes(f)&&o.push('Region "'+f+'" is deprecated, please use `edge` "'+n.regionToEdge[f]+'".'),r=[c(f)]}else if(t){var h=Object.values(u);r=(Array.isArray(t)?t:[t]).map((function(t){return h.includes(t)?c(n.edgeToRegion[t]):function(t){return"voice-js."+t+".twilio.com"}(t)}))}else r=[n.defaultChunderRegionURI];return i&&o.length&&setTimeout((function(){return i(o.join("\n"))})),r},n.getRegionShortcode=function(t){return n.regionShortcodes[t]||null}})),Kn={XMLHttpRequest}.XMLHttpRequest,Qn=function(t,n,e){var i={};i.XMLHttpRequest=i.XMLHttpRequest||Kn;var r=new i.XMLHttpRequest;for(var o in r.open(t,n.url,!0),r.onreadystatechange=function(){4===r.readyState&&(200<=r.status&&r.status<300?e(null,r.responseText):e(new Error(r.responseText)))},n.headers)r.setRequestHeader(o,n.headers[o]);r.send(JSON.stringify(n.body))};Qn.get=function(t,n){return new this("GET",t,n)},Qn.post=function(t,n){return new this("POST",t,n)};var te=Qn;function ne(t,n,e){if(!(this instanceof ne))return new ne(t,n,e);var i=(e=Object.assign({defaultPayload:function(){return{}},host:"eventgw.twilio.com"},e)).defaultPayload;"function"!=typeof i&&(i=function(){return Object.assign({},e.defaultPayload)});var r=!0,o=Object.assign({app_name:void 0,app_version:void 0},e.metadata);Object.defineProperties(this,{_defaultPayload:{value:i},_isEnabled:{get:function(){return r},set:function(t){r=t}},_host:{value:e.host},_request:{value:e.request||te,writable:!0},_token:{value:n,writable:!0},isEnabled:{enumerable:!0,get:function(){return r}},metadata:{enumerable:!0,get:function(){return o}},productName:{enumerable:!0,value:t},token:{enumerable:!0,get:function(){return this._token}}})}function ee(t){return{timestamp:new Date(t.timestamp).toISOString(),total_packets_received:t.totals.packetsReceived,total_packets_lost:t.totals.packetsLost,total_packets_sent:t.totals.packetsSent,total_bytes_received:t.totals.bytesReceived,total_bytes_sent:t.totals.bytesSent,packets_received:t.packetsReceived,packets_lost:t.packetsLost,packets_lost_fraction:t.packetsLostFraction&&Math.round(100*t.packetsLostFraction)/100,bytes_received:t.bytesReceived,bytes_sent:t.bytesSent,audio_codec:t.codecName,audio_level_in:t.audioInputLevel,audio_level_out:t.audioOutputLevel,call_volume_input:t.inputVolume,call_volume_output:t.outputVolume,jitter:t.jitter,rtt:t.rtt,mos:t.mos&&Math.round(100*t.mos)/100}}vn.inherits(ne,P.EventEmitter),ne.prototype._post=function(t,n,e,i,r,o,s){var u=this;if(!this.isEnabled&&!s)return Promise.resolve();if(!o||!(o.parameters&&o.parameters.CallSid||o.outboundConnectionId))return Promise.resolve();var a={publisher:this.productName,group:e,name:i,timestamp:(new Date).toISOString(),level:n.toUpperCase(),payload_type:"application/json",private:!1,payload:r&&r.forEach?r.slice(0):Object.assign(this._defaultPayload(o),r)};this.metadata&&(a.publisher_metadata=this.metadata);var c={url:"https://"+this._host+"/v4/"+t,body:a,headers:{"Content-Type":"application/json","X-Twilio-Token":this.token}},f=this;return new Promise((function(t,n){f._request.post(c,(function(e){e?(u.emit("error",e),n(e)):t()}))}))},ne.prototype.post=function(t,n,e,i,r,o){return this._post("EndpointEvents",t,n,e,i,r,o)},ne.prototype.debug=function(t,n,e,i){return this.post("debug",t,n,e,i)},ne.prototype.info=function(t,n,e,i){return this.post("info",t,n,e,i)},ne.prototype.warn=function(t,n,e,i){return this.post("warning",t,n,e,i)},ne.prototype.error=function(t,n,e,i){return this.post("error",t,n,e,i)},ne.prototype.postMetrics=function(t,n,e,i,r){var o=this;return new Promise((function(s){var u=e.map(ee).map((function(t){return Object.assign(t,i)}));s(o._post("EndpointMetrics","info",t,n,u,r))}))},ne.prototype.setToken=function(t){this._token=t},ne.prototype.enable=function(){this._isEnabled=!0},ne.prototype.disable=function(){this._isEnabled=!1};var ie=ne,re=WebSocket;function oe(t){Error.call(this,t),this.message=t}function se(t){Error.call(this,t),this.message=t}vn.inherits(oe,Error),oe.prototype.name="IllegalArgumentError",vn.inherits(se,Error),se.prototype.name="IllegalStateError";var ue={IllegalStateError:se,IllegalArgumentError:oe},ae=a((function(t){var n=t.exports=ue;function e(t,n,e,i){var r=new t(vn.format.apply(this,[e=e||""].concat(i)));throw Error.captureStackTrace(r,n),r}function i(t,i,r){e(n.IllegalArgumentError,t,i,r)}function r(t,i,r){e(n.IllegalStateError,t,i,r)}function o(t){var n=typeof t;if("object"==n){if(!t)return"null";if(t instanceof Array)return"array"}return n}function s(t){return function(n,e){var r=o(n);if(r==t)return n;i(arguments.callee,e||'Expected "'+t+'" but got "'+r+'".',Array.prototype.slice.call(arguments,2))}}t.exports.checkArgument=function(t,n){t||i(arguments.callee,n,Array.prototype.slice.call(arguments,2))},t.exports.checkState=function(t,n){t||r(arguments.callee,n,Array.prototype.slice.call(arguments,2))},t.exports.checkIsDef=function(t,n){if(void 0!==t)return t;i(arguments.callee,n||"Expected value to be defined but was undefined.",Array.prototype.slice.call(arguments,2))},t.exports.checkIsDefAndNotNull=function(t,n){if(null!=t)return t;i(arguments.callee,n||'Expected value to be defined and not null but got "'+o(t)+'".',Array.prototype.slice.call(arguments,2))},t.exports.checkIsString=s("string"),t.exports.checkIsArray=s("array"),t.exports.checkIsNumber=s("number"),t.exports.checkIsBoolean=s("boolean"),t.exports.checkIsFunction=s("function"),t.exports.checkIsObject=s("object")}));function ce(t){P.EventEmitter.call(this),this.backoffStrategy_=t,this.maxNumberOfRetry_=-1,this.backoffNumber_=0,this.backoffDelay_=0,this.timeoutID_=-1,this.handlers={backoff:this.onBackoff_.bind(this)}}vn.inherits(ce,P.EventEmitter),ce.prototype.failAfter=function(t){ae.checkArgument(t>0,"Expected a maximum number of retry greater than 0 but got %s.",t),this.maxNumberOfRetry_=t},ce.prototype.backoff=function(t){ae.checkState(-1===this.timeoutID_,"Backoff in progress."),this.backoffNumber_===this.maxNumberOfRetry_?(this.emit("fail",t),this.reset()):(this.backoffDelay_=this.backoffStrategy_.next(),this.timeoutID_=setTimeout(this.handlers.backoff,this.backoffDelay_),this.emit("backoff",this.backoffNumber_,this.backoffDelay_,t))},ce.prototype.onBackoff_=function(){this.timeoutID_=-1,this.emit("ready",this.backoffNumber_,this.backoffDelay_),this.backoffNumber_++},ce.prototype.reset=function(){this.backoffNumber_=0,this.backoffStrategy_.reset(),clearTimeout(this.timeoutID_),this.timeoutID_=-1};var fe=ce;function he(t){return null!=t}function le(t){if(he((t=t||{}).initialDelay)&&t.initialDelay<1)throw new Error("The initial timeout must be greater than 0.");if(he(t.maxDelay)&&t.maxDelay<1)throw new Error("The maximal timeout must be greater than 0.");if(this.initialDelay_=t.initialDelay||100,this.maxDelay_=t.maxDelay||1e4,this.maxDelay_<=this.initialDelay_)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");if(he(t.randomisationFactor)&&(t.randomisationFactor<0||t.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");this.randomisationFactor_=t.randomisationFactor||0}le.prototype.getMaxDelay=function(){return this.maxDelay_},le.prototype.getInitialDelay=function(){return this.initialDelay_},le.prototype.next=function(){var t=this.next_(),n=1+Math.random()*this.randomisationFactor_;return Math.round(t*n)},le.prototype.next_=function(){throw new Error("BackoffStrategy.next_() unimplemented.")},le.prototype.reset=function(){this.reset_()},le.prototype.reset_=function(){throw new Error("BackoffStrategy.reset_() unimplemented.")};var de=le;function ve(t){de.call(this,t),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay(),this.factor_=ve.DEFAULT_FACTOR,t&&void 0!==t.factor&&(ae.checkArgument(t.factor>1,"Exponential factor should be greater than 1 but got %s.",t.factor),this.factor_=t.factor)}vn.inherits(ve,de),ve.DEFAULT_FACTOR=2,ve.prototype.next_=function(){return this.backoffDelay_=Math.min(this.nextBackoffDelay_,this.getMaxDelay()),this.nextBackoffDelay_=this.backoffDelay_*this.factor_,this.backoffDelay_},ve.prototype.reset_=function(){this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()};var pe=ve;function me(t){de.call(this,t),this.backoffDelay_=0,this.nextBackoffDelay_=this.getInitialDelay()}vn.inherits(me,de),me.prototype.next_=function(){var t=Math.min(this.nextBackoffDelay_,this.getMaxDelay());return this.nextBackoffDelay_+=this.backoffDelay_,this.backoffDelay_=t,t},me.prototype.reset_=function(){this.nextBackoffDelay_=this.getInitialDelay(),this.backoffDelay_=0};var we=me;function ge(t,n,e){P.EventEmitter.call(this),ae.checkIsFunction(t,"Expected fn to be a function."),ae.checkIsArray(n,"Expected args to be an array."),ae.checkIsFunction(e,"Expected callback to be a function."),this.function_=t,this.arguments_=n,this.callback_=e,this.lastResult_=[],this.numRetries_=0,this.backoff_=null,this.strategy_=null,this.failAfter_=-1,this.retryPredicate_=ge.DEFAULT_RETRY_PREDICATE_,this.state_=ge.State_.PENDING}vn.inherits(ge,P.EventEmitter),ge.State_={PENDING:0,RUNNING:1,COMPLETED:2,ABORTED:3},ge.DEFAULT_RETRY_PREDICATE_=function(){return!0},ge.prototype.isPending=function(){return this.state_==ge.State_.PENDING},ge.prototype.isRunning=function(){return this.state_==ge.State_.RUNNING},ge.prototype.isCompleted=function(){return this.state_==ge.State_.COMPLETED},ge.prototype.isAborted=function(){return this.state_==ge.State_.ABORTED},ge.prototype.setStrategy=function(t){return ae.checkState(this.isPending(),"FunctionCall in progress."),this.strategy_=t,this},ge.prototype.retryIf=function(t){return ae.checkState(this.isPending(),"FunctionCall in progress."),this.retryPredicate_=t,this},ge.prototype.getLastResult=function(){return this.lastResult_.concat()},ge.prototype.getNumRetries=function(){return this.numRetries_},ge.prototype.failAfter=function(t){return ae.checkState(this.isPending(),"FunctionCall in progress."),this.failAfter_=t,this},ge.prototype.abort=function(){this.isCompleted()||this.isAborted()||(this.isRunning()&&this.backoff_.reset(),this.state_=ge.State_.ABORTED,this.lastResult_=[new Error("Backoff aborted.")],this.emit("abort"),this.doCallback_())},ge.prototype.start=function(t){ae.checkState(!this.isAborted(),"FunctionCall is aborted."),ae.checkState(this.isPending(),"FunctionCall already started.");var n=this.strategy_||new we;this.backoff_=t?t(n):new fe(n),this.backoff_.on("ready",this.doCall_.bind(this,!0)),this.backoff_.on("fail",this.doCallback_.bind(this)),this.backoff_.on("backoff",this.handleBackoff_.bind(this)),this.failAfter_>0&&this.backoff_.failAfter(this.failAfter_),this.state_=ge.State_.RUNNING,this.doCall_(!1)},ge.prototype.doCall_=function(t){t&&this.numRetries_++;var n=["call"].concat(this.arguments_);P.EventEmitter.prototype.emit.apply(this,n);var e=this.handleFunctionCallback_.bind(this);this.function_.apply(null,this.arguments_.concat(e))},ge.prototype.doCallback_=function(){this.callback_.apply(null,this.lastResult_)},ge.prototype.handleFunctionCallback_=function(){if(!this.isAborted()){var t=Array.prototype.slice.call(arguments);this.lastResult_=t,P.EventEmitter.prototype.emit.apply(this,["callback"].concat(t));var n=t[0];n&&this.retryPredicate_(n)?this.backoff_.backoff(n):(this.state_=ge.State_.COMPLETED,this.doCallback_())}},ge.prototype.handleBackoff_=function(t,n,e){this.emit("backoff",t,n,e)};var be=function(t){return new fe(new pe(t))},ye=a((function(t,n){var e,i,r=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)});Object.defineProperty(n,"__esModule",{value:!0}),function(t){t.Connecting="connecting",t.Closed="closed",t.Open="open"}(i=n.WSTransportState||(n.WSTransportState={}));var o=function(t){function n(n,e){void 0===e&&(e={});var r=t.call(this)||this;r.state=i.Closed,r._log=_.default.getInstance(),r._shouldFallback=!1,r._uriIndex=0,r._moveUriIndex=function(){r._uriIndex++,r._uriIndex>=r._uris.length&&(r._uriIndex=0)},r._onSocketClose=function(t){r._log.info("Received websocket close event code: "+t.code+". Reason: "+t.reason),(1006===t.code||1015===t.code)&&(r.emit("error",{code:31005,message:t.reason||"Websocket connection to Twilio's signaling servers were unexpectedly ended. If this is happening consistently, there may be an issue resolving the hostname provided. If a region or an edge is being specified in Device setup, ensure it is valid.",twilioError:new C.SignalingErrors.ConnectionError}),!r._shouldFallback&&(r.state===i.Open||r._previousState===i.Open)||r._moveUriIndex(),r._shouldFallback=!0),r._closeSocket()},r._onSocketError=function(t){r._log.info("WebSocket received error: "+t.message),r.emit("error",{code:31e3,message:t.message||"WSTransport socket error",twilioError:new C.SignalingErrors.ConnectionDisconnected})},r._onSocketMessage=function(t){r._setHeartbeatTimeout(),r._socket&&"\n"===t.data?r._socket.send("\n"):r.emit("message",t)},r._onSocketOpen=function(){r._log.info("WebSocket opened successfully."),r._timeOpened=Date.now(),r._shouldFallback=!1,r._setState(i.Open),clearTimeout(r._connectTimeout),r._setHeartbeatTimeout(),r.emit("open")},r._connectTimeoutMs=e.connectTimeoutMs||5e3;var o=100;n&&n.length>1&&(o=Math.floor(4001*Math.random())+1e3);var s={factor:2,initialDelay:o,maxDelay:"number"==typeof e.backoffMaxMs?Math.max(e.backoffMaxMs,3e3):2e4,randomisationFactor:.4};return r._log.info("Initializing transport backoff using config: ",s),r._backoff=be(s),r._uris=n,r._WebSocket=e.WebSocket||re,r._backoff.on("backoff",(function(t,n){r.state!==i.Closed&&r._log.info("Will attempt to reconnect WebSocket in "+n+"ms")})),r._backoff.on("ready",(function(t){r.state!==i.Closed&&r._connect(t+1)})),r}return r(n,t),n.prototype.close=function(){this._log.info("WSTransport.close() called..."),this._close()},n.prototype.open=function(){this._log.info("WSTransport.open() called..."),!this._socket||this._socket.readyState!==re.CONNECTING&&this._socket.readyState!==re.OPEN?this._connect():this._log.info("WebSocket already open.")},n.prototype.send=function(t){if(!this._socket||this._socket.readyState!==re.OPEN)return!1;try{this._socket.send(t)}catch(t){return this._log.info("Error while sending message:",t.message),this._closeSocket(),!1}return!0},n.prototype._close=function(){this._setState(i.Closed),this._closeSocket()},n.prototype._closeSocket=function(){clearTimeout(this._connectTimeout),clearTimeout(this._heartbeatTimeout),this._log.info("Closing and cleaning up WebSocket..."),this._socket?(this._socket.removeEventListener("close",this._onSocketClose),this._socket.removeEventListener("error",this._onSocketError),this._socket.removeEventListener("message",this._onSocketMessage),this._socket.removeEventListener("open",this._onSocketOpen),this._socket.readyState!==re.CONNECTING&&this._socket.readyState!==re.OPEN||this._socket.close(),this._timeOpened&&Date.now()-this._timeOpened>1e4&&this._backoff.reset(),this._backoff.backoff(),delete this._socket,this.emit("close")):this._log.info("No WebSocket to clean up.")},n.prototype._connect=function(t){var n=this;this._log.info(t?"Attempting to reconnect (retry #"+t+")...":"Attempting to connect..."),this._closeSocket(),this._setState(i.Connecting);var e=null;try{e=new this._WebSocket(this._uris[this._uriIndex])}catch(t){return this._log.info("Could not connect to endpoint:",t.message),this._close(),void this.emit("error",{code:31e3,message:t.message||"Could not connect to "+this._uris[this._uriIndex],twilioError:new C.SignalingErrors.ConnectionDisconnected})}delete this._timeOpened,this._connectTimeout=setTimeout((function(){n._log.info("WebSocket connection attempt timed out."),n._moveUriIndex(),n._closeSocket()}),this._connectTimeoutMs),e.addEventListener("close",this._onSocketClose),e.addEventListener("error",this._onSocketError),e.addEventListener("message",this._onSocketMessage),e.addEventListener("open",this._onSocketOpen),this._socket=e},n.prototype._setHeartbeatTimeout=function(){var t=this;clearTimeout(this._heartbeatTimeout),this._heartbeatTimeout=setTimeout((function(){t._log.info("No messages received in 15 seconds. Reconnecting..."),t._shouldFallback=!0,t._closeSocket()}),15e3)},n.prototype._setState=function(t){this._previousState=this.state,this.state=t},Object.defineProperty(n.prototype,"uri",{get:function(){return this._uris[this._uriIndex]},enumerable:!0,configurable:!0}),n}(P.EventEmitter);n.default=o})),ke=_.default,xe=ye.default,Ee=C.GeneralErrors,Ce=C.SignalingErrors;function Te(t,n,e){if(!(this instanceof Te))return new Te(t,n,e);var i={TransportFactory:xe};for(var r in e=e||{},i)r in e||(e[r]=i[r]);this.options=e,this.token=t||"",this.status="disconnected",this.gateway=null,this.region=null,this._messageQueue=[],this._uris=n,this._handleTransportClose=this._handleTransportClose.bind(this),this._handleTransportError=this._handleTransportError.bind(this),this._handleTransportMessage=this._handleTransportMessage.bind(this),this._handleTransportOpen=this._handleTransportOpen.bind(this),this._log=ke.getInstance(),this.on("error",(function(){}));var o=this;return this.addListener("ready",(function(){o.status="ready"})),this.addListener("offline",(function(){o.status="offline"})),this.addListener("close",(function(){o._log.info('Received "close" from server. Destroying PStream...'),o._destroy()})),this.transport=new this.options.TransportFactory(this._uris,{backoffMaxMs:this.options.backoffMaxMs}),Object.defineProperties(this,{uri:{enumerable:!0,get:function(){return this.transport.uri}}}),this.transport.on("close",this._handleTransportClose),this.transport.on("error",this._handleTransportError),this.transport.on("message",this._handleTransportMessage),this.transport.on("open",this._handleTransportOpen),this.transport.open(),this}vn.inherits(Te,P.EventEmitter),Te.prototype._handleTransportClose=function(){this.emit("transportClose"),"disconnected"!==this.status&&("offline"!==this.status&&this.emit("offline",this),this.status="disconnected")},Te.prototype._handleTransportError=function(t){this.emit("error",t?void 0!==t.code?{error:t}:t:{error:{code:31e3,message:"Websocket closed without a provided reason",twilioError:new Ce.ConnectionDisconnected}})},Te.prototype._handleTransportMessage=function(t){if(t&&t.data&&"string"==typeof t.data){var n=JSON.parse(t.data),e=n.type,i=n.payload,r=void 0===i?{}:i;this.gateway=r.gateway||this.gateway,this.region=r.region||this.region,"error"===e&&r.error&&(r.error.twilioError=new Ce.ConnectionError),this.emit(e,r)}},Te.prototype._handleTransportOpen=function(){var t=this;this.status="connected",this.setToken(this.token),this._messageQueue.splice(0,this._messageQueue.length).forEach((function(n){return t._publish.apply(t,function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(n))}))},Te.toString=function(){return"[Twilio.PStream class]"},Te.prototype.toString=function(){return"[Twilio.PStream instance]"},Te.prototype.setToken=function(t){this._log.info("Setting token and publishing listen"),this.token=t;var n,e,i={token:t,browserinfo:(n="undefined"!=typeof navigator?navigator:{},e={p:"browser",v:I,browser:{userAgent:n.userAgent||"unknown",platform:n.platform||"unknown"},plugin:"rtc"},e)};this._publish("listen",i)},Te.prototype.register=function(t){this._publish("register",{media:t},!0)},Te.prototype.invite=function(t,n,e,i){this._publish("invite",{callsid:n,sdp:t,preflight:!!e,twilio:i?{params:i}:{}},!0)},Te.prototype.answer=function(t,n){this._publish("answer",{sdp:t,callsid:n},!0)},Te.prototype.dtmf=function(t,n){this._publish("dtmf",{callsid:t,dtmf:n},!0)},Te.prototype.hangup=function(t,n){this._publish("hangup",n?{callsid:t,message:n}:{callsid:t},!0)},Te.prototype.reject=function(t){this._publish("reject",{callsid:t},!0)},Te.prototype.reinvite=function(t,n){this._publish("reinvite",{sdp:t,callsid:n},!1)},Te.prototype._destroy=function(){this.transport.removeListener("close",this._handleTransportClose),this.transport.removeListener("error",this._handleTransportError),this.transport.removeListener("message",this._handleTransportMessage),this.transport.removeListener("open",this._handleTransportOpen),this.transport.close(),this.emit("offline",this)},Te.prototype.destroy=function(){return this._log.info("PStream.destroy() called..."),this._destroy(),this},Te.prototype.publish=function(t,n){return this._publish(t,n,!0)},Te.prototype._publish=function(t,n,e){var i=JSON.stringify({type:t,version:"1.5",payload:n});this.transport.send(i)||(this.emit("error",{error:{code:31009,message:"No transport available to send or receive messages",twilioError:new Ee.TransportError}}),e&&this._messageQueue.push([t,n,!0]))};var Se=Te,Oe=a((function(t){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(t){return t.trim().split("\n").map((function(t){return t.trim()}))},n.splitSections=function(t){return t.split("\nm=").map((function(t,n){return(n>0?"m="+t:t).trim()+"\r\n"}))},n.getDescription=function(t){var e=n.splitSections(t);return e&&e[0]},n.getMediaSections=function(t){var e=n.splitSections(t);return e.shift(),e},n.matchPrefix=function(t,e){return n.splitLines(t).filter((function(t){return 0===t.indexOf(e)}))},n.parseCandidate=function(t){for(var n,e={foundation:(n=0===t.indexOf("a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:parseInt(n[1],10),protocol:n[2].toLowerCase(),priority:parseInt(n[3],10),ip:n[4],address:n[4],port:parseInt(n[5],10),type:n[7]},i=8;i<n.length;i+=2)switch(n[i]){case"raddr":e.relatedAddress=n[i+1];break;case"rport":e.relatedPort=parseInt(n[i+1],10);break;case"tcptype":e.tcpType=n[i+1];break;case"ufrag":e.ufrag=n[i+1],e.usernameFragment=n[i+1];break;default:e[n[i]]=n[i+1]}return e},n.writeCandidate=function(t){var n=[];n.push(t.foundation),n.push(t.component),n.push(t.protocol.toUpperCase()),n.push(t.priority),n.push(t.address||t.ip),n.push(t.port);var e=t.type;return n.push("typ"),n.push(e),"host"!==e&&t.relatedAddress&&t.relatedPort&&(n.push("raddr"),n.push(t.relatedAddress),n.push("rport"),n.push(t.relatedPort)),t.tcpType&&"tcp"===t.protocol.toLowerCase()&&(n.push("tcptype"),n.push(t.tcpType)),(t.usernameFragment||t.ufrag)&&(n.push("ufrag"),n.push(t.usernameFragment||t.ufrag)),"candidate:"+n.join(" ")},n.parseIceOptions=function(t){return t.substr(14).split(" ")},n.parseRtpMap=function(t){var n=t.substr(9).split(" "),e={payloadType:parseInt(n.shift(),10)};return n=n[0].split("/"),e.name=n[0],e.clockRate=parseInt(n[1],10),e.channels=3===n.length?parseInt(n[2],10):1,e.numChannels=e.channels,e},n.writeRtpMap=function(t){var n=t.payloadType;void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType);var e=t.channels||t.numChannels||1;return"a=rtpmap:"+n+" "+t.name+"/"+t.clockRate+(1!==e?"/"+e:"")+"\r\n"},n.parseExtmap=function(t){var n=t.substr(9).split(" ");return{id:parseInt(n[0],10),direction:n[0].indexOf("/")>0?n[0].split("/")[1]:"sendrecv",uri:n[1]}},n.writeExtmap=function(t){return"a=extmap:"+(t.id||t.preferredId)+(t.direction&&"sendrecv"!==t.direction?"/"+t.direction:"")+" "+t.uri+"\r\n"},n.parseFmtp=function(t){for(var n,e={},i=t.substr(t.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)e[(n=i[r].trim().split("="))[0].trim()]=n[1];return e},n.writeFmtp=function(t){var n="",e=t.payloadType;if(void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var i=[];Object.keys(t.parameters).forEach((function(n){i.push(t.parameters[n]?n+"="+t.parameters[n]:n)})),n+="a=fmtp:"+e+" "+i.join(";")+"\r\n"}return n},n.parseRtcpFb=function(t){var n=t.substr(t.indexOf(" ")+1).split(" ");return{type:n.shift(),parameter:n.join(" ")}},n.writeRtcpFb=function(t){var n="",e=t.payloadType;return void 0!==t.preferredPayloadType&&(e=t.preferredPayloadType),t.rtcpFeedback&&t.rtcpFeedback.length&&t.rtcpFeedback.forEach((function(t){n+="a=rtcp-fb:"+e+" "+t.type+(t.parameter&&t.parameter.length?" "+t.parameter:"")+"\r\n"})),n},n.parseSsrcMedia=function(t){var n=t.indexOf(" "),e={ssrc:parseInt(t.substr(7,n-7),10)},i=t.indexOf(":",n);return i>-1?(e.attribute=t.substr(n+1,i-n-1),e.value=t.substr(i+1)):e.attribute=t.substr(n+1),e},n.parseSsrcGroup=function(t){var n=t.substr(13).split(" ");return{semantics:n.shift(),ssrcs:n.map((function(t){return parseInt(t,10)}))}},n.getMid=function(t){var e=n.matchPrefix(t,"a=mid:")[0];if(e)return e.substr(6)},n.parseFingerprint=function(t){var n=t.substr(14).split(" ");return{algorithm:n[0].toLowerCase(),value:n[1]}},n.getDtlsParameters=function(t,e){return{role:"auto",fingerprints:n.matchPrefix(t+e,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(t,n){var e="a=setup:"+n+"\r\n";return t.fingerprints.forEach((function(t){e+="a=fingerprint:"+t.algorithm+" "+t.value+"\r\n"})),e},n.parseCryptoLine=function(t){var n=t.substr(9).split(" ");return{tag:parseInt(n[0],10),cryptoSuite:n[1],keyParams:n[2],sessionParams:n.slice(3)}},n.writeCryptoLine=function(t){return"a=crypto:"+t.tag+" "+t.cryptoSuite+" "+("object"==typeof t.keyParams?n.writeCryptoKeyParams(t.keyParams):t.keyParams)+(t.sessionParams?" "+t.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(t){if(0!==t.indexOf("inline:"))return null;var n=t.substr(7).split("|");return{keyMethod:"inline",keySalt:n[0],lifeTime:n[1],mkiValue:n[2]?n[2].split(":")[0]:void 0,mkiLength:n[2]?n[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(t){return t.keyMethod+":"+t.keySalt+(t.lifeTime?"|"+t.lifeTime:"")+(t.mkiValue&&t.mkiLength?"|"+t.mkiValue+":"+t.mkiLength:"")},n.getCryptoParameters=function(t,e){return n.matchPrefix(t+e,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(t,e){var i=n.matchPrefix(t+e,"a=ice-ufrag:")[0],r=n.matchPrefix(t+e,"a=ice-pwd:")[0];return i&&r?{usernameFragment:i.substr(12),password:r.substr(10)}:null},n.writeIceParameters=function(t){return"a=ice-ufrag:"+t.usernameFragment+"\r\na=ice-pwd:"+t.password+"\r\n"},n.parseRtpParameters=function(t){for(var e={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(t)[0].split(" "),r=3;r<i.length;r++){var o=i[r],s=n.matchPrefix(t,"a=rtpmap:"+o+" ")[0];if(s){var u=n.parseRtpMap(s),a=n.matchPrefix(t,"a=fmtp:"+o+" ");switch(u.parameters=a.length?n.parseFmtp(a[0]):{},u.rtcpFeedback=n.matchPrefix(t,"a=rtcp-fb:"+o+" ").map(n.parseRtcpFb),e.codecs.push(u),u.name.toUpperCase()){case"RED":case"ULPFEC":e.fecMechanisms.push(u.name.toUpperCase())}}}return n.matchPrefix(t,"a=extmap:").forEach((function(t){e.headerExtensions.push(n.parseExtmap(t))})),e},n.writeRtpDescription=function(t,e){var i="";i+="m="+t+" ",i+=e.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=e.codecs.map((function(t){return void 0!==t.preferredPayloadType?t.preferredPayloadType:t.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",e.codecs.forEach((function(t){i+=n.writeRtpMap(t),i+=n.writeFmtp(t),i+=n.writeRtcpFb(t)}));var r=0;return e.codecs.forEach((function(t){t.maxptime>r&&(r=t.maxptime)})),r>0&&(i+="a=maxptime:"+r+"\r\n"),i+="a=rtcp-mux\r\n",e.headerExtensions&&e.headerExtensions.forEach((function(t){i+=n.writeExtmap(t)})),i},n.parseRtpEncodingParameters=function(t){var e,i=[],r=n.parseRtpParameters(t),o=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),u=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute})),a=u.length>0&&u[0].ssrc,c=n.matchPrefix(t,"a=ssrc-group:FID").map((function(t){return t.substr(17).split(" ").map((function(t){return parseInt(t,10)}))}));c.length>0&&c[0].length>1&&c[0][0]===a&&(e=c[0][1]),r.codecs.forEach((function(t){if("RTX"===t.name.toUpperCase()&&t.parameters.apt){var n={ssrc:a,codecPayloadType:parseInt(t.parameters.apt,10)};a&&e&&(n.rtx={ssrc:e}),i.push(n),o&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:a,mechanism:s?"red+ulpfec":"red"},i.push(n))}})),0===i.length&&a&&i.push({ssrc:a});var f=n.matchPrefix(t,"b=");return f.length&&(f=0===f[0].indexOf("b=TIAS:")?parseInt(f[0].substr(7),10):0===f[0].indexOf("b=AS:")?1e3*parseInt(f[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(t){t.maxBitrate=f}))),i},n.parseRtcpParameters=function(t){var e={},i=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"cname"===t.attribute}))[0];i&&(e.cname=i.value,e.ssrc=i.ssrc);var r=n.matchPrefix(t,"a=rtcp-rsize");e.reducedSize=r.length>0,e.compound=0===r.length;var o=n.matchPrefix(t,"a=rtcp-mux");return e.mux=o.length>0,e},n.parseMsid=function(t){var e,i=n.matchPrefix(t,"a=msid:");if(1===i.length)return{stream:(e=i[0].substr(7).split(" "))[0],track:e[1]};var r=n.matchPrefix(t,"a=ssrc:").map((function(t){return n.parseSsrcMedia(t)})).filter((function(t){return"msid"===t.attribute}));return r.length>0?{stream:(e=r[0].value.split(" "))[0],track:e[1]}:void 0},n.parseSctpDescription=function(t){var e,i=n.parseMLine(t),r=n.matchPrefix(t,"a=max-message-size:");r.length>0&&(e=parseInt(r[0].substr(19),10)),isNaN(e)&&(e=65536);var o=n.matchPrefix(t,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:i.fmt,maxMessageSize:e};if(n.matchPrefix(t,"a=sctpmap:").length>0){var s=n.matchPrefix(t,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(s[0],10),protocol:s[1],maxMessageSize:e}}},n.writeSctpDescription=function(t,n){var e=[];return e="DTLS/SCTP"!==t.protocol?["m="+t.kind+" 9 "+t.protocol+" "+n.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+n.port+"\r\n"]:["m="+t.kind+" 9 "+t.protocol+" "+n.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+n.port+" "+n.protocol+" 65535\r\n"],void 0!==n.maxMessageSize&&e.push("a=max-message-size:"+n.maxMessageSize+"\r\n"),e.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(t,e,i){var r=void 0!==e?e:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(t||n.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(t,e,i,r){var o=n.writeRtpDescription(t.kind,e);if(o+=n.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=n.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),o+="a=mid:"+t.mid+"\r\n",o+=t.direction?"a="+t.direction+"\r\n":t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var s="msid:"+r.id+" "+t.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+s,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),o},n.getDirection=function(t,e){for(var i=n.splitLines(t),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return e?n.getDirection(e):"sendrecv"},n.getKind=function(t){return n.splitLines(t)[0].split(" ")[0].substr(2)},n.isRejected=function(t){return"0"===t.split(" ",2)[1]},n.parseMLine=function(t){var e=n.splitLines(t)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},n.parseOLine=function(t){var e=n.matchPrefix(t,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},n.isValidSDP=function(t){if("string"!=typeof t||0===t.length)return!1;for(var e=n.splitLines(t),i=0;i<e.length;i++)if(e[i].length<2||"="!==e[i].charAt(1))return!1;return!0},t.exports=n}));function je(t,n,e,i,r){var o=Oe.writeRtpDescription(t.kind,n);if(o+=Oe.writeIceParameters(t.iceGatherer.getLocalParameters()),o+=Oe.writeDtlsParameters(t.dtlsTransport.getLocalParameters(),"offer"===e?"actpass":r||"active"),o+="a=mid:"+t.mid+"\r\n",o+=t.rtpSender&&t.rtpReceiver?"a=sendrecv\r\n":t.rtpSender?"a=sendonly\r\n":t.rtpReceiver?"a=recvonly\r\n":"a=inactive\r\n",t.rtpSender){var s=t.rtpSender._initialTrackId||t.rtpSender.track.id;t.rtpSender._initialTrackId=s;var u="msid:"+(i?i.id:"-")+" "+s+"\r\n";o+="a="+u,o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" "+u,t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" "+u,o+="a=ssrc-group:FID "+t.sendEncodingParameters[0].ssrc+" "+t.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+t.sendEncodingParameters[0].ssrc+" cname:"+Oe.localCName+"\r\n",t.rtpSender&&t.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+t.sendEncodingParameters[0].rtx.ssrc+" cname:"+Oe.localCName+"\r\n"),o}function Ie(t,n){var e={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(t,n){t=parseInt(t,10);for(var e=0;e<n.length;e++)if(n[e].payloadType===t||n[e].preferredPayloadType===t)return n[e]},r=function(t,n,e,r){var o=i(t.parameters.apt,e),s=i(n.parameters.apt,r);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return t.codecs.forEach((function(i){for(var o=0;o<n.codecs.length;o++){var s=n.codecs[o];if(i.name.toLowerCase()===s.name.toLowerCase()&&i.clockRate===s.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&s.parameters.apt&&!r(i,s,t.codecs,n.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(i.numChannels,s.numChannels),e.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter((function(t){for(var n=0;n<i.rtcpFeedback.length;n++)if(i.rtcpFeedback[n].type===t.type&&i.rtcpFeedback[n].parameter===t.parameter)return!0;return!1}));break}}})),t.headerExtensions.forEach((function(t){for(var i=0;i<n.headerExtensions.length;i++){var r=n.headerExtensions[i];if(t.uri===r.uri){e.headerExtensions.push(r);break}}})),e}function Re(t,n,e){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[n][t].indexOf(e)}function _e(t,n){var e=t.getRemoteCandidates().find((function(t){return n.foundation===t.foundation&&n.ip===t.ip&&n.port===t.port&&n.priority===t.priority&&n.protocol===t.protocol&&n.type===t.type}));return e||t.addRemoteCandidate(n),!e}function Ae(t,n){var e=new Error(n);return e.name=t,e}var Pe=function(t,n){function e(n,e){e.addTrack(n),e.dispatchEvent(new t.MediaStreamTrackEvent("addtrack",{track:n}))}function i(n,e,i,r){var o=new Event("track");o.track=e,o.receiver=i,o.transceiver={receiver:i},o.streams=r,t.setTimeout((function(){n._dispatchEvent("track",o)}))}var r=function(e){var i=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(t){i[t]=r[t].bind(r)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",e=JSON.parse(JSON.stringify(e||{})),this.usingBundle="max-bundle"===e.bundlePolicy,"negotiate"===e.rtcpMuxPolicy)throw Ae("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(e.rtcpMuxPolicy||(e.rtcpMuxPolicy="require"),e.iceTransportPolicy){case"all":case"relay":break;default:e.iceTransportPolicy="all"}switch(e.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:e.bundlePolicy="balanced"}if(e.iceServers=function(t,n){var e=!1;return(t=JSON.parse(JSON.stringify(t))).filter((function(t){if(t&&(t.urls||t.url)){var i=t.urls||t.url;t.url&&!t.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter((function(t){return 0!==t.indexOf("turn:")||-1===t.indexOf("transport=udp")||-1!==t.indexOf("turn:[")||e?0===t.indexOf("stun:")&&n>=14393&&-1===t.indexOf("?transport=udp"):(e=!0,!0)})),delete t.url,t.urls=r?i[0]:i,!!i.length}}))}(e.iceServers||[],n),this._iceGatherers=[],e.iceCandidatePoolSize)for(var o=e.iceCandidatePoolSize;o>0;o--)this._iceGatherers.push(new t.RTCIceGatherer({iceServers:e.iceServers,gatherPolicy:e.iceTransportPolicy}));else e.iceCandidatePoolSize=0;this._config=e,this.transceivers=[],this._sdpSessionId=Oe.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};r.prototype.onicecandidate=null,r.prototype.onaddstream=null,r.prototype.ontrack=null,r.prototype.onremovestream=null,r.prototype.onsignalingstatechange=null,r.prototype.oniceconnectionstatechange=null,r.prototype.onicegatheringstatechange=null,r.prototype.onnegotiationneeded=null,r.prototype.ondatachannel=null,r.prototype._dispatchEvent=function(t,n){this._isClosed||(this.dispatchEvent(n),"function"==typeof this["on"+t]&&this["on"+t](n))},r.prototype._emitGatheringStateChange=function(){var t=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",t)},r.prototype.getConfiguration=function(){return this._config},r.prototype.getLocalStreams=function(){return this.localStreams},r.prototype.getRemoteStreams=function(){return this.remoteStreams},r.prototype._createTransceiver=function(t){var n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:t,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&this.transceivers.length>0)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var e=this._createIceAndDtlsTransports();n.iceTransport=e.iceTransport,n.dtlsTransport=e.dtlsTransport}return this.transceivers.push(n),n},r.prototype.addTrack=function(n,e){if(this._isClosed)throw Ae("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find((function(t){return t.track===n})))throw Ae("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==n.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(n.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(e)&&this.localStreams.push(e),i.track=n,i.stream=e,i.rtpSender=new t.RTCRtpSender(n,i.dtlsTransport),i.rtpSender},r.prototype.addStream=function(t){var e=this;if(n>=15025)t.getTracks().forEach((function(n){e.addTrack(n,t)}));else{var i=t.clone();t.getTracks().forEach((function(t,n){var e=i.getTracks()[n];t.addEventListener("enabled",(function(t){e.enabled=t.enabled}))})),i.getTracks().forEach((function(t){e.addTrack(t,i)}))}},r.prototype.removeTrack=function(n){if(this._isClosed)throw Ae("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(n instanceof t.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var e=this.transceivers.find((function(t){return t.rtpSender===n}));if(!e)throw Ae("InvalidAccessError","Sender was not created by this connection.");var i=e.stream;e.rtpSender.stop(),e.rtpSender=null,e.track=null,e.stream=null,-1===this.transceivers.map((function(t){return t.stream})).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},r.prototype.removeStream=function(t){var n=this;t.getTracks().forEach((function(t){var e=n.getSenders().find((function(n){return n.track===t}));e&&n.removeTrack(e)}))},r.prototype.getSenders=function(){return this.transceivers.filter((function(t){return!!t.rtpSender})).map((function(t){return t.rtpSender}))},r.prototype.getReceivers=function(){return this.transceivers.filter((function(t){return!!t.rtpReceiver})).map((function(t){return t.rtpReceiver}))},r.prototype._createIceGatherer=function(n,e){var i=this;if(e&&n>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new t.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[n].bufferedCandidateEvents=[],this.transceivers[n].bufferCandidates=function(t){var e=!t.candidate||0===Object.keys(t.candidate).length;r.state=e?"completed":"gathering",null!==i.transceivers[n].bufferedCandidateEvents&&i.transceivers[n].bufferedCandidateEvents.push(t)},r.addEventListener("localcandidate",this.transceivers[n].bufferCandidates),r},r.prototype._gather=function(n,e){var i=this,r=this.transceivers[e].iceGatherer;if(!r.onlocalcandidate){var o=this.transceivers[e].bufferedCandidateEvents;this.transceivers[e].bufferedCandidateEvents=null,r.removeEventListener("localcandidate",this.transceivers[e].bufferCandidates),r.onlocalcandidate=function(t){if(!(i.usingBundle&&e>0)){var o=new Event("icecandidate");o.candidate={sdpMid:n,sdpMLineIndex:e};var s=t.candidate,u=!s||0===Object.keys(s).length;if(u)"new"!==r.state&&"gathering"!==r.state||(r.state="completed");else{"new"===r.state&&(r.state="gathering"),s.component=1;var a=Oe.writeCandidate(s);o.candidate=Object.assign(o.candidate,Oe.parseCandidate(a)),o.candidate.candidate=a}var c=Oe.getMediaSections(i.localDescription.sdp);c[o.candidate.sdpMLineIndex]+=u?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",i.localDescription.sdp=Oe.getDescription(i.localDescription.sdp)+c.join("");var f=i.transceivers.every((function(t){return t.iceGatherer&&"completed"===t.iceGatherer.state}));"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),u||i._dispatchEvent("icecandidate",o),f&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},t.setTimeout((function(){o.forEach((function(t){r.onlocalcandidate(t)}))}),0)}},r.prototype._createIceAndDtlsTransports=function(){var n=this,e=new t.RTCIceTransport(null);e.onicestatechange=function(){n._updateConnectionState()};var i=new t.RTCDtlsTransport(e);return i.ondtlsstatechange=function(){n._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),n._updateConnectionState()},{iceTransport:e,dtlsTransport:i}},r.prototype._disposeIceAndDtlsTransports=function(t){var n=this.transceivers[t].iceGatherer;n&&(delete n.onlocalcandidate,delete this.transceivers[t].iceGatherer);var e=this.transceivers[t].iceTransport;e&&(delete e.onicestatechange,delete this.transceivers[t].iceTransport);var i=this.transceivers[t].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[t].dtlsTransport)},r.prototype._transceive=function(t,e,i){var r=Ie(t.localCapabilities,t.remoteCapabilities);e&&t.rtpSender&&(r.encodings=t.sendEncodingParameters,r.rtcp={cname:Oe.localCName,compound:t.rtcpParameters.compound},t.recvEncodingParameters.length&&(r.rtcp.ssrc=t.recvEncodingParameters[0].ssrc),t.rtpSender.send(r)),i&&t.rtpReceiver&&r.codecs.length>0&&("video"===t.kind&&t.recvEncodingParameters&&n<15019&&t.recvEncodingParameters.forEach((function(t){delete t.rtx})),r.encodings=t.recvEncodingParameters.length?t.recvEncodingParameters:[{}],r.rtcp={compound:t.rtcpParameters.compound},t.rtcpParameters.cname&&(r.rtcp.cname=t.rtcpParameters.cname),t.sendEncodingParameters.length&&(r.rtcp.ssrc=t.sendEncodingParameters[0].ssrc),t.rtpReceiver.receive(r))},r.prototype.setLocalDescription=function(t){var n,e,i=this;if(-1===["offer","answer"].indexOf(t.type))return Promise.reject(Ae("TypeError",'Unsupported type "'+t.type+'"'));if(!Re("setLocalDescription",t.type,i.signalingState)||i._isClosed)return Promise.reject(Ae("InvalidStateError","Can not set local "+t.type+" in state "+i.signalingState));if("offer"===t.type)n=Oe.splitSections(t.sdp),e=n.shift(),n.forEach((function(t,n){var e=Oe.parseRtpParameters(t);i.transceivers[n].localCapabilities=e})),i.transceivers.forEach((function(t,n){i._gather(t.mid,n)}));else if("answer"===t.type){n=Oe.splitSections(i.remoteDescription.sdp),e=n.shift();var r=Oe.matchPrefix(e,"a=ice-lite").length>0;n.forEach((function(t,n){var o=i.transceivers[n],s=o.iceGatherer,u=o.iceTransport,a=o.dtlsTransport,c=o.localCapabilities,f=o.remoteCapabilities;if(!(Oe.isRejected(t)&&0===Oe.matchPrefix(t,"a=bundle-only").length||o.isDatachannel)){var h=Oe.getIceParameters(t,e),l=Oe.getDtlsParameters(t,e);r&&(l.role="server"),i.usingBundle&&0!==n||(i._gather(o.mid,n),"new"===u.state&&u.start(s,h,r?"controlling":"controlled"),"new"===a.state&&a.start(l));var d=Ie(c,f);i._transceive(o,d.codecs.length>0,!1)}}))}return i.localDescription={type:t.type,sdp:t.sdp},i._updateSignalingState("offer"===t.type?"have-local-offer":"stable"),Promise.resolve()},r.prototype.setRemoteDescription=function(r){var o=this;if(-1===["offer","answer"].indexOf(r.type))return Promise.reject(Ae("TypeError",'Unsupported type "'+r.type+'"'));if(!Re("setRemoteDescription",r.type,o.signalingState)||o._isClosed)return Promise.reject(Ae("InvalidStateError","Can not set remote "+r.type+" in state "+o.signalingState));var s={};o.remoteStreams.forEach((function(t){s[t.id]=t}));var u=[],a=Oe.splitSections(r.sdp),c=a.shift(),f=Oe.matchPrefix(c,"a=ice-lite").length>0,h=Oe.matchPrefix(c,"a=group:BUNDLE ").length>0;o.usingBundle=h;var l=Oe.matchPrefix(c,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!l&&l.substr(14).split(" ").indexOf("trickle")>=0,a.forEach((function(i,a){var l=Oe.splitLines(i),d=Oe.getKind(i),v=Oe.isRejected(i)&&0===Oe.matchPrefix(i,"a=bundle-only").length,p=l[0].substr(2).split(" ")[2],m=Oe.getDirection(i,c),w=Oe.parseMsid(i),g=Oe.getMid(i)||Oe.generateIdentifier();if("application"!==d||"DTLS/SCTP"!==p){var b,y,k,x,E,C,T,S,O,j,I,R=Oe.parseRtpParameters(i);v||(j=Oe.getIceParameters(i,c),(I=Oe.getDtlsParameters(i,c)).role="client"),T=Oe.parseRtpEncodingParameters(i);var _=Oe.parseRtcpParameters(i),A=Oe.matchPrefix(i,"a=end-of-candidates",c).length>0,P=Oe.matchPrefix(i,"a=candidate:").map((function(t){return Oe.parseCandidate(t)})).filter((function(t){return 1===t.component}));if(("offer"===r.type||"answer"===r.type)&&!v&&h&&a>0&&o.transceivers[a]&&(o._disposeIceAndDtlsTransports(a),o.transceivers[a].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[a].iceTransport=o.transceivers[0].iceTransport,o.transceivers[a].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[a].rtpSender&&o.transceivers[a].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[a].rtpReceiver&&o.transceivers[a].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==r.type||v)"answer"!==r.type||v||(y=(b=o.transceivers[a]).iceGatherer,k=b.iceTransport,x=b.dtlsTransport,E=b.rtpReceiver,C=b.sendEncodingParameters,S=b.localCapabilities,o.transceivers[a].recvEncodingParameters=T,o.transceivers[a].remoteCapabilities=R,o.transceivers[a].rtcpParameters=_,P.length&&"new"===k.state&&(!f&&!A||h&&0!==a?P.forEach((function(t){_e(b.iceTransport,t)})):k.setRemoteCandidates(P)),h&&0!==a||("new"===k.state&&k.start(y,j,"controlling"),"new"===x.state&&x.start(I)),o._transceive(b,"sendrecv"===m||"recvonly"===m,"sendrecv"===m||"sendonly"===m),!E||"sendrecv"!==m&&"sendonly"!==m?delete b.rtpReceiver:(O=E.track,w?(s[w.stream]||(s[w.stream]=new t.MediaStream),e(O,s[w.stream]),u.push([O,E,s[w.stream]])):(s.default||(s.default=new t.MediaStream),e(O,s.default),u.push([O,E,s.default]))));else{(b=o.transceivers[a]||o._createTransceiver(d)).mid=g,b.iceGatherer||(b.iceGatherer=o._createIceGatherer(a,h)),P.length&&"new"===b.iceTransport.state&&(!A||h&&0!==a?P.forEach((function(t){_e(b.iceTransport,t)})):b.iceTransport.setRemoteCandidates(P)),S=t.RTCRtpReceiver.getCapabilities(d),n<15019&&(S.codecs=S.codecs.filter((function(t){return"rtx"!==t.name}))),C=b.sendEncodingParameters||[{ssrc:1001*(2*a+2)}];var D,M=!1;"sendrecv"===m||"sendonly"===m?(M=!b.rtpReceiver,E=b.rtpReceiver||new t.RTCRtpReceiver(b.dtlsTransport,d),M&&(O=E.track,w&&"-"===w.stream||(w?(s[w.stream]||(s[w.stream]=new t.MediaStream,Object.defineProperty(s[w.stream],"id",{get:function(){return w.stream}})),Object.defineProperty(O,"id",{get:function(){return w.track}}),D=s[w.stream]):(s.default||(s.default=new t.MediaStream),D=s.default)),D&&(e(O,D),b.associatedRemoteMediaStreams.push(D)),u.push([O,E,D]))):b.rtpReceiver&&b.rtpReceiver.track&&(b.associatedRemoteMediaStreams.forEach((function(n){var e=n.getTracks().find((function(t){return t.id===b.rtpReceiver.track.id}));e&&function(n,e){e.removeTrack(n),e.dispatchEvent(new t.MediaStreamTrackEvent("removetrack",{track:n}))}(e,n)})),b.associatedRemoteMediaStreams=[]),b.localCapabilities=S,b.remoteCapabilities=R,b.rtpReceiver=E,b.rtcpParameters=_,b.sendEncodingParameters=C,b.recvEncodingParameters=T,o._transceive(o.transceivers[a],!1,M)}}else o.transceivers[a]={mid:g,isDatachannel:!0}})),void 0===o._dtlsRole&&(o._dtlsRole="offer"===r.type?"active":"passive"),o.remoteDescription={type:r.type,sdp:r.sdp},o._updateSignalingState("offer"===r.type?"have-remote-offer":"stable"),Object.keys(s).forEach((function(n){var e=s[n];if(e.getTracks().length){if(-1===o.remoteStreams.indexOf(e)){o.remoteStreams.push(e);var r=new Event("addstream");r.stream=e,t.setTimeout((function(){o._dispatchEvent("addstream",r)}))}u.forEach((function(t){e.id===t[2].id&&i(o,t[0],t[1],[e])}))}})),u.forEach((function(t){t[2]||i(o,t[0],t[1],[])})),t.setTimeout((function(){o&&o.transceivers&&o.transceivers.forEach((function(t){t.iceTransport&&"new"===t.iceTransport.state&&t.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),t.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},r.prototype.close=function(){this.transceivers.forEach((function(t){t.iceTransport&&t.iceTransport.stop(),t.dtlsTransport&&t.dtlsTransport.stop(),t.rtpSender&&t.rtpSender.stop(),t.rtpReceiver&&t.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},r.prototype._updateSignalingState=function(t){this.signalingState=t;var n=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",n)},r.prototype._maybeFireNegotiationNeeded=function(){var n=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,t.setTimeout((function(){if(n.needNegotiation){n.needNegotiation=!1;var t=new Event("negotiationneeded");n._dispatchEvent("negotiationneeded",t)}}),0))},r.prototype._updateConnectionState=function(){var t,n={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(t){n[t.iceTransport.state]++,n[t.dtlsTransport.state]++})),n.connected+=n.completed,t="new",n.failed>0?t="failed":n.connecting>0||n.checking>0?t="connecting":n.disconnected>0?t="disconnected":n.new>0?t="new":(n.connected>0||n.completed>0)&&(t="connected"),t!==this.iceConnectionState){this.iceConnectionState=t;var e=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",e)}},r.prototype.createOffer=function(){var e=this;if(e._isClosed)return Promise.reject(Ae("InvalidStateError","Can not call createOffer after close"));var i=e.transceivers.filter((function(t){return"audio"===t.kind})).length,r=e.transceivers.filter((function(t){return"video"===t.kind})).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(i=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(r=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(e.transceivers.forEach((function(t){"audio"===t.kind?--i<0&&(t.wantReceive=!1):"video"===t.kind&&--r<0&&(t.wantReceive=!1)}));i>0||r>0;)i>0&&(e._createTransceiver("audio"),i--),r>0&&(e._createTransceiver("video"),r--);var s=Oe.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.transceivers.forEach((function(i,r){var o=i.track,s=i.kind,u=i.mid||Oe.generateIdentifier();i.mid=u,i.iceGatherer||(i.iceGatherer=e._createIceGatherer(r,e.usingBundle));var a=t.RTCRtpSender.getCapabilities(s);n<15019&&(a.codecs=a.codecs.filter((function(t){return"rtx"!==t.name}))),a.codecs.forEach((function(t){"H264"===t.name&&void 0===t.parameters["level-asymmetry-allowed"]&&(t.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach((function(n){t.name.toLowerCase()===n.name.toLowerCase()&&t.clockRate===n.clockRate&&(t.preferredPayloadType=n.payloadType)}))})),a.headerExtensions.forEach((function(t){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach((function(n){t.uri===n.uri&&(t.id=n.id)}))}));var c=i.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];o&&n>=15019&&"video"===s&&!c[0].rtx&&(c[0].rtx={ssrc:c[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new t.RTCRtpReceiver(i.dtlsTransport,s)),i.localCapabilities=a,i.sendEncodingParameters=c})),"max-compat"!==e._config.bundlePolicy&&(s+="a=group:BUNDLE "+e.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n",e.transceivers.forEach((function(t,n){s+=je(t,t.localCapabilities,"offer",t.stream,e._dtlsRole),s+="a=rtcp-rsize\r\n",!t.iceGatherer||"new"===e.iceGatheringState||0!==n&&e.usingBundle||(t.iceGatherer.getLocalCandidates().forEach((function(t){t.component=1,s+="a="+Oe.writeCandidate(t)+"\r\n"})),"completed"===t.iceGatherer.state&&(s+="a=end-of-candidates\r\n"))}));var u=new t.RTCSessionDescription({type:"offer",sdp:s});return Promise.resolve(u)},r.prototype.createAnswer=function(){var e=this;if(e._isClosed)return Promise.reject(Ae("InvalidStateError","Can not call createAnswer after close"));var i=Oe.writeSessionBoilerplate(e._sdpSessionId,e._sdpSessionVersion++);e.usingBundle&&(i+="a=group:BUNDLE "+e.transceivers.map((function(t){return t.mid})).join(" ")+"\r\n");var r=Oe.getMediaSections(e.remoteDescription.sdp).length;e.transceivers.forEach((function(t,o){if(!(o+1>r))if(t.isDatachannel)i+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+t.mid+"\r\n";else{var s;t.stream&&("audio"===t.kind?s=t.stream.getAudioTracks()[0]:"video"===t.kind&&(s=t.stream.getVideoTracks()[0]),s&&n>=15019&&"video"===t.kind&&!t.sendEncodingParameters[0].rtx&&(t.sendEncodingParameters[0].rtx={ssrc:t.sendEncodingParameters[0].ssrc+1}));var u=Ie(t.localCapabilities,t.remoteCapabilities);!u.codecs.filter((function(t){return"rtx"===t.name.toLowerCase()})).length&&t.sendEncodingParameters[0].rtx&&delete t.sendEncodingParameters[0].rtx,i+=je(t,u,"answer",t.stream,e._dtlsRole),t.rtcpParameters&&t.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}}));var o=new t.RTCSessionDescription({type:"answer",sdp:i});return Promise.resolve(o)},r.prototype.addIceCandidate=function(t){var n,e=this;return t&&void 0===t.sdpMLineIndex&&!t.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(i,r){if(!e.remoteDescription)return r(Ae("InvalidStateError","Can not add ICE candidate without a remote description"));if(t&&""!==t.candidate){var o=t.sdpMLineIndex;if(t.sdpMid)for(var s=0;s<e.transceivers.length;s++)if(e.transceivers[s].mid===t.sdpMid){o=s;break}var u=e.transceivers[o];if(!u)return r(Ae("OperationError","Can not add ICE candidate"));if(u.isDatachannel)return i();var a=Object.keys(t.candidate).length>0?Oe.parseCandidate(t.candidate):{};if("tcp"===a.protocol&&(0===a.port||9===a.port))return i();if(a.component&&1!==a.component)return i();if((0===o||o>0&&u.iceTransport!==e.transceivers[0].iceTransport)&&!_e(u.iceTransport,a))return r(Ae("OperationError","Can not add ICE candidate"));var c=t.candidate.trim();0===c.indexOf("a=")&&(c=c.substr(2)),(n=Oe.getMediaSections(e.remoteDescription.sdp))[o]+="a="+(a.type?c:"end-of-candidates")+"\r\n",e.remoteDescription.sdp=n.join("")}else for(var f=0;f<e.transceivers.length&&(e.transceivers[f].isDatachannel||(e.transceivers[f].iceTransport.addRemoteCandidate({}),(n=Oe.getMediaSections(e.remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",e.remoteDescription.sdp=Oe.getDescription(e.remoteDescription.sdp)+n.join(""),!e.usingBundle));f++);i()}))},r.prototype.getStats=function(){var t=[];return this.transceivers.forEach((function(n){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(e){n[e]&&t.push(n[e].getStats())}))})),new Promise((function(n){var e=new Map;Promise.all(t).then((function(t){t.forEach((function(t){Object.keys(t).forEach((function(n){var i;t[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=t[n]).type]||i.type,e.set(n,t[n])}))})),n(e)}))}))};var o=["createOffer","createAnswer"];return o.forEach((function(t){var n=r.prototype[t];r.prototype[t]=function(){var t=arguments;return"function"==typeof t[0]||"function"==typeof t[1]?n.apply(this,[arguments[2]]).then((function(n){"function"==typeof t[0]&&t[0].apply(null,[n])}),(function(n){"function"==typeof t[1]&&t[1].apply(null,[n])})):n.apply(this,arguments)}})),(o=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(t){var n=r.prototype[t];r.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]||"function"==typeof t[2]?n.apply(this,arguments).then((function(){"function"==typeof t[1]&&t[1].apply(null)}),(function(n){"function"==typeof t[2]&&t[2].apply(null,[n])})):n.apply(this,arguments)}})),["getStats"].forEach((function(t){var n=r.prototype[t];r.prototype[t]=function(){var t=arguments;return"function"==typeof t[1]?n.apply(this,arguments).then((function(){"function"==typeof t[1]&&t[1].apply(null)})):n.apply(this,arguments)}})),r},De=function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,n){var e=[],i=!0,r=!1,o=void 0;try{for(var s,u=t[Symbol.iterator]();!(i=(s=u.next()).done)&&(e.push(s.value),!n||e.length!==n);i=!0);}catch(t){r=!0,o=t}finally{try{!i&&u.return&&u.return()}finally{if(r)throw o}}return e}(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Me={0:"PCMU",8:"PCMA"},Ne=function(t){var n=/a=rtpmap:(\d+) (\S+)/m.exec(t)||[null,"",""],e=De(n,3),i=e[2],r=new RegExp("a=fmtp:"+e[1]+" (\\S+)","m").exec(t)||[null,""];return{codecName:i,codecParams:De(r,2)[1]}},Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fe=_.default,Ue=function(t,n){var e=function(t){return t.replace(/\r\n\r\n$/,"\r\n").split("\r\nm=").slice(1).map((function(t){return"m="+t})).filter((function(t){var n=new RegExp("m=.*","gm"),e=new RegExp("a=.*","gm");return n.test(t)&&e.test(t)}))}(t);return[t.split("\r\nm=")[0]].concat(e.map((function(t){if(!/^m=(audio|video)/.test(t))return t;var e=t.match(/^m=(audio|video)/)[1],i=function(t){return Array.from((n=t,function(t){var n=t.split("\r\n")[0].match(/([0-9]+)/g);return n?n.slice(1).map((function(t){return parseInt(t,10)})):[]}(n).reduce((function(t,e){var i=new RegExp("a=rtpmap:"+e+" ([^/]+)"),r=n.match(i),o=r?r[1].toLowerCase():Me[e]?Me[e].toLowerCase():"";return t.set(e,o)}),new Map))).reduce((function(t,n){var e=n[0],i=n[1],r=t.get(i)||[];return t.set(i,r.concat(e))}),new Map);var n}(t),r=function(t,n){n=n.map((function(t){return t.toLowerCase()}));var e=Sn.flatMap(n,(function(n){return t.get(n)||[]})),i=Sn.difference(Array.from(t.keys()),n),r=Sn.flatMap(i,(function(n){return t.get(n)}));return e.concat(r)}(i,n),o=function(t,n){var e=n.split("\r\n"),i=e[0],r=e.slice(1);return[i=i.replace(/([0-9]+\s?)+$/,t.join(" "))].concat(r).join("\r\n")}(r,t),s=i.get("pcma")||[],u=i.get("pcmu")||[];return("audio"===e?new Set(s.concat(u)):new Set).has(r[0])?o.replace(/\r\nb=(AS|TIAS):([0-9]+)/g,""):o}))).join("\r\n")},Be=function(t,n){if("number"!=typeof n||n<6e3||n>51e4)return t;var e=/a=rtpmap:(\d+) opus/m.exec(t),i=new RegExp("a=fmtp:"+(e&&e.length?e[1]:111));return t.split("\n").map((function(t){return i.test(t)?t+";maxaveragebitrate="+n:t})).join("\n")};function We(){"undefined"!=typeof window?Sn.isLegacyEdge()?this.RTCPeerConnection=new Pe("undefined"!=typeof window?window:u):"function"==typeof window.RTCPeerConnection?this.RTCPeerConnection=window.RTCPeerConnection:"function"==typeof window.webkitRTCPeerConnection?this.RTCPeerConnection=webkitRTCPeerConnection:"function"==typeof window.mozRTCPeerConnection?(this.RTCPeerConnection=mozRTCPeerConnection,window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate):this.log.info("No RTCPeerConnection implementation available"):this.log.info("No RTCPeerConnection implementation available. The window object was not found.")}function ze(t,n,e){return function(){var i=Array.prototype.slice.call(arguments);return new Promise((function(e){e(t.apply(n,i))})).catch((function(){return new Promise((function(r,o){t.apply(n,e?[r,o].concat(i):i.concat([r,o]))}))}))}}function qe(t,n){return ze(t,n,!0)}function Ge(t,n){return ze(t,n,!1)}We.prototype.create=function(t,n){this.log=Fe.getInstance(),this.pc=new this.RTCPeerConnection(n,t)},We.prototype.createModernConstraints=function(t){if(void 0===t)return null;var n=Object.assign({},t);return"undefined"==typeof webkitRTCPeerConnection||Sn.isLegacyEdge()?(void 0!==t.audio&&(n.offerToReceiveAudio=t.audio),void 0!==t.video&&(n.offerToReceiveVideo=t.video)):(n.mandatory={},void 0!==t.audio&&(n.mandatory.OfferToReceiveAudio=t.audio),void 0!==t.video&&(n.mandatory.OfferToReceiveVideo=t.video)),delete n.audio,delete n.video,n},We.prototype.createOffer=function(t,n,e,i,r){var o=this;return e=this.createModernConstraints(e),qe(this.pc.createOffer,this.pc)(e).then((function(e){if(!o.pc)return Promise.resolve();var i=Be(e.sdp,t);return Ge(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"offer",sdp:Ue(i,n)}))})).then(i,r)},We.prototype.createAnswer=function(t,n,e,i,r){var o=this;return e=this.createModernConstraints(e),qe(this.pc.createAnswer,this.pc)(e).then((function(e){if(!o.pc)return Promise.resolve();var i=Be(e.sdp,t);return Ge(o.pc.setLocalDescription,o.pc)(new RTCSessionDescription({type:"answer",sdp:Ue(i,n)}))})).then(i,r)},We.prototype.processSDP=function(t,n,e,i,r,o){var s=this;e=Ue(e,n);var u=new RTCSessionDescription({sdp:e,type:"offer"});return Ge(this.pc.setRemoteDescription,this.pc)(u).then((function(){s.createAnswer(t,n,i,r,o)}))},We.prototype.getSDP=function(){return this.pc.localDescription.sdp},We.prototype.processAnswer=function(t,n,e,i){return this.pc?(n=Ue(n,t),Ge(this.pc.setRemoteDescription,this.pc)(new RTCSessionDescription({sdp:n,type:"answer"})).then(e,i)):Promise.resolve()},We.test=function(){if("object"===("undefined"==typeof navigator?"undefined":Le(navigator))){var t=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.getUserMedia;if(Sn.isLegacyEdge(navigator))return!1;if(t&&"function"==typeof window.RTCPeerConnection)return!0;if(t&&"function"==typeof window.webkitRTCPeerConnection)return!0;if(t&&"function"==typeof window.mozRTCPeerConnection){try{if("function"!=typeof(new window.mozRTCPeerConnection).getLocalStreams)return!1}catch(t){return!1}return!0}if("undefined"!=typeof RTCIceGatherer)return!0}return!1};var Je=We,He=C.InvalidArgumentError,Ve=C.MediaErrors,$e=C.NotSupportedError,Xe=C.SignalingErrors,Ye=_.default,Ze=function(t){return Sn.isChrome(window,window.navigator)?t.split("\n").filter((function(t){return-1===t.indexOf("a=ice-lite")})).join("\n"):t};function Ke(t,n,e,i){if(!t||!n||!e)throw new He("Audiohelper, pstream and getUserMedia are required arguments");if(!(this instanceof Ke))return new Ke(t,n,e,i);function r(){}this.onopen=r,this.onerror=r,this.onclose=r,this.ondisconnected=r,this.onfailed=r,this.onconnected=r,this.onreconnected=r,this.onsignalingstatechange=r,this.ondtlstransportstatechange=r,this.onicegatheringfailure=r,this.onicegatheringstatechange=r,this.oniceconnectionstatechange=r,this.onpcconnectionstatechange=r,this.onicecandidate=r,this.onselectedcandidatepairchange=r,this.onvolume=r,this.version=null,this.pstream=n,this.stream=null,this.sinkIds=new Set(["default"]),this.outputs=new Map,this.status="connecting",this.callSid=null,this.isMuted=!1,this.getUserMedia=e;var o="undefined"!=typeof window&&(window.AudioContext||window.webkitAudioContext);return this._isSinkSupported=!!o&&"undefined"!=typeof HTMLAudioElement&&HTMLAudioElement.prototype.setSinkId,this._audioContext=o&&t._audioContext,this._hasIceCandidates=!1,this._hasIceGatheringFailures=!1,this._iceGatheringTimeoutId=null,this._masterAudio=null,this._masterAudioDeviceId=null,this._mediaStreamSource=null,this._dtmfSender=null,this._dtmfSenderUnsupported=!1,this._callEvents=[],this._nextTimeToPublish=Date.now(),this._onAnswerOrRinging=r,this._onHangup=r,this._remoteStream=null,this._shouldManageStream=!0,this._iceState="new",this._isUnifiedPlan=i.isUnifiedPlan,this.options=i=i||{},this.navigator=i.navigator||("undefined"!=typeof navigator?navigator:null),this.util=i.util||Sn,this.codecPreferences=i.codecPreferences,this._log=Ye.getInstance(),this}function Qe(t,n){"function"==typeof t.addTrack?n.getAudioTracks().forEach((function(e){t.addTrack(e,n)})):t.addStream(n)}function ti(t){var n="undefined"!=typeof MediaStream?new MediaStream:new webkitMediaStream;return t.getAudioTracks().forEach(n.addTrack,n),n}function ni(t,n){if(void 0!==t.srcObject)t.srcObject=n;else if(void 0!==t.mozSrcObject)t.mozSrcObject=n;else{if(void 0===t.src)return!1;var e=t.options.window||window;t.src=(e.URL||e.webkitURL).createObjectURL(n)}return!0}Ke.prototype.uri=function(){return this._uri},Ke.prototype.openWithConstraints=function(t){return this.getUserMedia({audio:t}).then(this._setInputTracksFromStream.bind(this,!1))},Ke.prototype.setInputTracksFromStream=function(t){var n=this;return this._setInputTracksFromStream(!0,t).then((function(){n._shouldManageStream=!1}))},Ke.prototype._createAnalyser=function(t,n){n=Object.assign({fftSize:32,smoothingTimeConstant:.3},n);var e=t.createAnalyser();for(var i in n)e[i]=n[i];return e},Ke.prototype._setVolumeHandler=function(t){this.onvolume=t},Ke.prototype._startPollingVolume=function(){if(this._audioContext&&this.stream&&this._remoteStream){var t=this._audioContext,n=this._inputAnalyser=this._createAnalyser(t),e=new Uint8Array(n.frequencyBinCount);this._inputAnalyser2=this._createAnalyser(t,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0});var i=this._outputAnalyser=this._createAnalyser(t),r=new Uint8Array(i.frequencyBinCount);this._outputAnalyser2=this._createAnalyser(t,{minDecibels:-127,maxDecibels:0,smoothingTimeConstant:0}),this._updateInputStreamSource(this.stream),this._updateOutputStreamSource(this._remoteStream);var o=this;setTimeout((function t(){if(o._audioContext){if("closed"===o.status)return o._inputAnalyser.disconnect(),o._outputAnalyser.disconnect(),o._inputAnalyser2.disconnect(),void o._outputAnalyser2.disconnect();o._inputAnalyser.getByteFrequencyData(e);var n=o.util.average(e);o._inputAnalyser2.getByteFrequencyData(e);var i=o.util.average(e);o._outputAnalyser.getByteFrequencyData(r);var s=o.util.average(r);o._outputAnalyser2.getByteFrequencyData(r);var u=o.util.average(r);o.onvolume(n/255,s/255,i,u),setTimeout(t,50)}}),50)}},Ke.prototype._stopStream=function(t){this._shouldManageStream&&("function"==typeof MediaStreamTrack.prototype.stop?("function"==typeof t.getAudioTracks?t.getAudioTracks():t.audioTracks).forEach((function(t){t.stop()})):t.stop())},Ke.prototype._updateInputStreamSource=function(t){this._inputStreamSource&&this._inputStreamSource.disconnect(),this._inputStreamSource=this._audioContext.createMediaStreamSource(t),this._inputStreamSource.connect(this._inputAnalyser),this._inputStreamSource.connect(this._inputAnalyser2)},Ke.prototype._updateOutputStreamSource=function(t){this._outputStreamSource&&this._outputStreamSource.disconnect(),this._outputStreamSource=this._audioContext.createMediaStreamSource(t),this._outputStreamSource.connect(this._outputAnalyser),this._outputStreamSource.connect(this._outputAnalyser2)},Ke.prototype._setInputTracksFromStream=function(t,n){return this._isUnifiedPlan?this._setInputTracksForUnifiedPlan(t,n):this._setInputTracksForPlanB(t,n)},Ke.prototype._setInputTracksForPlanB=function(t,n){var e=this;if(!n)return Promise.reject(new He("Can not set input stream to null while in a call"));if(!n.getAudioTracks().length)return Promise.reject(new He("Supplied input stream has no audio tracks"));var i,r,o=this.stream;return o?(this._stopStream(o),r=o,"function"==typeof(i=this.version.pc).removeTrack?i.getSenders().forEach((function(t){i.removeTrack(t)})):i.removeStream(r),o.getAudioTracks().forEach(o.removeTrack,o),n.getAudioTracks().forEach(o.addTrack,o),Qe(this.version.pc,n),this._updateInputStreamSource(this.stream)):this.stream=t?ti(n):n,this.mute(this.isMuted),this.version?new Promise((function(t,n){e.version.createOffer(e.options.maxAverageBitrate,e.codecPreferences,{audio:!0},(function(){e.version.processAnswer(e.codecPreferences,e._answerSdp,(function(){t(e.stream)}),n)}),n)})):Promise.resolve(this.stream)},Ke.prototype._setInputTracksForUnifiedPlan=function(t,n){var e=this;if(!n)return Promise.reject(new He("Can not set input stream to null while in a call"));if(!n.getAudioTracks().length)return Promise.reject(new He("Supplied input stream has no audio tracks"));var i=this.stream,r=function(){return e.mute(e.isMuted),Promise.resolve(e.stream)};return i?(this._shouldManageStream&&this._stopStream(i),this._sender||(this._sender=this.version.pc.getSenders()[0]),this._sender.replaceTrack(n.getAudioTracks()[0]).then((function(){return e._updateInputStreamSource(n),r()}))):(this.stream=t?ti(n):n,r())},Ke.prototype._onInputDevicesChanged=function(){this.stream&&this.stream.getAudioTracks().every((function(t){return"ended"===t.readyState}))&&this._shouldManageStream&&this.openWithConstraints(!0)},Ke.prototype._onIceGatheringFailure=function(t){this._hasIceGatheringFailures=!0,this.onicegatheringfailure(t)},Ke.prototype._onMediaConnectionStateChange=function(t){var n=this._iceState;if(n!==t&&("connected"===t||"disconnected"===t||"failed"===t)){this._iceState=t;var e=void 0;switch(t){case"connected":"disconnected"===n||"failed"===n?(this._log.info(e="ICE liveliness check succeeded. Connection with Twilio restored"),this.onreconnected(e)):(this._log.info(e="Media connection established."),this.onconnected(e)),this._stopIceGatheringTimeout(),this._hasIceGatheringFailures=!1;break;case"disconnected":this._log.info(e="ICE liveliness check failed. May be having trouble connecting to Twilio"),this.ondisconnected(e);break;case"failed":this._log.info(e="Connection with Twilio was interrupted."),this.onfailed(e)}}},Ke.prototype._setSinkIds=function(t){return this._isSinkSupported?(this.sinkIds=new Set(t.forEach?t:[t]),this.version?this._updateAudioOutputs():Promise.resolve()):Promise.reject(new $e("Audio output selection is not supported by this browser"))},Ke.prototype._startIceGatheringTimeout=function(){var t=this;this._stopIceGatheringTimeout(),this._iceGatheringTimeoutId=setTimeout((function(){t._onIceGatheringFailure("timeout")}),15e3)},Ke.prototype._stopIceGatheringTimeout=function(){clearInterval(this._iceGatheringTimeoutId)},Ke.prototype._updateAudioOutputs=function(){var t=Array.from(this.sinkIds).filter((function(t){return!this.outputs.has(t)}),this),n=Array.from(this.outputs.keys()).filter((function(t){return!this.sinkIds.has(t)}),this),e=this,i=t.map(this._createAudioOutput,this);return Promise.all(i).then((function(){return Promise.all(n.map(e._removeAudioOutput,e))}))},Ke.prototype._createAudio=function(t){return new Audio(t)},Ke.prototype._createAudioOutput=function(t){var n=this._audioContext.createMediaStreamDestination();this._mediaStreamSource.connect(n);var e=this._createAudio();ni(e,n.stream);var i=this;return e.setSinkId(t).then((function(){return e.play()})).then((function(){i.outputs.set(t,{audio:e,dest:n})}))},Ke.prototype._removeAudioOutputs=function(){return this._masterAudio&&void 0!==this._masterAudioDeviceId&&(this._disableOutput(this,this._masterAudioDeviceId),this.outputs.delete(this._masterAudioDeviceId),this._masterAudioDeviceId=null,this._masterAudio.paused||this._masterAudio.pause(),void 0!==this._masterAudio.srcObject?this._masterAudio.srcObject=null:this._masterAudio.src="",this._masterAudio=null),Array.from(this.outputs.keys()).map(this._removeAudioOutput,this)},Ke.prototype._disableOutput=function(t,n){var e=t.outputs.get(n);e&&(e.audio&&(e.audio.pause(),e.audio.src=""),e.dest&&e.dest.disconnect())},Ke.prototype._reassignMasterOutput=function(t,n){var e=t.outputs.get(n);t.outputs.delete(n);var i=this,r=Array.from(t.outputs.keys())[0]||"default";return e.audio.setSinkId(r).then((function(){i._disableOutput(t,r),t.outputs.set(r,e),t._masterAudioDeviceId=r})).catch((function(){t.outputs.set(n,e),i._log.info("Could not reassign master output. Attempted to roll back.")}))},Ke.prototype._removeAudioOutput=function(t){return this._masterAudioDeviceId===t?this._reassignMasterOutput(this,t):(this._disableOutput(this,t),this.outputs.delete(t),Promise.resolve())},Ke.prototype._onAddTrack=function(t,n){var e=t._masterAudio=this._createAudio();ni(e,n),e.play();var i=Array.from(t.outputs.keys())[0]||"default";t._masterAudioDeviceId=i,t.outputs.set(i,{audio:e}),t._mediaStreamSource=t._audioContext.createMediaStreamSource(n),t.pcStream=n,t._updateAudioOutputs()},Ke.prototype._fallbackOnAddTrack=function(t,n){var e=document&&document.createElement("audio");e.autoplay=!0,ni(e,n)||t._log.info("Error attaching stream to element."),t.outputs.set("default",{audio:e})},Ke.prototype._setEncodingParameters=function(t){if(t&&this._sender&&"function"==typeof this._sender.getParameters&&"function"==typeof this._sender.setParameters){var n=this._sender.getParameters();(n.priority||n.encodings&&n.encodings.length)&&(n.priority="high",n.encodings&&n.encodings.length&&n.encodings.forEach((function(t){t.priority="high",t.networkPriority="high"})),this._sender.setParameters(n))}},Ke.prototype._setupPeerConnection=function(t,n){var e=this,i=this,r=new(this.options.rtcpcFactory||Je);return r.create(t,n),Qe(r.pc,this.stream),r.pc["ontrack"in r.pc?"ontrack":"onaddstream"]=function(t){var n=i._remoteStream=t.stream||t.streams[0];"function"==typeof r.pc.getSenders&&(e._sender=r.pc.getSenders()[0]),i._isSinkSupported?i._onAddTrack(i,n):i._fallbackOnAddTrack(i,n),i._startPollingVolume()},r},Ke.prototype._maybeSetIceAggressiveNomination=function(t){return this.options.forceAggressiveIceNomination?Ze(t):t},Ke.prototype._setupChannel=function(){var t=this,n=this.version.pc;this.version.pc.onopen=function(){t.status="open",t.onopen()},this.version.pc.onstatechange=function(){t.version.pc&&"stable"===t.version.pc.readyState&&(t.status="open",t.onopen())},this.version.pc.onsignalingstatechange=function(){t._log.info('signalingState is "'+n.signalingState+'"'),t.version.pc&&"stable"===t.version.pc.signalingState&&(t.status="open",t.onopen()),t.onsignalingstatechange(n.signalingState)},n.onconnectionstatechange=function(){t._log.info('pc.connectionState is "'+n.connectionState+'"'),t.onpcconnectionstatechange(n.connectionState),t._onMediaConnectionStateChange(n.connectionState)},n.onicecandidate=function(n){var e=n.candidate;e&&(t._hasIceCandidates=!0,t.onicecandidate(e),t._setupRTCIceTransportListener()),t._log.info("ICE Candidate: "+JSON.stringify(e))},n.onicegatheringstatechange=function(){var e=n.iceGatheringState;"gathering"===e?t._startIceGatheringTimeout():"complete"===e&&(t._stopIceGatheringTimeout(),t._hasIceCandidates||t._onIceGatheringFailure("none"),t._hasIceCandidates&&t._hasIceGatheringFailures&&t._startIceGatheringTimeout()),t._log.info('pc.iceGatheringState is "'+n.iceGatheringState+'"'),t.onicegatheringstatechange(e)},n.oniceconnectionstatechange=function(){t._log.info('pc.iceConnectionState is "'+n.iceConnectionState+'"'),t.oniceconnectionstatechange(n.iceConnectionState),t._onMediaConnectionStateChange(n.iceConnectionState)}},Ke.prototype._initializeMediaStream=function(t,n){return"open"!==this.status&&("disconnected"===this.pstream.status?(this.onerror({info:{code:31e3,message:"Cannot establish connection. Client is disconnected",twilioError:new Xe.ConnectionDisconnected}}),this.close(),!1):(this.version=this._setupPeerConnection(t,n),this._setupChannel(),!0))},Ke.prototype._removeReconnectionListeners=function(){this.pstream&&(this.pstream.removeListener("answer",this._onAnswerOrRinging),this.pstream.removeListener("hangup",this._onHangup))},Ke.prototype._setupRTCDtlsTransportListener=function(){var t=this,n=this.getRTCDtlsTransport();if(n&&!n.onstatechange){var e=function(){t._log.info('dtlsTransportState is "'+n.state+'"'),t.ondtlstransportstatechange(n.state)};e(),n.onstatechange=e}},Ke.prototype._setupRTCIceTransportListener=function(){var t=this,n=this._getRTCIceTransport();n&&!n.onselectedcandidatepairchange&&(n.onselectedcandidatepairchange=function(){return t.onselectedcandidatepairchange(n.getSelectedCandidatePair())})},Ke.prototype.iceRestart=function(){var t=this;this.options.enableIceRestart&&(this._log.info("Attempting to restart ICE..."),this._hasIceCandidates=!1,this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{iceRestart:!0}).then((function(){t._removeReconnectionListeners(),t._onAnswerOrRinging=function(n){if(t._removeReconnectionListeners(),n.sdp&&"have-local-offer"===t.version.pc.signalingState){var e=t._maybeSetIceAggressiveNomination(n.sdp);t._answerSdp=e,"closed"!==t.status&&t.version.processAnswer(t.codecPreferences,e,null,(function(n){t._log.info("Failed to process answer during ICE Restart. Error: "+(n&&n.message?n.message:n))}))}else t._log.info("Invalid state or param during ICE Restart:hasSdp:"+!!n.sdp+", signalingState:"+t.version.pc.signalingState)},t._onHangup=function(){t._log.info("Received hangup during ICE Restart"),t._removeReconnectionListeners()},t.pstream.on("answer",t._onAnswerOrRinging),t.pstream.on("hangup",t._onHangup),t.pstream.reinvite(t.version.getSDP(),t.callSid)})).catch((function(n){var e=n&&n.message?n.message:n;t._log.info("Failed to createOffer during ICE Restart. Error: "+e),t.onfailed(e)})))},Ke.prototype.makeOutgoingCall=function(t,n,e,i,r,o){var s=this;if(this._initializeMediaStream(i,r)){var u=this;this.callSid=e,this._onAnswerOrRinging=function(t){if(t.sdp){var n=s._maybeSetIceAggressiveNomination(t.sdp);u._answerSdp=n,"closed"!==u.status&&u.version.processAnswer(s.codecPreferences,n,a,c),u.pstream.removeListener("answer",u._onAnswerOrRinging),u.pstream.removeListener("ringing",u._onAnswerOrRinging)}},this.pstream.on("answer",this._onAnswerOrRinging),this.pstream.on("ringing",this._onAnswerOrRinging),this.version.createOffer(this.options.maxAverageBitrate,this.codecPreferences,{audio:!0},(function(){"closed"!==u.status&&(u.pstream.invite(u.version.getSDP(),u.callSid,u.options.preflight,n),u._setupRTCDtlsTransportListener())}),(function(t){u.onerror({info:{code:31e3,message:"Error creating the offer: "+(t.message||t),twilioError:new Ve.ClientLocalDescFailed}})}))}function a(){u.options&&u._setEncodingParameters(u.options.dscp),o(u.version.pc)}function c(t){u.onerror({info:{code:31e3,message:"Error processing answer: "+(t.message||t),twilioError:new Ve.ClientRemoteDescFailed}})}},Ke.prototype.answerIncomingCall=function(t,n,e,i,r){if(this._initializeMediaStream(e,i)){n=this._maybeSetIceAggressiveNomination(n),this._answerSdp=n.replace(/^a=setup:actpass$/gm,"a=setup:passive"),this.callSid=t;var o=this;this.version.processSDP(this.options.maxAverageBitrate,this.codecPreferences,n,{audio:!0},(function(){"closed"!==o.status&&(o.pstream.answer(o.version.getSDP(),t),o.options&&o._setEncodingParameters(o.options.dscp),r(o.version.pc),o._setupRTCDtlsTransportListener())}),(function(t){o.onerror({info:{code:31e3,message:"Error creating the answer: "+(t.message||t),twilioError:new Ve.ClientRemoteDescFailed}})}))}},Ke.prototype.close=function(){this.version&&this.version.pc&&("closed"!==this.version.pc.signalingState&&this.version.pc.close(),this.version.pc=null),this.stream&&(this.mute(!1),this._stopStream(this.stream)),this.stream=null,this._removeReconnectionListeners(),this._stopIceGatheringTimeout(),Promise.all(this._removeAudioOutputs()).catch((function(){})),this._mediaStreamSource&&this._mediaStreamSource.disconnect(),this._inputAnalyser&&this._inputAnalyser.disconnect(),this._outputAnalyser&&this._outputAnalyser.disconnect(),this._inputAnalyser2&&this._inputAnalyser2.disconnect(),this._outputAnalyser2&&this._outputAnalyser2.disconnect(),this.status="closed",this.onclose()},Ke.prototype.reject=function(t){this.callSid=t},Ke.prototype.ignore=function(t){this.callSid=t},Ke.prototype.mute=function(t){this.isMuted=t,this.stream&&(this._sender&&this._sender.track?this._sender.track.enabled=!t:("function"==typeof this.stream.getAudioTracks?this.stream.getAudioTracks():this.stream.audioTracks).forEach((function(n){n.enabled=!t})))},Ke.prototype.getOrCreateDTMFSender=function(){if(this._dtmfSender||this._dtmfSenderUnsupported)return this._dtmfSender||null;var t=this,n=this.version.pc;if(!n)return this._log.info("No RTCPeerConnection available to call createDTMFSender on"),null;if("function"==typeof n.getSenders&&("function"==typeof RTCDTMFSender||"function"==typeof RTCDtmfSender)){var e=n.getSenders().find((function(t){return t.dtmf}));if(e)return this._log.info("Using RTCRtpSender#dtmf"),this._dtmfSender=e.dtmf,this._dtmfSender}if("function"==typeof n.createDTMFSender&&"function"==typeof n.getLocalStreams){var i=n.getLocalStreams().map((function(n){var e=t._getAudioTracks(n);return e&&e[0]}))[0];return i?(this._log.info("Creating RTCDTMFSender"),this._dtmfSender=n.createDTMFSender(i),this._dtmfSender):(this._log.info("No local audio MediaStreamTrack available on the RTCPeerConnection to pass to createDTMFSender"),null)}return this._log.info("RTCPeerConnection does not support RTCDTMFSender"),this._dtmfSenderUnsupported=!0,null},Ke.prototype.getRTCDtlsTransport=function(){var t=this.version&&this.version.pc&&"function"==typeof this.version.pc.getSenders&&this.version.pc.getSenders()[0];return t&&t.transport||null},Ke.prototype._canStopMediaStreamTrack=function(){return"function"==typeof MediaStreamTrack.prototype.stop},Ke.prototype._getAudioTracks=function(t){return"function"==typeof t.getAudioTracks?t.getAudioTracks():t.audioTracks},Ke.prototype._getRTCIceTransport=function(){var t=this.getRTCDtlsTransport();return t&&t.iceTransport||null},Ke.protocol=Je.test()?new Je:null,Ke.enabled=Je.test();var ei=Je.test,ii={enabled:function(){return ei()},getMediaEngine:function(){return"undefined"!=typeof RTCIceGatherer?"ORTC":"WebRTC"},PeerConnection:Ke},ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},oi=C.NotSupportedError,si=function(t,n){return(n=n||{}).util=n.util||Sn,n.navigator=n.navigator||("undefined"!=typeof navigator?navigator:null),new Promise((function(e,i){if(!n.navigator)throw new oi("getUserMedia is not supported");switch("function"){case ri(n.navigator.mediaDevices&&n.navigator.mediaDevices.getUserMedia):return e(n.navigator.mediaDevices.getUserMedia(t));case ri(n.navigator.webkitGetUserMedia):return n.navigator.webkitGetUserMedia(t,e,i);case ri(n.navigator.mozGetUserMedia):return n.navigator.mozGetUserMedia(t,e,i);case ri(n.navigator.getUserMedia):return n.navigator.getUserMedia(t,e,i);default:throw new oi("getUserMedia is not supported")}})).catch((function(t){throw n.util.isFirefox()&&"NotReadableError"===t.name?new oi("Firefox does not currently support opening multiple audio input trackssimultaneously, even across different tabs.\nRelated Bugzilla thread: https://bugzilla.mozilla.org/show_bug.cgi?id=1299324"):t}))},ui=a((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var e=function(){function t(){var t=this;this._promise=new Promise((function(n,e){t._resolve=n,t._reject=e}))}return Object.defineProperty(t.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),t.prototype.reject=function(t){this._reject(t)},t.prototype.resolve=function(t){this._resolve(t)},t}();n.default=e})),ai=a((function(t,n){var e=u&&u.__awaiter||function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(s,u)}a((i=i.apply(t,n||[])).next())}))},i=u&&u.__generator||function(t,n){var e,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(e)throw new TypeError("Generator is already executing.");for(;s;)try{if(e=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=n.call(t,s)}catch(t){o=[6,t],i=0}finally{e=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}};Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function t(){this._operations=[]}return t.prototype.enqueue=function(t){var n=!!this._operations.length,e=new ui.default;return this._operations.push({deferred:e,callback:t}),n||this._processQueue(),e.promise},t.prototype._processQueue=function(){return e(this,void 0,void 0,(function(){var t,n,e,r,o,s,u;return i(this,(function(i){switch(i.label){case 0:if(!this._operations.length)return[3,5];n=(t=this._operations[0]).deferred,e=t.callback,r=void 0,o=void 0,s=void 0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e()];case 2:return r=i.sent(),s=!0,[3,4];case 3:return u=i.sent(),o=u,[3,4];case 4:return this._operations.shift(),s?n.resolve(r):n.reject(o),[3,0];case 5:return[2]}}))}))},t}();n.AsyncQueue=r})),ci=a((function(t){!function(n){var e,i=Object.prototype,r=i.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag",c=n.regeneratorRuntime;if(c)t.exports=c;else{(c=n.regeneratorRuntime=t.exports).wrap=b;var f="suspendedStart",h="suspendedYield",l="executing",d="completed",v={},p={};p[s]=function(){return this};var m=Object.getPrototypeOf,w=m&&m(m(R([])));w&&w!==i&&r.call(w,s)&&(p=w);var g=E.prototype=k.prototype=Object.create(p);x.prototype=g.constructor=E,E.constructor=x,E[a]=x.displayName="GeneratorFunction",c.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===x||"GeneratorFunction"===(n.displayName||n.name))},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,a in t||(t[a]="GeneratorFunction")),t.prototype=Object.create(g),t},c.awrap=function(t){return{__await:t}},C(T.prototype),T.prototype[u]=function(){return this},c.AsyncIterator=T,c.async=function(t,n,e,i){var r=new T(b(t,n,e,i));return c.isGeneratorFunction(n)?r:r.next().then((function(t){return t.done?t.value:r.next()}))},C(g),g[a]="Generator",g[s]=function(){return this},g.toString=function(){return"[object Generator]"},c.keys=function(t){var n=[];for(var e in t)n.push(e);return n.reverse(),function e(){for(;n.length;){var i=n.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},c.values=R,I.prototype={constructor:I,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(j),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(i,r){return u.type="throw",u.arg=t,n.next=i,r&&(n.method="next",n.arg=e),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],u=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var a=r.call(s,"catchLoc"),c=r.call(s,"finallyLoc");if(a&&c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(a){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=t,s.arg=n,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(s)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),v},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),j(e),v}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var i=e.completion;if("throw"===i.type){var r=i.arg;j(e)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,i){return this.delegate={iterator:R(t),resultName:n,nextLoc:i},"next"===this.method&&(this.arg=e),v}}}function b(t,n,e,i){var r=Object.create((n&&n.prototype instanceof k?n:k).prototype),o=new I(i||[]);return r._invoke=function(t,n,e){var i=f;return function(r,o){if(i===l)throw new Error("Generator is already running");if(i===d){if("throw"===r)throw o;return _()}for(e.method=r,e.arg=o;;){var s=e.delegate;if(s){var u=S(s,e);if(u){if(u===v)continue;return u}}if("next"===e.method)e.sent=e._sent=e.arg;else if("throw"===e.method){if(i===f)throw i=d,e.arg;e.dispatchException(e.arg)}else"return"===e.method&&e.abrupt("return",e.arg);i=l;var a=y(t,n,e);if("normal"===a.type){if(i=e.done?d:h,a.arg===v)continue;return{value:a.arg,done:e.done}}"throw"===a.type&&(i=d,e.method="throw",e.arg=a.arg)}}}(t,e,o),r}function y(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}function k(){}function x(){}function E(){}function C(t){["next","throw","return"].forEach((function(n){t[n]=function(t){return this._invoke(n,t)}}))}function T(t){function n(e,i,o,s){var u=y(t[e],t,i);if("throw"!==u.type){var a=u.arg,c=a.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):Promise.resolve(c).then((function(t){a.value=t,o(a)}),s)}s(u.arg)}var e;this._invoke=function(t,i){function r(){return new Promise((function(e,r){n(t,i,e,r)}))}return e=e?e.then(r,r):r()}}function S(t,n){var i=t.iterator[n.method];if(i===e){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=e,S(t,n),"throw"===n.method))return v;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return v}var r=y(i,t.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,v;var o=r.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function O(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function j(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function I(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function R(t){if(t){var n=t[s];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}return{next:_}}function _(){return{value:e,done:!0}}}(function(){return this}()||Function("return this")())})),fi=function(){return this}()||Function("return this")(),hi=fi.regeneratorRuntime&&Object.getOwnPropertyNames(fi).indexOf("regeneratorRuntime")>=0,li=hi&&fi.regeneratorRuntime;fi.regeneratorRuntime=void 0;var di=ci;if(hi)fi.regeneratorRuntime=li;else try{delete fi.regeneratorRuntime}catch(t){fi.regeneratorRuntime=void 0}var vi=di,pi=a((function(t,n){var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){var n=this;!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.promise=new Promise((function(t,e){n._resolve=t,n._reject=e}))}return e(t,[{key:"reject",get:function(){return this._reject}},{key:"resolve",get:function(){return this._resolve}}]),t}();n.default=i})),mi=a((function(t,n){var e=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this._eventEmitter=new P.EventEmitter}return e(t,[{key:"addEventListener",value:function(t,n){return this._eventEmitter.addListener(t,n)}},{key:"dispatchEvent",value:function(t){for(var n,e=arguments.length,i=Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];return(n=this._eventEmitter).emit.apply(n,[t].concat(i))}},{key:"removeEventListener",value:function(t,n){return this._eventEmitter.removeListener(t,n)}}]),t}();n.default=i})),wi=a((function(t,n){var e,i=(e=vi)&&e.__esModule?e:{default:e},r=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}();function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function s(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n}var u=function(t,n,e,i){return new(e||(e=Promise))((function(r,o){function s(t){try{a(i.next(t))}catch(t){o(t)}}function u(t){try{a(i.throw(t))}catch(t){o(t)}}function a(t){t.done?r(t.value):new e((function(n){n(t.value)})).then(s,u)}a((i=i.apply(t,n||[])).next())}))};Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};o(this,t);var r=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._audioNode=null,r._pendingPlayDeferreds=[],r._loop=!1,r._src="",r._sinkId="default","string"!=typeof e&&(i=e),r._audioContext=n,r._audioElement=new(i.AudioFactory||Audio),r._bufferPromise=r._createPlayDeferred().promise,r._destination=r._audioContext.destination,r._gainNode=r._audioContext.createGain(),r._gainNode.connect(r._destination),r._XMLHttpRequest=i.XMLHttpRequestFactory||XMLHttpRequest,r.addEventListener("canplaythrough",(function(){r._resolvePlayDeferreds()})),"string"==typeof e&&(r.src=e),r}return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)}(t,mi.default),r(t,[{key:"load",value:function(){this._load(this._src)}},{key:"pause",value:function(){this.paused||(this._audioElement.pause(),this._audioNode.stop(),this._audioNode.disconnect(this._gainNode),this._audioNode=null,this._rejectPlayDeferreds(new Error("The play() request was interrupted by a call to pause().")))}},{key:"play",value:function(){return u(this,void 0,void 0,i.default.mark((function t(){var n,e=this;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.paused){t.next=6;break}return t.next=3,this._bufferPromise;case 3:if(this.paused){t.next=5;break}return t.abrupt("return");case 5:throw new Error("The play() request was interrupted by a call to pause().");case 6:return this._audioNode=this._audioContext.createBufferSource(),this._audioNode.loop=this.loop,this._audioNode.addEventListener("ended",(function(){e._audioNode&&e._audioNode.loop||e.dispatchEvent("ended")})),t.next=11,this._bufferPromise;case 11:if(n=t.sent,!this.paused){t.next=14;break}throw new Error("The play() request was interrupted by a call to pause().");case 14:if(this._audioNode.buffer=n,this._audioNode.connect(this._gainNode),this._audioNode.start(),!this._audioElement.srcObject){t.next=19;break}return t.abrupt("return",this._audioElement.play());case 19:case"end":return t.stop()}}),t,this)})))}},{key:"setSinkId",value:function(t){return u(this,void 0,void 0,i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if("function"==typeof this._audioElement.setSinkId){n.next=2;break}throw new Error("This browser does not support setSinkId.");case 2:if(t!==this.sinkId){n.next=4;break}return n.abrupt("return");case 4:if("default"!==t){n.next=11;break}return this.paused||this._gainNode.disconnect(this._destination),this._audioElement.srcObject=null,this._destination=this._audioContext.destination,this._gainNode.connect(this._destination),this._sinkId=t,n.abrupt("return");case 11:return n.next=13,this._audioElement.setSinkId(t);case 13:if(!this._audioElement.srcObject){n.next=15;break}return n.abrupt("return");case 15:this._gainNode.disconnect(this._audioContext.destination),this._destination=this._audioContext.createMediaStreamDestination(),this._audioElement.srcObject=this._destination.stream,this._sinkId=t,this._gainNode.connect(this._destination);case 20:case"end":return n.stop()}}),n,this)})))}},{key:"_createPlayDeferred",value:function(){var t=new pi.default;return this._pendingPlayDeferreds.push(t),t}},{key:"_load",value:function(t){var n=this;this._src&&this._src!==t&&this.pause(),this._src=t,this._bufferPromise=new Promise((function(e){return u(n,void 0,void 0,i.default.mark((function n(){var r;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t){n.next=2;break}return n.abrupt("return",this._createPlayDeferred().promise);case 2:return n.next=4,c(this._audioContext,this._XMLHttpRequest,t);case 4:r=n.sent,this.dispatchEvent("canplaythrough"),e(r);case 7:case"end":return n.stop()}}),n,this)})))}))}},{key:"_rejectPlayDeferreds",value:function(t){var n=this._pendingPlayDeferreds;n.splice(0,n.length).forEach((function(n){return(0,n.reject)(t)}))}},{key:"_resolvePlayDeferreds",value:function(t){var n=this._pendingPlayDeferreds;n.splice(0,n.length).forEach((function(n){return(0,n.resolve)(t)}))}},{key:"destination",get:function(){return this._destination}},{key:"loop",get:function(){return this._loop},set:function(t){if(!t&&this.loop&&!this.paused){var n=this;this._audioNode.addEventListener("ended",(function t(){n._audioNode.removeEventListener("ended",t),n.pause()}))}this._loop=t}},{key:"muted",get:function(){return 0===this._gainNode.gain.value},set:function(t){this._gainNode.gain.value=t?0:1}},{key:"paused",get:function(){return null===this._audioNode}},{key:"src",get:function(){return this._src},set:function(t){this._load(t)}},{key:"srcObject",get:function(){return this._audioElement.srcObject},set:function(t){this._audioElement.srcObject=t}},{key:"sinkId",get:function(){return this._sinkId}}]),t}();function c(t,n,e){return u(this,void 0,void 0,i.default.mark((function r(){var o,s;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return(o=new n).open("GET",e,!0),o.responseType="arraybuffer",i.next=5,new Promise((function(t){o.addEventListener("load",t),o.send()}));case 5:return s=i.sent,i.prev=6,i.abrupt("return",t.decodeAudioData(s.target.response));case 10:return i.prev=10,i.t0=i.catch(6),i.abrupt("return",new Promise((function(n){t.decodeAudioData(s.target.response,n)})));case 13:case"end":return i.stop()}}),r,this,[[6,10]])})))}n.default=a})).default,gi=ai.AsyncQueue,bi=C.InvalidArgumentError;function yi(t,n,e){if(!(this instanceof yi))return new yi(t,n,e);if(!t||!n)throw new bi("name and url are required arguments");(e=Object.assign({AudioFactory:"undefined"!=typeof Audio?Audio:null,maxDuration:0,shouldLoop:!1},e)).AudioPlayer=e.audioContext?wi.bind(wi,e.audioContext):e.AudioFactory,Object.defineProperties(this,{_activeEls:{value:new Map},_Audio:{value:e.AudioPlayer},_isSinkSupported:{value:null!==e.AudioFactory&&"function"==typeof e.AudioFactory.prototype.setSinkId},_maxDuration:{value:e.maxDuration},_maxDurationTimeout:{value:null,writable:!0},_operations:{value:new gi},_playPromise:{value:null,writable:!0},_shouldLoop:{value:e.shouldLoop},_sinkIds:{value:["default"]},isPlaying:{enumerable:!0,get:function(){return!!this._playPromise}},name:{enumerable:!0,value:t},url:{enumerable:!0,value:n}}),this._Audio&&this._play(!0,!1)}function ki(t){t&&(t.pause(),t.src="",t.srcObject=null,t.load())}yi.prototype._playAudioElement=function(t,n,e){var i=this,r=this._activeEls.get(t);if(!r)throw new bi('sinkId: "'+t+"\" doesn't have an audio element");return r.muted=!!n,r.loop=!!e,r.play().then((function(){return r})).catch((function(n){throw ki(r),i._activeEls.delete(t),n}))},yi.prototype._play=function(t,n){this.isPlaying&&this._stop(),this._maxDuration>0&&(this._maxDurationTimeout=setTimeout(this._stop.bind(this),this._maxDuration)),n="boolean"==typeof n?n:this._shouldLoop;var e=this;return this._playPromise=Promise.all(this._sinkIds.map((function(i){if(!e._Audio)return Promise.resolve();var r=e._activeEls.get(i);return r?e._playAudioElement(i,t,n):("function"==typeof(r=new e._Audio(e.url)).setAttribute&&r.setAttribute("crossorigin","anonymous"),new Promise((function(t){r.addEventListener("canplaythrough",t)})).then((function(){return(e._isSinkSupported?r.setSinkId(i):Promise.resolve()).then((function(){return e._activeEls.set(i,r),e._playPromise?e._playAudioElement(i,t,n):Promise.resolve()}))})))})))},yi.prototype._stop=function(){var t=this;this._activeEls.forEach((function(n,e){t._sinkIds.includes(e)?(n.pause(),n.currentTime=0):(ki(n),t._activeEls.delete(e))})),clearTimeout(this._maxDurationTimeout),this._playPromise=null,this._maxDurationTimeout=null},yi.prototype.setSinkIds=function(t){this._isSinkSupported&&[].splice.apply(this._sinkIds,[0,this._sinkIds.length].concat(t=t.forEach?t:[t]))},yi.prototype.stop=function(){var t=this;this._operations.enqueue((function(){return t._stop(),Promise.resolve()}))},yi.prototype.play=function(){var t=this;return this._operations.enqueue((function(){return t._play()}))};var xi=yi,Ei=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),r=u&&u.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},o=u&&u.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],s=0,u=o.length;s<u;s++,r++)i[r]=o[s];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=!1,a=!1,c=function(t){function n(e,i){var o,s=t.call(this)||this;if(s.audio=null,s.connections=[],s.isInitialized=!1,s.sounds={},s.token=null,s._activeConnection=null,s._chunderURIs=[],s._connectionInputStream=null,s._connectionSinkIds=["default"],s._edge=null,s._enabledSounds=((o={})[n.SoundName.Disconnect]=!0,o[n.SoundName.Incoming]=!0,o[n.SoundName.Outgoing]=!0,o),s._log=_.default.getInstance(),s._publisher=null,s._region=null,s._status=n.Status.Offline,s.mediaPresence={audio:!0},s.options={allowIncomingWhileBusy:!1,audioConstraints:!0,closeProtection:!1,codecPreferences:[ji.default.Codec.PCMU,ji.default.Codec.Opus],connectionFactory:ji.default,debug:!1,dscp:!0,enableIceRestart:!1,eventgw:"eventgw.twilio.com",forceAggressiveIceNomination:!1,iceServers:[],noRegister:!1,pStreamFactory:Se,preflight:!1,rtcConstraints:{},soundFactory:xi,sounds:{},warnings:!0},s.regTimer=null,s.soundcache=new Map,s.stream=null,s.destroy=function(){s._disconnectAll(),s._stopRegistrationTimer(),s.audio&&s.audio._unbind(),s.stream&&(s.stream.destroy(),s.stream=null),s._networkInformation&&"function"==typeof s._networkInformation.removeEventListener&&s._networkInformation.removeEventListener("change",s._publishNetworkChange),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("beforeunload",s._confirmClose),window.removeEventListener("unload",s.destroy),window.removeEventListener("pagehide",s.destroy))},s._confirmClose=function(t){if(!s._activeConnection)return"";var n=s.options.closeProtection||!1,e="string"!=typeof n?"A call is currently in-progress. Leaving or reloading this page will end the call.":n;return(t||window.event).returnValue=e,e},s._createDefaultPayload=function(t){var n={aggressive_nomination:s.options.forceAggressiveIceNomination,browser_extension:s._isBrowserExtension,dscp:!!s.options.dscp,ice_restart_enabled:s.options.enableIceRestart,platform:ii.getMediaEngine(),sdk_version:I};function e(t,e){e&&(n[t]=e)}if(t){var i=t.parameters.CallSid;e("call_sid",/^TJ/.test(i)?void 0:i),e("temp_call_sid",t.outboundConnectionId),e("audio_codec",t.codec),n.direction=t.direction}return e("gateway",s.stream&&s.stream.gateway),e("selected_region",s.options.region),e("region",s.stream&&s.stream.region),n},s._disconnectAll=function(){s.connections.splice(0).forEach((function(t){return t.disconnect()})),s._activeConnection&&s._activeConnection.disconnect()},s._onSignalingClose=function(){s.stream=null},s._onSignalingConnected=function(t){var n=Zn.getRegionShortcode(t.region);s._edge=Zn.regionToEdge[n]||t.region,s._region=n||t.region,s._sendPresence()},s._onSignalingError=function(t){if(t.error){var n=r({},t.error),e=t.callsid;e&&(n.connection=s._findConnection(e)),31201===n.code?n.twilioError=new C.AuthorizationErrors.AuthenticationFailed:31204===n.code?n.twilioError=new C.AuthorizationErrors.AccessTokenInvalid:31205===n.code?(s._stopRegistrationTimer(),n.twilioError=new C.AuthorizationErrors.AccessTokenExpired):n.twilioError||(n.twilioError=new C.GeneralErrors.UnknownError),s._log.info("Received error: ",n),s.emit("error",n)}},s._onSignalingInvite=function(t){var e=!!s._activeConnection;if(!e||s.options.allowIncomingWhileBusy)if(t.callsid&&t.sdp){var i=t.parameters||{};i.CallSid=i.CallSid||t.callsid;var r=Object.assign({},Sn.queryToJson(i.Params)),o=s._makeConnection(r,{callParameters:i,offerSdp:t.sdp});s.connections.push(o),o.once("accept",(function(){s.soundcache.get(n.SoundName.Incoming).stop(),s._publishNetworkChange()}));var u=s._enabledSounds.incoming&&!e?function(){return s.soundcache.get(n.SoundName.Incoming).play()}:function(){return Promise.resolve()};s._showIncomingConnection(o,u)}else s.emit("error",{message:"Malformed invite from gateway",twilioError:new C.ClientErrors.BadRequest});else s._log.info("Device busy; ignoring incoming invite")},s._onSignalingOffline=function(){s._log.info("Stream is offline"),s._status=n.Status.Offline,s._edge=null,s._region=null,s.emit("offline",s)},s._onSignalingReady=function(){s._log.info("Stream is ready"),s._status=n.Status.Ready,s.emit("ready",s)},s._publishNetworkChange=function(){s._activeConnection&&s._networkInformation&&s._publisher.info("network-information","network-change",{connection_type:s._networkInformation.type,downlink:s._networkInformation.downlink,downlinkMax:s._networkInformation.downlinkMax,effective_type:s._networkInformation.effectiveType,rtt:s._networkInformation.rtt},s._activeConnection)},s._updateInputStream=function(t){var n=s._activeConnection;return n&&!t?Promise.reject(new C.InvalidStateError("Cannot unset input device while a call is in progress.")):(s._connectionInputStream=t,n?n._setInputTracksFromStream(t):Promise.resolve())},s._updateSinkIds=function(t,n){return("ringtone"===t?s._updateRingtoneSinkIds(n):s._updateSpeakerSinkIds(n)).then((function(){s._publisher.info("audio",t+"-devices-set",{audio_device_ids:n},s._activeConnection)}),(function(e){throw s._publisher.error("audio",t+"-devices-set-failed",{audio_device_ids:n,message:e.message},s._activeConnection),e}))},window){var u=window,a=u.msBrowser||u.browser||u.chrome;s._isBrowserExtension=!!a&&!!a.runtime&&!!a.runtime.id||!!u.safari&&!!u.safari.extension}if(s._isBrowserExtension&&s._log.info("Running as browser extension."),navigator){var c=navigator;s._networkInformation=c.connection||c.mozConnection||c.webkitConnection}if(e)s.setup(e,i);else if(i)throw new C.InvalidArgumentError("Cannot construct a Device with options but without a token");return s}return i(n,t),Object.defineProperty(n,"audioContext",{get:function(){return n._audioContext},enumerable:!0,configurable:!0}),Object.defineProperty(n,"extension",{get:function(){var t,n,e="undefined"!=typeof document?document.createElement("audio"):{canPlayType:!1};try{t=e.canPlayType&&!!e.canPlayType("audio/mpeg").replace(/no/,"")}catch(n){t=!1}try{n=e.canPlayType&&!!e.canPlayType("audio/ogg;codecs='vorbis'").replace(/no/,"")}catch(t){n=!1}return n&&!t?"ogg":"mp3"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"isSupported",{get:function(){return ii.enabled()},enumerable:!0,configurable:!0}),Object.defineProperty(n,"packageName",{get:function(){return j},enumerable:!0,configurable:!0}),n.runPreflight=function(t,e){return new Yn.PreflightTest(t,r({audioContext:n._getOrCreateAudioContext()},e))},n.toString=function(){return"[Twilio.Device class]"},Object.defineProperty(n,"version",{get:function(){return I},enumerable:!0,configurable:!0}),n._getOrCreateAudioContext=function(){return n._audioContext||("undefined"!=typeof AudioContext?n._audioContext=new AudioContext:"undefined"!=typeof webkitAudioContext&&(n._audioContext=new webkitAudioContext)),n._audioContext},n.prototype.activeConnection=function(){return this.isInitialized?this._activeConnection||this.connections[0]:null},n.prototype.cancel=function(t){return this._addHandler(n.EventName.Cancel,t)},n.prototype.connect=function(t,e,i){if("function"==typeof t)return this._addHandler(n.EventName.Connect,t),null;if(this._throwUnlessSetup("connect"),this._activeConnection)throw new C.InvalidStateError("A Connection is already active");e=e||this.options&&this.options.audioConstraints||{};var r=this._activeConnection=this._makeConnection(t||{},{rtcConfiguration:i=i||this.options.rtcConfiguration});return this.connections.splice(0).forEach((function(t){return t.ignore()})),this.soundcache.get(n.SoundName.Incoming).stop(),r.accept(e),this._publishNetworkChange(),r},n.prototype.disconnect=function(t){return this._addHandler(n.EventName.Disconnect,t)},n.prototype.disconnectAll=function(){this._throwUnlessSetup("disconnectAll"),this._disconnectAll()},Object.defineProperty(n.prototype,"edge",{get:function(){return this._edge},enumerable:!0,configurable:!0}),n.prototype.error=function(t){return this._addHandler(n.EventName.Error,t)},n.prototype.incoming=function(t){return this._addHandler(n.EventName.Incoming,t)},n.prototype.offline=function(t){return this._addHandler(n.EventName.Offline,t)},n.prototype.ready=function(t){return this._addHandler(n.EventName.Ready,t)},n.prototype.region=function(){return this._log.warn("`Device.region` is deprecated and will be removed in the next major release. Please use `Device.edge` instead."),this._throwUnlessSetup("region"),"string"==typeof this._region?this._region:"offline"},n.prototype.registerPresence=function(){return this._throwUnlessSetup("registerPresence"),this.mediaPresence.audio=!0,this._sendPresence(),this},n.prototype.removeListener=function(t,n){return P.EventEmitter.prototype.removeListener.call(this,t,n),this},n.prototype.setup=function(t,e){var i=this;if(void 0===e&&(e={}),Sn.isLegacyEdge())throw new C.NotSupportedError("Microsoft Edge Legacy (https://support.microsoft.com/en-us/help/4533505/what-is-microsoft-edge-legacy) is deprecated and will not be able to connect to Twilio to make or receive calls after September 1st, 2020. Please see this documentation for a list of supported browsers https://www.twilio.com/docs/voice/client/javascript#supported-browsers");if(!n.isSupported&&!e.ignoreBrowserSupport){if(window&&window.location&&"http:"===window.location.protocol)throw new C.NotSupportedError("twilio.js wasn't able to find WebRTC browser support.           This is most likely because this page is served over http rather than https,           which does not support WebRTC in many browsers. Please load this page over https and           try again.");throw new C.NotSupportedError("twilio.js 1.3+ SDKs require WebRTC browser support.         For more information, see <https://www.twilio.com/docs/api/client/twilio-js>.         If you have any questions about this announcement, please contact         Twilio Support at <help@twilio.com>.")}if(!t)throw new C.InvalidArgumentError("Token is required for Device.setup()");if(Object.assign(this.options,e),this._log.setDefaultLevel(this.options.debug?_.default.levels.DEBUG:this.options.warnings?_.default.levels.WARN:_.default.levels.SILENT),this._chunderURIs=this.options.chunderw?["wss://"+this.options.chunderw+"/signal"]:Zn.getChunderURIs(this.options.edge,this.options.region,this._log.warn.bind(this._log)).map((function(t){return"wss://"+t+"/signal"})),void 0===n._isUnifiedPlanDefault&&(n._isUnifiedPlanDefault="undefined"!=typeof window&&"undefined"!=typeof RTCPeerConnection&&"undefined"!=typeof RTCRtpTransceiver&&Sn.isUnifiedPlanDefault(window,window.navigator,RTCPeerConnection,RTCRtpTransceiver)),n._getOrCreateAudioContext(),n._audioContext&&e.fakeLocalDTMF?n._dialtonePlayer||(n._dialtonePlayer=new In.default(n._audioContext)):n._dialtonePlayer&&(n._dialtonePlayer.cleanup(),delete n._dialtonePlayer),this.isInitialized)return this._log.info("Found existing Device; using new token but ignoring options"),this.updateToken(t),this;this.isInitialized=!0,this.options.dscp&&(this.options.rtcConstraints.optional=[{googDscp:!0}]);var r=function(t,n){return a||(i._log.warn("Device.sounds is deprecated and will be removed in the next breaking release. Please use the new functionality available on Device.audio."),a=!0),void 0!==n&&(i._enabledSounds[t]=n),i._enabledSounds[t]};[n.SoundName.Disconnect,n.SoundName.Incoming,n.SoundName.Outgoing].forEach((function(t){i.sounds[t]=r.bind(null,t)}));for(var o={disconnect:{filename:"disconnect",maxDuration:3e3},dtmf0:{filename:"dtmf-0",maxDuration:1e3},dtmf1:{filename:"dtmf-1",maxDuration:1e3},dtmf2:{filename:"dtmf-2",maxDuration:1e3},dtmf3:{filename:"dtmf-3",maxDuration:1e3},dtmf4:{filename:"dtmf-4",maxDuration:1e3},dtmf5:{filename:"dtmf-5",maxDuration:1e3},dtmf6:{filename:"dtmf-6",maxDuration:1e3},dtmf7:{filename:"dtmf-7",maxDuration:1e3},dtmf8:{filename:"dtmf-8",maxDuration:1e3},dtmf9:{filename:"dtmf-9",maxDuration:1e3},dtmfh:{filename:"dtmf-hash",maxDuration:1e3},dtmfs:{filename:"dtmf-star",maxDuration:1e3},incoming:{filename:"incoming",shouldLoop:!0},outgoing:{filename:"outgoing",maxDuration:3e3}},s=0,u=Object.keys(o);s<u.length;s++){var c=u[s],f=o[c],h=new this.options.soundFactory(c,this.options.sounds&&this.options.sounds[c]||R+"/"+f.filename+"."+n.extension+"?cache="+I,{audioContext:this.options.disableAudioContextSounds?null:n.audioContext,maxDuration:f.maxDuration,shouldLoop:f.shouldLoop});this.soundcache.set(c,h)}return this._publisher=(this.options.Publisher||ie)("twilio-js-sdk",t,{defaultPayload:this._createDefaultPayload,host:this.options.eventgw,metadata:{app_name:this.options.appName,app_version:this.options.appVersion}}),!1===this.options.publishEvents?this._publisher.disable():this._publisher.on("error",(function(t){i._log.warn("Cannot connect to insights.",t)})),this._networkInformation&&"function"==typeof this._networkInformation.addEventListener&&this._networkInformation.addEventListener("change",this._publishNetworkChange),this.audio=new(this.options.AudioHelper||jn.default)(this._updateSinkIds,this._updateInputStream,si,{audioContext:n.audioContext,enabledSounds:this._enabledSounds}),this.audio.on("deviceChange",(function(t){var n=i._activeConnection,e=t.map((function(t){return t.deviceId}));i._publisher.info("audio","device-change",{lost_active_device_ids:e},n),n&&n.mediaStream._onInputDevicesChanged()})),this.mediaPresence.audio=!this.options.noRegister,this.updateToken(t),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("unload",this.destroy),window.addEventListener("pagehide",this.destroy),this.options.closeProtection&&window.addEventListener("beforeunload",this._confirmClose)),this.on(n.EventName.Error,(function(){i.listenerCount("error")>1||i._log.info("Uncaught error event suppressed.")})),this},n.prototype.status=function(){return this._throwUnlessSetup("status"),this._activeConnection?n.Status.Busy:this._status},n.prototype.toString=function(){return"[Twilio.Device instance]"},n.prototype.unregisterPresence=function(){return this._throwUnlessSetup("unregisterPresence"),this.mediaPresence.audio=!1,this._sendPresence(),this},n.prototype.updateToken=function(t){this._throwUnlessSetup("updateToken"),this.token=t,this.register(t)},n.prototype._addHandler=function(t,n){return s||(this._log.warn("Device callback handlers (connect, error, offline, incoming, cancel, ready, disconnect)         have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: device.on('"+t+"', handler)"),s=!0),this.addListener(t,n),this},n.prototype._asyncEmit=function(t){for(var n=this,e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];setTimeout((function(){return n.emit.apply(n,o([t],e))}))},n.prototype._findConnection=function(t){return this.connections.find((function(n){return n.parameters.CallSid===t||n.outboundConnectionId===t}))||null},n.prototype._makeConnection=function(t,e){var i=this;if(void 0===n._isUnifiedPlanDefault)throw new C.InvalidStateError("Device has not been initialized.");var r={audioHelper:this.audio,getUserMedia:si,isUnifiedPlanDefault:n._isUnifiedPlanDefault,pstream:this.stream,publisher:this._publisher,soundcache:this.soundcache};e=Object.assign({MediaStream:this.options.MediaStream||this.options.mediaStreamFactory||ii.PeerConnection,audioConstraints:this.options.audioConstraints,beforeAccept:function(t){i._activeConnection&&i._activeConnection!==t&&(i._activeConnection.disconnect(),i._removeConnection(i._activeConnection))},codecPreferences:this.options.codecPreferences,dialtonePlayer:n._dialtonePlayer,dscp:this.options.dscp,enableIceRestart:this.options.enableIceRestart,enableRingingState:this.options.enableRingingState,forceAggressiveIceNomination:this.options.forceAggressiveIceNomination,getInputStream:function(){return i.options.fileInputStream||i._connectionInputStream},getSinkIds:function(){return i._connectionSinkIds},maxAverageBitrate:this.options.maxAverageBitrate,preflight:this.options.preflight,rtcConfiguration:this.options.rtcConfiguration||{iceServers:this.options.iceServers},rtcConstraints:this.options.rtcConstraints,shouldPlayDisconnect:function(){return i._enabledSounds.disconnect},twimlParams:t},e);var o=new this.options.connectionFactory(r,e);return o.once("accept",(function(){i._removeConnection(o),i._activeConnection=o,i.audio&&i.audio._maybeStartPollingVolume(),o.direction===ji.default.CallDirection.Outgoing&&i._enabledSounds.outgoing&&i.soundcache.get(n.SoundName.Outgoing).play();var t={edge:i._edge||i._region},e=i.options.edge;e&&(t.selected_edge=Array.isArray(e)?e:[e]),i._publisher.info("settings","edge",t,o),i._asyncEmit("connect",o)})),o.addListener("error",(function(t){"closed"===o.status()&&i._removeConnection(o),i.audio&&i.audio._maybeStopPollingVolume(),i._maybeStopIncomingSound(),i._asyncEmit("error",t)})),o.once("cancel",(function(){i._log.info("Canceled: "+o.parameters.CallSid),i._removeConnection(o),i.audio&&i.audio._maybeStopPollingVolume(),i._maybeStopIncomingSound(),i._asyncEmit("cancel",o)})),o.once("disconnect",(function(){i.audio&&i.audio._maybeStopPollingVolume(),i._removeConnection(o),i._asyncEmit("disconnect",o)})),o.once("reject",(function(){i._log.info("Rejected: "+o.parameters.CallSid),i.audio&&i.audio._maybeStopPollingVolume(),i._removeConnection(o),i._maybeStopIncomingSound()})),o.once("transportClose",(function(){o.status()===ji.default.State.Pending&&(i.audio&&i.audio._maybeStopPollingVolume(),i._removeConnection(o),i._maybeStopIncomingSound())})),o},n.prototype._maybeStopIncomingSound=function(){this.connections.length||this.soundcache.get(n.SoundName.Incoming).stop()},n.prototype._removeConnection=function(t){this._activeConnection===t&&(this._activeConnection=null);for(var n=this.connections.length-1;n>=0;n--)t===this.connections[n]&&this.connections.splice(n,1)},n.prototype._sendPresence=function(){this.stream&&(this.stream.register({audio:this.mediaPresence.audio}),this.mediaPresence.audio?this._startRegistrationTimer():this._stopRegistrationTimer())},n.prototype._setupStream=function(t){this._log.info("Setting up VSP"),this.stream=this.options.pStreamFactory(t,this._chunderURIs,{backoffMaxMs:this.options.backoffMaxMs}),this.stream.addListener("close",this._onSignalingClose),this.stream.addListener("connected",this._onSignalingConnected),this.stream.addListener("error",this._onSignalingError),this.stream.addListener("invite",this._onSignalingInvite),this.stream.addListener("offline",this._onSignalingOffline),this.stream.addListener("ready",this._onSignalingReady)},n.prototype._showIncomingConnection=function(t,n){var e,i=this;return Promise.race([n(),new Promise((function(t,n){e=setTimeout((function(){n(new Error("Playing incoming ringtone took too long; it might not play. Continuing execution..."))}),2e3)}))]).catch((function(t){i._log.info(t.message)})).then((function(){clearTimeout(e),i.emit("incoming",t)}))},n.prototype._startRegistrationTimer=function(){var t=this;this._stopRegistrationTimer(),this.regTimer=setTimeout((function(){t._sendPresence()}),3e4)},n.prototype._stopRegistrationTimer=function(){this.regTimer&&clearTimeout(this.regTimer)},n.prototype._throwUnlessSetup=function(t){if(!this.isInitialized)throw new C.InvalidStateError("Call Device.setup() before "+t)},n.prototype._updateRingtoneSinkIds=function(t){return Promise.resolve(this.soundcache.get(n.SoundName.Incoming).setSinkIds(t))},n.prototype._updateSpeakerSinkIds=function(t){Array.from(this.soundcache.entries()).filter((function(t){return t[0]!==n.SoundName.Incoming})).forEach((function(n){return n[1].setSinkIds(t)})),this._connectionSinkIds=t;var e=this._activeConnection;return e?e._setSinkIds(t):Promise.resolve()},n.prototype.register=function(t){this.stream?(this.stream.setToken(t),this._publisher.setToken(t)):this._setupStream(t)},n}(P.EventEmitter);!function(t){var n,e,i;(n=t.EventName||(t.EventName={})).Cancel="cancel",n.Connect="connect",n.Disconnect="disconnect",n.Error="error",n.Incoming="incoming",n.Offline="offline",n.Ready="ready",(e=t.Status||(t.Status={})).Busy="busy",e.Offline="offline",e.Ready="ready",(i=t.SoundName||(t.SoundName={})).Incoming="incoming",i.Outgoing="outgoing",i.Disconnect="disconnect",i.Dtmf0="dtmf0",i.Dtmf1="dtmf1",i.Dtmf2="dtmf2",i.Dtmf3="dtmf3",i.Dtmf4="dtmf4",i.Dtmf5="dtmf5",i.Dtmf6="dtmf6",i.Dtmf7="dtmf7",i.Dtmf8="dtmf8",i.Dtmf9="dtmf9",i.DtmfS="dtmfs",i.DtmfH="dtmfh"}(c||(c={})),n.default=c})),Ci=a((function(t,n){Object.defineProperty(n,"__esModule",{value:!0});var e=function(){function t(t,n){var e;void 0===n&&(n=!1),this.deleted=!1;var i=t.candidate.split("network-cost ");i[1]&&(e=parseInt(i[1],10)),this.candidateType=t.type,this.ip=t.ip||t.address,this.isRemote=n,this.networkCost=e,this.port=t.port,this.priority=t.priority,this.protocol=t.protocol,this.relatedAddress=t.relatedAddress,this.relatedPort=t.relatedPort,this.tcpType=t.tcpType,this.transportId=t.sdpMid}return t.prototype.toPayload=function(){return{candidate_type:this.candidateType,deleted:this.deleted,ip:this.ip,is_remote:this.isRemote,"network-cost":this.networkCost,port:this.port,priority:this.priority,protocol:this.protocol,related_address:this.relatedAddress,related_port:this.relatedPort,tcp_type:this.tcpType,transport_id:this.transportId}},t}();n.IceCandidate=e}));function Ti(t){return"number"==typeof t&&!isNaN(t)&&isFinite(t)&&t>=0}var Si={calculate:function(t,n,e){if(!Ti(t)||!Ti(n)||!Ti(e))return null;var i=function(t,n,e){var i=t+2*n+10,r=0;switch(!0){case i<160:r=94.768-i/40;break;case i<1e3:r=94.768-(i-120)/10;break;case i>=1e3:r=94.768-i/100}var o=.01;switch(!0){case-1===e:o=0,r=0;break;case e<=r/2.5:o=2.5;break;case e>r/2.5&&e<100:o=.25}return r-e*o}(t,n,e),r=1+.035*i+7e-6*i*(i-60)*(100-i);return r>=1&&r<4.6?r:null}},Oi=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),r=u&&u.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)},o=u&&u.__spreadArrays||function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var i=Array(t),r=0;for(n=0;n<e;n++)for(var o=arguments[n],s=0,u=o.length;s<u;s++,r++)i[r]=o[s];return i};Object.defineProperty(n,"__esModule",{value:!0});var s=$n,a={audioInputLevel:{minStandardDeviation:327.67,sampleCount:10},audioOutputLevel:{minStandardDeviation:327.67,sampleCount:10},bytesReceived:{clearCount:2,min:1,raiseCount:3,sampleCount:3},bytesSent:{clearCount:2,min:1,raiseCount:3,sampleCount:3},jitter:{max:30},mos:{min:3},packetsLostFraction:[{max:1},{clearValue:1,maxAverage:3,sampleCount:7}],rtt:{max:400}},c=function(t){function n(n){var e=t.call(this)||this;e._activeWarnings=new Map,e._currentStreaks=new Map,e._inputVolumes=[],e._outputVolumes=[],e._sampleBuffer=[],e._supplementalSampleBuffers={audioInputLevel:[],audioOutputLevel:[]},e._warningsEnabled=!0,e._getRTCStats=(n=n||{}).getRTCStats||s,e._mos=n.Mos||Si,e._peerConnection=n.peerConnection,e._thresholds=r(r({},a),n.thresholds);var i=Object.values(e._thresholds).map((function(t){return t.sampleCount})).filter((function(t){return!!t}));return e._maxSampleCount=Math.max.apply(Math,o([5],i)),e._peerConnection&&e.enable(e._peerConnection),e}return i(n,t),n.prototype.addVolumes=function(t,n){this._inputVolumes.push(t),this._outputVolumes.push(n)},n.prototype.disable=function(){return clearInterval(this._sampleInterval),delete this._sampleInterval,this},n.prototype.disableWarnings=function(){return this._warningsEnabled&&this._activeWarnings.clear(),this._warningsEnabled=!1,this},n.prototype.enable=function(t){if(t){if(this._peerConnection&&t!==this._peerConnection)throw new C.InvalidArgumentError("Attempted to replace an existing PeerConnection in StatsMonitor.enable");this._peerConnection=t}if(!this._peerConnection)throw new C.InvalidArgumentError("Can not enable StatsMonitor without a PeerConnection");return this._sampleInterval=this._sampleInterval||setInterval(this._fetchSample.bind(this),1e3),this},n.prototype.enableWarnings=function(){return this._warningsEnabled=!0,this},n.prototype.hasActiveWarning=function(t,n){return!!this._activeWarnings.get(t+":"+n)},n.prototype._addSample=function(t){var n=this._sampleBuffer;n.push(t),n.length>this._maxSampleCount&&n.splice(0,n.length-this._maxSampleCount)},n.prototype._clearWarning=function(t,n,e){var i=t+":"+n,o=this._activeWarnings.get(i);!o||Date.now()-o.timeRaised<5e3||(this._activeWarnings.delete(i),this.emit("warning-cleared",r(r({},e),{name:t,threshold:{name:n,value:this._thresholds[t][n]}})))},n.prototype._createSample=function(t,n){var e=t.bytesSent-(n&&n.totals.bytesSent||0),i=t.bytesReceived-(n&&n.totals.bytesReceived||0),r=t.packetsSent-(n&&n.totals.packetsSent||0),o=t.packetsReceived-(n&&n.totals.packetsReceived||0),s=t.packetsLost-(n&&n.totals.packetsLost||0),u=o+s,a=u>0?s/u*100:0,c=t.packetsReceived+t.packetsLost,f=c>0?t.packetsLost/c*100:100,h="number"!=typeof t.rtt&&n?n.rtt:t.rtt,l=this._inputVolumes.splice(0);this._supplementalSampleBuffers.audioInputLevel.push(l);var d=this._outputVolumes.splice(0);return this._supplementalSampleBuffers.audioOutputLevel.push(d),{audioInputLevel:Math.round(Sn.average(l)),audioOutputLevel:Math.round(Sn.average(d)),bytesReceived:i,bytesSent:e,codecName:t.codecName,jitter:t.jitter,mos:this._mos.calculate(h,t.jitter,n&&a),packetsLost:s,packetsLostFraction:a,packetsReceived:o,packetsSent:r,rtt:h,timestamp:t.timestamp,totals:{bytesReceived:t.bytesReceived,bytesSent:t.bytesSent,packetsLost:t.packetsLost,packetsLostFraction:f,packetsReceived:t.packetsReceived,packetsSent:t.packetsSent}}},n.prototype._fetchSample=function(){var t=this;this._getSample().then((function(n){t._addSample(n),t._raiseWarnings(),t.emit("sample",n)})).catch((function(n){t.disable(),t.emit("error",n)}))},n.prototype._getSample=function(){var t=this;return this._getRTCStats(this._peerConnection).then((function(n){var e=null;return t._sampleBuffer.length&&(e=t._sampleBuffer[t._sampleBuffer.length-1]),t._createSample(n,e)}))},n.prototype._raiseWarning=function(t,n,e){var i=t+":"+n;if(!this._activeWarnings.has(i)){this._activeWarnings.set(i,{timeRaised:Date.now()});var o,s=this._thresholds[t];if(Array.isArray(s)){var u=s.find((function(t){return n in t}));u&&(o=u[n])}else o=this._thresholds[t][n];this.emit("warning",r(r({},e),{name:t,threshold:{name:n,value:o}}))}},n.prototype._raiseWarnings=function(){var t=this;this._warningsEnabled&&Object.keys(this._thresholds).forEach((function(n){return t._raiseWarningsForStat(n)}))},n.prototype._raiseWarningsForStat=function(t){var n=this;(Array.isArray(this._thresholds[t])?this._thresholds[t]:[this._thresholds[t]]).forEach((function(e){var i=n._sampleBuffer,r=e.clearCount||0,s=e.raiseCount||3,u=e.sampleCount||n._maxSampleCount,a=i.slice(-u),c=a.map((function(n){return n[t]}));if(!c.some((function(t){return null==t}))){var f;if("number"==typeof e.max&&((f=function(t,n){return n.reduce((function(n,e){return n+(e>t?1:0)}),0)}(e.max,c))>=s?n._raiseWarning(t,"max",{values:c,samples:a}):f<=r&&n._clearWarning(t,"max",{values:c,samples:a})),"number"==typeof e.min&&((f=function(t,n){return n.reduce((function(n,e){return n+(e<t?1:0)}),0)}(e.min,c))>=s?n._raiseWarning(t,"min",{values:c,samples:a}):f<=r&&n._clearWarning(t,"min",{values:c,samples:a})),"number"==typeof e.maxDuration&&i.length>1){var h=(a=i.slice(-2))[0][t],l=a[1][t],d=n._currentStreaks.get(t)||0,v=h===l?d+1:0;n._currentStreaks.set(t,v),v>=e.maxDuration?n._raiseWarning(t,"maxDuration",{value:v}):0===v&&n._clearWarning(t,"maxDuration",{value:d})}if("number"==typeof e.minStandardDeviation){var p=n._supplementalSampleBuffers[t];if(!p||p.length<e.sampleCount)return;p.length>e.sampleCount&&p.splice(0,p.length-e.sampleCount);var m=function(t){if(t.length<=0)return null;var n=t.reduce((function(t,n){return t+n}),0)/t.length,e=t.map((function(t){return Math.pow(t-n,2)}));return Math.sqrt(e.reduce((function(t,n){return t+n}),0)/e.length)}(function(t){return t.reduce((function(t,n){return o(t,n)}),[])}(p.slice(-u)));if("number"!=typeof m)return;m<e.minStandardDeviation?n._raiseWarning(t,"minStandardDeviation",{value:m}):n._clearWarning(t,"minStandardDeviation",{value:m})}[["maxAverage",function(t,n){return t>n}],["minAverage",function(t,n){return t<n}]].forEach((function(i){var r=i[0],o=i[1];if("number"==typeof e[r]&&c.length>=u){var s=Sn.average(c);o(s,e[r])?n._raiseWarning(t,r,{values:c,samples:a}):o(s,e.clearValue||e[r])||n._clearWarning(t,r,{values:c,samples:a})}}))}}))},n}(P.EventEmitter);n.default=c})),ji=a((function(t,n){var e,i=u&&u.__extends||(e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)},function(t,n){function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),r=u&&u.__assign||function(){return(r=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t}).apply(this,arguments)};Object.defineProperty(n,"__esModule",{value:!0});var o=ii.PeerConnection,s=Ne,a={factor:1.1,initialDelay:1,maxDelay:3e4,randomisationFactor:.5},c={disconnect:!0,info:{code:31003,message:"Connection with Twilio was interrupted.",twilioError:new C.MediaErrors.ConnectionError}},f={packetsLostFraction:{max:"packet-loss",maxAverage:"packets-lost-fraction"}},h={audioInputLevel:"audio-input-level",audioOutputLevel:"audio-output-level",bytesReceived:"bytes-received",bytesSent:"bytes-sent",jitter:"jitter",mos:"mos",rtt:"rtt"},l={max:"high-",maxAverage:"high-",maxDuration:"constant-",min:"low-",minStandardDeviation:"constant-"},d=!1,v=function(t){function n(e,i){var s=t.call(this)||this;s.parameters={},s._inputVolumeStreak=0,s._isAnswered=!1,s._isCancelled=!1,s._latestInputVolume=0,s._latestOutputVolume=0,s._log=_.default.getInstance(),s._metricsSamples=[],s._outputVolumeStreak=0,s._soundcache=new Map,s._status=n.State.Pending,s.options={enableRingingState:!1,mediaStreamFactory:o,offerSdp:null,shouldPlayDisconnect:function(){return!0}},s.sendHangup=!0,s.toString=function(){return"[Twilio.Connection instance]"},s._emitWarning=function(t,n,e,i,r,o){var u=t+"warning"+(r?"-cleared":"-raised");if("constant-audio-input-level"!==n||!s.isMuted()){var a=r?"info":"warning";"constant-audio-output-level"===n&&(a="info");var c={threshold:e};i&&(i instanceof Array?c.values=i.map((function(t){return"number"==typeof t?Math.round(100*t)/100:i})):c.value=i),s._publisher.post(a,u,n,{data:c},s),"constant-audio-output-level"!==n&&s.emit(r?"warning-cleared":"warning",n,o&&!r?o:null)}},s._onAnswer=function(t){s._isAnswered||(s._setCallSid(t),s._isAnswered=!0,s._maybeTransitionToOpen())},s._onCancel=function(t){s.parameters.CallSid===t.callsid&&(s._isCancelled=!0,s._publisher.info("connection","cancel",null,s),s._cleanupEventListeners(),s.mediaStream.close(),s._status=n.State.Closed,s.emit("cancel"),s.pstream.removeListener("cancel",s._onCancel))},s._onHangup=function(t){if(t.callsid&&(s.parameters.CallSid||s.outboundConnectionId)){if(t.callsid!==s.parameters.CallSid&&t.callsid!==s.outboundConnectionId)return}else if(t.callsid)return;if(s._log.info("Received HANGUP from gateway"),t.error){var n={code:t.error.code||31e3,connection:s,message:t.error.message||"Error sent from gateway in HANGUP",twilioError:new C.GeneralErrors.ConnectionError};s._log.error("Received an error from the gateway:",n),s.emit("error",n)}s.sendHangup=!1,s._publisher.info("connection","disconnected-by-remote",null,s),s._disconnect(null,!0),s._cleanupEventListeners()},s._onMediaFailure=function(t){var e=n.MediaFailure,i=e.ConnectionDisconnected,r=e.ConnectionFailed,o=e.LowBytes,u=t===r||t===e.IceGatheringFailed;if(!s.options.enableIceRestart&&u||!Sn.isChrome(window,window.navigator)&&t===r)return s.mediaStream.onerror(c);if(s.options.enableIceRestart)if(s._status!==n.State.Reconnecting){var f=s.mediaStream.version.pc,h=f&&"disconnected"===f.iceConnectionState,l=s._monitor.hasActiveWarning("bytesSent","min")||s._monitor.hasActiveWarning("bytesReceived","min");if(t===o&&h||t===i&&l||u){var d={code:53405,message:"Media connection failed.",twilioError:new C.MediaErrors.ConnectionError};s._log.warn("ICE Connection disconnected."),s._publisher.warn("connection","error",d,s),s._publisher.info("connection","reconnecting",null,s),s._mediaReconnectStartTime=Date.now(),s._status=n.State.Reconnecting,s._mediaReconnectBackoff.reset(),s._mediaReconnectBackoff.backoff(),s.emit("reconnecting",d)}}else if(u){if(Date.now()-s._mediaReconnectStartTime>a.maxDelay)return s._log.info("Exceeded max ICE retries"),s.mediaStream.onerror(c);s._mediaReconnectBackoff.backoff()}},s._onMediaReconnected=function(){s._status===n.State.Reconnecting&&(s._log.info("ICE Connection reestablished."),s._publisher.info("connection","reconnected",null,s),s._status=n.State.Open,s.emit("reconnected"))},s._onRinging=function(t){if(s._setCallSid(t),s._status===n.State.Connecting||s._status===n.State.Ringing){var e=!!t.sdp;s.options.enableRingingState?(s._status=n.State.Ringing,s._publisher.info("connection","outgoing-ringing",{hasEarlyMedia:e},s),s.emit("ringing",e)):e&&s._onAnswer(t)}},s._onRTCSample=function(t){var n=r(r({},t),{inputVolume:s._latestInputVolume,outputVolume:s._latestOutputVolume});s._codec=n.codecName,s._metricsSamples.push(n),s._metricsSamples.length>=10&&s._publishMetrics(),s.emit("sample",t)},s._onTransportClose=function(){s._log.error("Received transportClose from pstream"),s.emit("transportClose")},s._reemitWarning=function(t,n){var e,i=/^audio/.test(t.name)?"audio-level-":"network-quality-";t.name in f?e=f[t.name][t.threshold.name]:t.name in h&&(e=h[t.name]),s._emitWarning(i,l[t.threshold.name]+e,t.threshold.value,t.values||t.value,n,t)},s._reemitWarningCleared=function(t){s._reemitWarning(t,!0)},s._isUnifiedPlanDefault=e.isUnifiedPlanDefault,s._soundcache=e.soundcache,s.message=i&&i.twimlParams||{},s.customParameters=new Map(Object.entries(s.message).map((function(t){return[t[0],String(t[1])]}))),Object.assign(s.options,i),s.options.callParameters&&(s.parameters=s.options.callParameters),s._direction=s.parameters.CallSid?n.CallDirection.Incoming:n.CallDirection.Outgoing,s.callerInfo=s._direction===n.CallDirection.Incoming&&s.parameters&&s.parameters.StirStatus?{isVerified:"TN-Validation-Passed-A"===s.parameters.StirStatus}:null,s._mediaReconnectBackoff=be(a),s._mediaReconnectBackoff.on("ready",(function(){return s.mediaStream.iceRestart()})),s.outboundConnectionId="TJSxxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=16*Math.random()|0;return("x"===t?n:3&n|8).toString(16)}));var u=s._publisher=e.publisher;s._direction===n.CallDirection.Incoming?u.info("connection","incoming",null,s):u.info("connection","outgoing",{preflight:s.options.preflight},s);var d=s._monitor=new(s.options.StatsMonitor||Oi.default);return d.on("sample",s._onRTCSample),d.disableWarnings(),setTimeout((function(){return d.enableWarnings()}),5e3),d.on("warning",(function(t,e){"bytesSent"!==t.name&&"bytesReceived"!==t.name||s._onMediaFailure(n.MediaFailure.LowBytes),s._reemitWarning(t,e)})),d.on("warning-cleared",(function(t){s._reemitWarningCleared(t)})),s.mediaStream=new(s.options.MediaStream||s.options.mediaStreamFactory)(e.audioHelper,e.pstream,e.getUserMedia,{codecPreferences:s.options.codecPreferences,dscp:s.options.dscp,enableIceRestart:s.options.enableIceRestart,forceAggressiveIceNomination:s.options.forceAggressiveIceNomination,isUnifiedPlan:s._isUnifiedPlanDefault,maxAverageBitrate:s.options.maxAverageBitrate,preflight:s.options.preflight}),s.on("volume",(function(t,n){s._inputVolumeStreak=s._checkVolume(t,s._inputVolumeStreak,s._latestInputVolume,"input"),s._outputVolumeStreak=s._checkVolume(n,s._outputVolumeStreak,s._latestOutputVolume,"output"),s._latestInputVolume=t,s._latestOutputVolume=n})),s.mediaStream.onvolume=function(t,n,e,i){d.addVolumes(e/255*32767,i/255*32767),s.emit("volume",t,n)},s.mediaStream.ondtlstransportstatechange=function(t){s._publisher.post("failed"===t?"error":"debug","dtls-transport-state",t,null,s)},s.mediaStream.onpcconnectionstatechange=function(t){var n="debug",e=s.mediaStream.getRTCDtlsTransport();"failed"===t&&(n=e&&"failed"===e.state?"error":"warning"),s._publisher.post(n,"pc-connection-state",t,null,s)},s.mediaStream.onicecandidate=function(t){var n=new Ci.IceCandidate(t).toPayload();s._publisher.debug("ice-candidate","ice-candidate",n,s)},s.mediaStream.onselectedcandidatepairchange=function(t){var n=new Ci.IceCandidate(t.local).toPayload(),e=new Ci.IceCandidate(t.remote,!0).toPayload();s._publisher.debug("ice-candidate","selected-ice-candidate-pair",{local_candidate:n,remote_candidate:e},s)},s.mediaStream.oniceconnectionstatechange=function(t){s._publisher.post("failed"===t?"error":"debug","ice-connection-state",t,null,s)},s.mediaStream.onicegatheringfailure=function(t){s._publisher.warn("ice-gathering-state",t,null,s),s._onMediaFailure(n.MediaFailure.IceGatheringFailed)},s.mediaStream.onicegatheringstatechange=function(t){s._publisher.debug("ice-gathering-state",t,null,s)},s.mediaStream.onsignalingstatechange=function(t){s._publisher.debug("signaling-state",t,null,s)},s.mediaStream.ondisconnected=function(t){s._log.info(t),s._publisher.warn("network-quality-warning-raised","ice-connectivity-lost",{message:t},s),s.emit("warning","ice-connectivity-lost"),s._onMediaFailure(n.MediaFailure.ConnectionDisconnected)},s.mediaStream.onfailed=function(){s._onMediaFailure(n.MediaFailure.ConnectionFailed)},s.mediaStream.onconnected=function(){s._status===n.State.Reconnecting&&s._onMediaReconnected()},s.mediaStream.onreconnected=function(t){s._log.info(t),s._publisher.info("network-quality-warning-cleared","ice-connectivity-lost",{message:t},s),s.emit("warning-cleared","ice-connectivity-lost"),s._onMediaReconnected()},s.mediaStream.onerror=function(t){!0===t.disconnect&&s._disconnect(t.info&&t.info.message);var n={code:t.info.code,connection:s,info:t.info,message:t.info.message||"Error with mediastream",twilioError:t.info.twilioError};s._log.error("Received an error from MediaStream:",t),s.emit("error",n)},s.mediaStream.onopen=function(){s._status!==n.State.Open&&s._status!==n.State.Reconnecting&&(s._status===n.State.Ringing||s._status===n.State.Connecting?(s.mute(!1),s._maybeTransitionToOpen()):s.mediaStream.close())},s.mediaStream.onclose=function(){s._status=n.State.Closed,s.options.shouldPlayDisconnect&&s.options.shouldPlayDisconnect()&&!s._isCancelled&&s._soundcache.get(Ei.default.SoundName.Disconnect).play(),d.disable(),s._publishMetrics(),s._isCancelled||s.emit("disconnect",s)},s.pstream=e.pstream,s.pstream.on("cancel",s._onCancel),s.pstream.on("ringing",s._onRinging),s.pstream.on("transportClose",s._onTransportClose),s.on("error",(function(t){s._publisher.error("connection","error",{code:t.code,message:t.message},s),s.pstream&&"disconnected"===s.pstream.status&&s._cleanupEventListeners()})),s.on("disconnect",(function(){s._cleanupEventListeners()})),s}return i(n,t),Object.defineProperty(n.prototype,"direction",{get:function(){return this._direction},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"codec",{get:function(){return this._codec},enumerable:!0,configurable:!0}),n.prototype._getRealCallSid=function(){return this._log.warn("_getRealCallSid is deprecated and will be removed in 2.0."),/^TJ/.test(this.parameters.CallSid)?null:this.parameters.CallSid},n.prototype._getTempCallSid=function(){return this._log.warn("_getTempCallSid is deprecated and will be removed in 2.0.                     Please use outboundConnectionId instead."),this.outboundConnectionId},n.prototype._setInputTracksFromStream=function(t){return this.mediaStream.setInputTracksFromStream(t)},n.prototype._setSinkIds=function(t){return this.mediaStream._setSinkIds(t)},n.prototype.accept=function(t,e){var i=this;if("function"!=typeof t){if(this._status===n.State.Pending){var r=t||this.options.audioConstraints;this._status=n.State.Connecting,this.options.beforeAccept&&this.options.beforeAccept(this);var o="function"==typeof this.options.getInputStream&&this.options.getInputStream();(o?this.mediaStream.setInputTracksFromStream(o):this.mediaStream.openWithConstraints(r)).then((function(){i._publisher.info("get-user-media","succeeded",{data:{audioConstraints:r}},i),function(){if(i._status!==n.State.Connecting)return i._cleanupEventListeners(),void i.mediaStream.close();var t=function(t){i._publisher.info("connection",i._direction===n.CallDirection.Incoming?"accepted-by-local":"accepted-by-remote",null,i);var e=s(i.mediaStream.version.getSDP());i._publisher.info("settings","codec",{codec_params:e.codecParams,selected_codec:e.codecName},i),i._monitor.enable(t)},r="function"==typeof i.options.getSinkIds&&i.options.getSinkIds();if(Array.isArray(r)&&i.mediaStream._setSinkIds(r).catch((function(){})),i.pstream.addListener("hangup",i._onHangup),e=e||i.options.rtcConfiguration,i._direction===n.CallDirection.Incoming)i._isAnswered=!0,i.mediaStream.answerIncomingCall(i.parameters.CallSid,i.options.offerSdp,i.options.rtcConstraints,e,t);else{var o=Array.from(i.customParameters.entries()).map((function(t){return encodeURIComponent(t[0])+"="+encodeURIComponent(t[1])})).join("&");i.pstream.once("answer",i._onAnswer.bind(i)),i.mediaStream.makeOutgoingCall(i.pstream.token,o,i.outboundConnectionId,i.options.rtcConstraints,e,t)}}()}),(function(t){var n,e;31208===t.code||-1!==["PermissionDeniedError","NotAllowedError"].indexOf(t.name)?(e=31208,n="User denied access to microphone, or the web browser did not allow microphone access at this address.",i._publisher.error("get-user-media","denied",{data:{audioConstraints:r,error:t}},i)):(e=31201,n="Error occurred while accessing microphone: "+t.name+(t.message?" ("+t.message+")":""),i._publisher.error("get-user-media","failed",{data:{audioConstraints:r,error:t}},i)),i._disconnect(),i.emit("error",{message:n,code:e})}))}}else this._addHandler("accept",t)},n.prototype.cancel=function(t){this._log.warn(".cancel() is deprecated. Please use .ignore() instead."),t?this.ignore(t):this.ignore()},n.prototype.disconnect=function(t){"function"!=typeof t?this._disconnect():this._addHandler("disconnect",t)},n.prototype.error=function(t){"function"==typeof t&&this._addHandler("error",t)},n.prototype.getLocalStream=function(){return this.mediaStream&&this.mediaStream.stream},n.prototype.getRemoteStream=function(){return this.mediaStream&&this.mediaStream._remoteStream},n.prototype.ignore=function(t){"function"!=typeof t?this._status===n.State.Pending&&(this._status=n.State.Closed,this.emit("cancel"),this.mediaStream.ignore(this.parameters.CallSid),this._publisher.info("connection","ignored-by-local",null,this)):this._addHandler("cancel",t)},n.prototype.isMuted=function(){return this.mediaStream.isMuted},n.prototype.mute=function(t){if(void 0===t&&(t=!0),"function"!=typeof t){var n=this.mediaStream.isMuted;this.mediaStream.mute(t);var e=this.mediaStream.isMuted;n!==e&&(this._publisher.info("connection",e?"muted":"unmuted",null,this),this.emit("mute",e,this))}else this._addHandler("mute",t)},n.prototype.postFeedback=function(t,e){if(null==t)return this._postFeedbackDeclined();if(!Object.values(n.FeedbackScore).includes(t))throw new C.InvalidArgumentError("Feedback score must be one of: "+Object.values(n.FeedbackScore));if(null!=e&&!Object.values(n.FeedbackIssue).includes(e))throw new C.InvalidArgumentError("Feedback issue must be one of: "+Object.values(n.FeedbackIssue));return this._publisher.info("feedback","received",{issue_name:e,quality_score:t},this,!0)},n.prototype.reject=function(t){"function"!=typeof t?this._status===n.State.Pending&&(this.pstream.reject(this.parameters.CallSid),this._status=n.State.Closed,this.emit("reject"),this.mediaStream.reject(this.parameters.CallSid),this._publisher.info("connection","rejected-by-local",null,this)):this._addHandler("reject",t)},n.prototype.sendDigits=function(t){if(t.match(/[^0-9*#w]/))throw new C.InvalidArgumentError("Illegal character passed into sendDigits");var n=[];t.split("").forEach((function(t){var e="w"!==t?"dtmf"+t:"";"dtmf*"===e&&(e="dtmfs"),"dtmf#"===e&&(e="dtmfh"),n.push(e)})),function t(e,i){var r=n.shift();r&&(i?i.play(r):e.get(r).play()),n.length&&setTimeout(t.bind(null,e),200)}(this._soundcache,this.options.dialtonePlayer);var e=this.mediaStream.getOrCreateDTMFSender();if(e){if(!("canInsertDTMF"in e)||e.canInsertDTMF)return this._log.info("Sending digits using RTCDTMFSender"),void function t(n){if(n.length){var i=n.shift();i&&i.length&&e.insertDTMF(i,160,70),setTimeout(t.bind(null,n),500)}}(t.split("w"));this._log.info("RTCDTMFSender cannot insert DTMF")}this._log.info("Sending digits over PStream"),null!==this.pstream&&"disconnected"!==this.pstream.status?this.pstream.dtmf(this.parameters.CallSid,t):this.emit("error",{code:31e3,connection:this,message:"Could not send DTMF: Signaling channel is disconnected"})},n.prototype.status=function(){return this._status},n.prototype.unmute=function(){this._log.warn(".unmute() is deprecated. Please use .mute(false) to unmute a call instead."),this.mute(!1)},n.prototype.volume=function(t){window&&(window.AudioContext||window.webkitAudioContext)||this._log.warn("This browser does not support Connection.volume"),this._addHandler("volume",t)},n.prototype._addHandler=function(t,n){return d||(this._log.warn("Connection callback handlers (accept, cancel, disconnect, error, ignore, mute, reject,\n        volume) have been deprecated and will be removed in the next breaking release. Instead, the EventEmitter         interface can be used to set event listeners. Example: connection.on('"+t+"', handler)"),d=!0),this.addListener(t,n),this},n.prototype._checkVolume=function(t,n,e,i){var r=n>=10,o=0;return e===t&&(o=n),o>=10?this._emitWarning("audio-level-","constant-audio-"+i+"-level",10,o,!1):r&&this._emitWarning("audio-level-","constant-audio-"+i+"-level",10,o,!0),o},n.prototype._cleanupEventListeners=function(){var t=this,n=function(){t.pstream&&(t.pstream.removeListener("answer",t._onAnswer),t.pstream.removeListener("cancel",t._onCancel),t.pstream.removeListener("hangup",t._onHangup),t.pstream.removeListener("ringing",t._onRinging),t.pstream.removeListener("transportClose",t._onTransportClose))};n(),setTimeout(n,0)},n.prototype._createMetricPayload=function(){var t={call_sid:this.parameters.CallSid,dscp:!!this.options.dscp,sdk_version:I,selected_region:this.options.selectedRegion};return this.options.gateway&&(t.gateway=this.options.gateway),this.options.region&&(t.region=this.options.region),t.direction=this._direction,t},n.prototype._disconnect=function(t,e){if(t="string"==typeof t?t:null,this._status===n.State.Open||this._status===n.State.Connecting||this._status===n.State.Reconnecting||this._status===n.State.Ringing){if(this._log.info("Disconnecting..."),null!==this.pstream&&"disconnected"!==this.pstream.status&&this.sendHangup){var i=this.parameters.CallSid||this.outboundConnectionId;i&&this.pstream.hangup(i,t)}this._cleanupEventListeners(),this.mediaStream.close(),e||this._publisher.info("connection","disconnected-by-local",null,this)}},n.prototype._maybeTransitionToOpen=function(){this.mediaStream&&"open"===this.mediaStream.status&&this._isAnswered&&(this._status=n.State.Open,this.emit("accept",this))},n.prototype._postFeedbackDeclined=function(){return this._publisher.info("feedback","received-none",null,this,!0)},n.prototype._publishMetrics=function(){var t=this;0!==this._metricsSamples.length&&this._publisher.postMetrics("quality-metrics-samples","metrics-sample",this._metricsSamples.splice(0),this._createMetricPayload(),this).catch((function(n){t._log.warn("Unable to post metrics to Insights. Received error:",n)}))},n.prototype._setCallSid=function(t){var n=t.callsid;n&&(this.parameters.CallSid=n,this.mediaStream.callSid=n)},n.toString=function(){return"[Twilio.Connection class]"},n}(P.EventEmitter);!function(t){var n,e,i,r,o,s,u;(n=t.State||(t.State={})).Closed="closed",n.Connecting="connecting",n.Open="open",n.Pending="pending",n.Reconnecting="reconnecting",n.Ringing="ringing",(e=t.FeedbackIssue||(t.FeedbackIssue={})).AudioLatency="audio-latency",e.ChoppyAudio="choppy-audio",e.DroppedCall="dropped-call",e.Echo="echo",e.NoisyCall="noisy-call",e.OneWayAudio="one-way-audio",(i=t.FeedbackScore||(t.FeedbackScore={}))[i.One=1]="One",i[i.Two=2]="Two",i[i.Three=3]="Three",i[i.Four=4]="Four",i[i.Five=5]="Five",(r=t.CallDirection||(t.CallDirection={})).Incoming="INCOMING",r.Outgoing="OUTGOING",(o=t.Codec||(t.Codec={})).Opus="opus",o.PCMU="pcmu",(s=t.IceGatheringFailureReason||(t.IceGatheringFailureReason={})).None="none",s.Timeout="timeout",(u=t.MediaFailure||(t.MediaFailure={})).ConnectionDisconnected="ConnectionDisconnected",u.ConnectionFailed="ConnectionFailed",u.IceGatheringFailed="IceGatheringFailed",u.LowBytes="LowBytes"}(v||(v={})),n.default=v})),Ii=a((function(t,n){var e;function i(){e=new Ei.default,Object.getOwnPropertyNames(Ei.default.prototype).concat(Object.getOwnPropertyNames(P.EventEmitter.prototype)).filter((function(t){return"function"==typeof Ei.default.prototype[t]})).filter((function(t){return"destroy"!==t})).forEach((function(t){Ei.default[t]=Ei.default.prototype[t].bind(e)}))}Object.defineProperty(n,"__esModule",{value:!0}),n.Connection=ji.default,n.Device=Ei.default,n.PreflightTest=Yn.PreflightTest,n.PStream=Se,Object.defineProperty(Ei.default,"instance",{get:function(){return e},set:function(t){null===t&&(e=null)}}),Ei.default.destroy=function(){e&&e.destroy(),i()},i(),Object.getOwnPropertyNames(e).filter((function(t){return"function"!=typeof Ei.default.prototype[t]})).forEach((function(t){Object.defineProperty(Ei.default,t,{get:function(){if(e)return e[t]},set:function(n){e&&(e[t]=n)}})}))}));class Ri{async init(t){return new Promise((async(n,e)=>{try{const i=await fetch(`https://89b9a8d4f39e.ngrok.io/browser-call-widget/us-central1/call/generateToken?api_key=${t}`),{token:r}=await i.json(),o=new Ii.Device(r);o.on("ready",(()=>{this.device=o,n(o)})),o.on("error",e)}catch(t){e()}}))}async call(){this.device&&this.device.connect()}async hangUp(){this.device&&this.device.destroy()}}const _i=class{constructor(n){t(this,n),this.opened=i(this,"opened",7),this.closed=i(this,"closed",7),this.callStatus="",this.isOpen=!1,this.callTime=0,this.logoSrc="https://tppwebsolutions.com/wp-content/uploads/logo-demo3.png",this.apiKey="api-key",this.open=()=>{this.isOpen=!0,this.opened.emit(),this.startCall()},this.close=()=>{this.isOpen=!1,this.closed.emit(),this.endCall()}}async startCall(){this.twilio=new Ri,await this.twilio.init(this.apiKey),this.twilio.call(),this.twilio.device.activeConnection().on("disconnect",(()=>{console.log("the call has ended"),this.close()}));const t=Date.now();this.timeIntervalId=setInterval((()=>{this.callTime=Date.now()-t}),1e3)}endCall(){clearInterval(this.timeIntervalId),this.callTime=0,this.twilio.hangUp()}handleEscape(t){"Escape"==t.key&&this.close()}render(){return n(e,null,n("div",{class:"container"},n("call-dialog",{logoSrc:this.logoSrc,isOpen:this.isOpen,callDuration:this.callTime,onClose:this.close}),n("div",{onClick:this.open},n("slot",{name:"call-btn"},n("call-btn",null)))))}static get assetsDirs(){return["assets"]}};_i.style=":host{display:block}.container{display:flex}";export{r as call_btn,s as call_dialog,_i as tw_caller}